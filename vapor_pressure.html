<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="color-scheme" content="light only">
<meta name="supported-color-schemes" content="light only">
<base target="_parent">
<title>Vapor Pressure Curves - Interactive Explorer</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --water: #2B6CB0;
    --water-light: #EBF4FF;
    --ethanol: #C05621;
    --ethanol-light: #FFF0EB;
    --acetone: #B7791F;
    --acetone-light: #FEFCBF;
    --ether: #C53030;
    --ether-light: #FFF5F5;
    --methanol: #6B46C1;
    --methanol-light: #F3E8FF;
    --hexane: #64748B;
    --hexane-light: #F1F5F9;
    --dcm: #0D9488;
    --dcm-light: #D1FAE5;
    --chloroform: #059669;
    --chloroform-light: #ECFDF5;
    --slate-900: #1A202C;
    --slate-700: #334155;
    --slate-500: #64748B;
    --slate-300: #CBD5E1;
    --slate-100: #F1F5F9;
    --parchment: #FAFAF7;
    --success: #2F855A;
    --success-light: #F0FFF4;
    --gold: #B7791F;
    --gold-light: #FEFCBF;
    --pressure-blue: #2B6CB0;
    --pressure-light: #EBF4FF;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html {
    background-color: #FAFAF7 !important;
    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  body {
    font-family: 'Source Sans 3', 'Segoe UI', Roboto, -apple-system, sans-serif;
    background-color: #FAFAF7 !important;
    color: #1A202C !important;
    line-height: 1.7;
    font-size: 17px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  html, body, .container, section, .controls-panel,
  .graph-wrap, .legend-card, .thought-prompt, footer {
    color-scheme: light !important;
  }

  /* ---- HERO ---- */
  .hero {
    position: relative;
    background: linear-gradient(135deg, #0D9488 0%, var(--slate-900) 50%, var(--pressure-blue) 100%);
    padding: 5rem 2rem 4rem;
    text-align: center;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at 25% 55%, rgba(13,148,136,0.25) 0%, transparent 50%),
      radial-gradient(circle at 75% 45%, rgba(43,108,176,0.25) 0%, transparent 50%);
    pointer-events: none;
  }
  .hero h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2.2rem, 5vw, 3.4rem);
    color: #fff !important;
    position: relative;
    letter-spacing: -0.5px;
  }
  .hero .subtitle {
    color: rgba(255,255,255,0.8) !important;
    font-size: 1.15rem;
    margin-top: 0.75rem;
    font-weight: 300;
    position: relative;
  }
  .hero .tag-bar {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-top: 2rem;
    position: relative;
    flex-wrap: wrap;
  }
  .tag-bar span {
    font-weight: 600;
    font-size: 0.85rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 0.35rem 1.2rem;
    border-radius: 4px;
  }
  .tag-bar .tag-imf { background: rgba(13,148,136,0.35); color: #A7F3D0; }
  .tag-bar .tag-temp { background: rgba(183,121,31,0.35); color: #FEFCBF; }
  .tag-bar .tag-bp { background: rgba(43,108,176,0.35); color: #BEE3F8; }

  /* ---- LAYOUT ---- */
  .container {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 1.5rem;
    background-color: #FAFAF7;
  }

  section {
    padding: 2.5rem 0;
    border-bottom: 1px solid var(--slate-300);
    background-color: #FAFAF7;
  }
  section:last-of-type { border-bottom: none; }

  h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.9rem;
    margin-bottom: 1.25rem;
    color: #1A202C !important;
  }
  h3 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.35rem;
    margin: 1.5rem 0 0.75rem;
    color: var(--slate-700) !important;
  }
  p { color: #1A202C !important; }
  p + p { margin-top: 1rem; }

  .key-term {
    font-weight: 700;
    border-bottom: 2px solid var(--gold);
    cursor: help;
  }

  /* ---- THOUGHT PROMPT ---- */
  .thought-prompt {
    background: var(--gold-light);
    border-left: 4px solid var(--gold);
    border-radius: 0 8px 8px 0;
    padding: 1.25rem 1.5rem;
    margin: 1.5rem 0;
    font-size: 0.95rem;
  }
  .thought-prompt strong {
    display: block;
    margin-bottom: 0.25rem;
    color: var(--gold);
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1.5px;
  }

  /* ---- INSTRUCTIONS ---- */
  .instructions {
    background: var(--pressure-light);
    border-left: 4px solid var(--pressure-blue);
    border-radius: 0 8px 8px 0;
    padding: 1.25rem 1.5rem;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
    color: #1A202C !important;
  }
  .instructions strong.inst-label {
    display: block;
    margin-bottom: 0.35rem;
    color: var(--pressure-blue);
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1.5px;
  }
  .instructions ol {
    margin: 0.5rem 0 0 1.25rem;
    line-height: 1.8;
  }
  .instructions li { font-size: 0.95rem; }

  /* ---- CONTROLS ---- */
  .controls-panel {
    background: #fff;
    border: 2px solid var(--slate-300);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .controls-panel h3 {
    margin: 0 0 1rem;
    padding-bottom: 0.6rem;
    border-bottom: 2px solid var(--pressure-blue);
    color: var(--slate-900) !important;
    font-size: 1.15rem;
  }

  /* Pressure display */
  .pressure-display {
    background: linear-gradient(135deg, var(--pressure-blue), #1E4E8C);
    color: #fff !important;
    padding: 1rem;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 1rem;
  }
  .pressure-display .p-value {
    font-family: 'DM Serif Display', serif;
    font-size: 1.8rem;
  }
  .pressure-display .p-label {
    font-size: 0.85rem;
    margin-top: 0.25rem;
    opacity: 0.85;
  }

  /* Slider */
  .slider-wrap {
    margin-bottom: 1rem;
  }
  .slider {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: var(--slate-300);
    outline: none;
    -webkit-appearance: none;
    cursor: pointer;
  }
  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--pressure-blue);
    cursor: pointer;
    border: 3px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  }
  .slider::-moz-range-thumb {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--pressure-blue);
    cursor: pointer;
    border: 3px solid #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  }
  .slider-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.78rem;
    color: var(--slate-500) !important;
    margin-top: 0.4rem;
  }

  /* Preset buttons */
  .preset-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.6rem;
  }
  .preset-btn {
    padding: 0.6rem 0.5rem;
    border-radius: 8px;
    border: 2px solid var(--slate-300);
    background: #fff;
    cursor: pointer;
    font-family: 'Source Sans 3', sans-serif;
    font-weight: 600;
    font-size: 0.82rem;
    text-align: center;
    line-height: 1.4;
    transition: all 0.2s;
    color: var(--slate-700) !important;
  }
  .preset-btn:hover {
    border-color: var(--pressure-blue);
    background: var(--pressure-light);
    transform: translateY(-1px);
  }
  .preset-btn .preset-name { display: block; font-weight: 700; }
  .preset-btn .preset-val { display: block; font-weight: 400; font-size: 0.78rem; color: var(--slate-500); }

  /* ---- SUBSTANCE TOGGLES ---- */
  .substance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 0.6rem;
  }
  .substance-toggle {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.65rem 0.85rem;
    border-radius: 8px;
    border: 2px solid var(--slate-300);
    background: #fff;
    cursor: pointer;
    transition: all 0.2s;
  }
  .substance-toggle:hover { border-color: var(--slate-500); }
  .substance-toggle.active { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

  .substance-toggle input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    flex-shrink: 0;
    accent-color: var(--slate-700);
  }
  .substance-info { flex: 1; min-width: 0; }
  .substance-name {
    font-weight: 700;
    font-size: 0.88rem;
    line-height: 1.3;
    color: #1A202C !important;
  }
  .substance-imf {
    font-size: 0.78rem;
    color: var(--slate-500) !important;
    line-height: 1.3;
    margin-top: 1px;
  }

  /* Color-coded borders when active */
  .substance-toggle[data-sub="water"].active { border-color: var(--water); background: var(--water-light); }
  .substance-toggle[data-sub="ethanol"].active { border-color: var(--ethanol); background: var(--ethanol-light); }
  .substance-toggle[data-sub="acetone"].active { border-color: var(--acetone); background: var(--acetone-light); }
  .substance-toggle[data-sub="ether"].active { border-color: var(--ether); background: var(--ether-light); }
  .substance-toggle[data-sub="methanol"].active { border-color: var(--methanol); background: var(--methanol-light); }
  .substance-toggle[data-sub="hexane"].active { border-color: var(--hexane); background: var(--hexane-light); }
  .substance-toggle[data-sub="dichloromethane"].active { border-color: var(--dcm); background: var(--dcm-light); }
  .substance-toggle[data-sub="chloroform"].active { border-color: var(--chloroform); background: var(--chloroform-light); }

  /* ---- GRAPH ---- */
  .graph-wrap {
    background: #fff;
    border: 2px solid var(--slate-300);
    border-radius: 12px;
    padding: 1.25rem;
    margin: 1.5rem 0;
  }
  canvas {
    width: 100%;
    height: 420px;
    cursor: crosshair;
    display: block;
  }

  /* ---- LEGEND CARDS ---- */
  .legend-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.25rem;
    margin-top: 1.5rem;
  }
  @media (max-width: 640px) { .legend-grid { grid-template-columns: 1fr; } }

  .legend-card {
    border-radius: 10px;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
  }
  .legend-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
  }
  .legend-card h4 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.05rem;
    margin-bottom: 0.5rem;
  }
  .legend-card p {
    font-size: 0.92rem;
    line-height: 1.6;
  }

  .legend-card.card-imf { background: #ECFDF5; border: 1px solid rgba(5,150,105,0.2); }
  .legend-card.card-imf::before { background: #059669; }
  .legend-card.card-imf h4 { color: #059669 !important; }

  .legend-card.card-temp { background: var(--gold-light); border: 1px solid rgba(183,121,31,0.2); }
  .legend-card.card-temp::before { background: var(--gold); }
  .legend-card.card-temp h4 { color: var(--gold) !important; }

  .legend-card.card-bp { background: var(--pressure-light); border: 1px solid rgba(43,108,176,0.2); }
  .legend-card.card-bp::before { background: var(--pressure-blue); }
  .legend-card.card-bp h4 { color: var(--pressure-blue) !important; }

  .legend-card.card-press { background: var(--ether-light); border: 1px solid rgba(197,48,48,0.2); }
  .legend-card.card-press::before { background: #C53030; }
  .legend-card.card-press h4 { color: #C53030 !important; }

  /* ---- FOOTER ---- */
  footer {
    text-align: center;
    padding: 2.5rem 1.5rem;
    font-size: 0.85rem;
    color: var(--slate-500);
    border-top: 1px solid var(--slate-300);
    background-color: #FAFAF7;
  }

  /* ---- DARK MODE OVERRIDE ---- */
  @media (prefers-color-scheme: dark) {
    html, body {
      background-color: #FAFAF7 !important;
      color: #1A202C !important;
    }
    .container, section, footer,
    .controls-panel, .graph-wrap, .legend-card,
    .thought-prompt, .substance-toggle, .preset-btn {
      background-color: inherit;
      color: inherit;
    }
    h2, h3, h4, p, span, div, button, label {
      color: inherit !important;
    }
  }

  h2 { color: #1A202C !important; }
  .legend-card p { color: #334155 !important; }
  .thought-prompt { color: #1A202C !important; }

  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>

<!-- ====== HERO ====== -->
<div class="hero">
  <h1>Interactive Vapor Pressure Curves</h1>
  <p class="subtitle">How do intermolecular forces, temperature, and external pressure affect boiling points?</p>
  <div class="tag-bar">
    <span class="tag-imf">IMF Strength</span>
    <span class="tag-temp">Temperature</span>
    <span class="tag-bp">Boiling Points</span>
  </div>
</div>

<div class="container">

<!-- ====== INSTRUCTIONS ====== -->
<section>
  <div class="instructions">
    <strong class="inst-label">How to use this tool</strong>
    <ol>
      <li><strong>Adjust the atmospheric pressure</strong> using the slider or the preset buttons to see how external pressure shifts boiling points.</li>
      <li><strong>Select substances</strong> to display their vapor pressure curves on the graph.</li>
      <li><strong>Compare</strong> substances with different intermolecular forces and observe how IMF strength affects where each curve sits.</li>
    </ol>
  </div>

  <!-- Pressure Controls -->
  <div class="controls-panel">
    <h3>Atmospheric Pressure</h3>
    <div class="pressure-display">
      <div class="p-value" id="pressureValue">760 mmHg</div>
      <div class="p-label" id="pressureLabel">Sea Level (1 atm)</div>
    </div>
    <div class="slider-wrap">
      <input type="range" min="200" max="1520" value="760" class="slider" id="pressureSlider">
      <div class="slider-labels">
        <span>200 mmHg</span>
        <span>1520 mmHg</span>
      </div>
    </div>
    <div class="preset-grid">
      <button class="preset-btn" onclick="setPresetPressure(400)">
        <span class="preset-name">Mt. Everest</span>
        <span class="preset-val">~400 mmHg</span>
      </button>
      <button class="preset-btn" onclick="setPresetPressure(526)">
        <span class="preset-name">Denver (High Altitude)</span>
        <span class="preset-val">526 mmHg</span>
      </button>
      <button class="preset-btn" onclick="setPresetPressure(760)">
        <span class="preset-name">Sea Level</span>
        <span class="preset-val">760 mmHg (1 atm)</span>
      </button>
      <button class="preset-btn" onclick="setPresetPressure(1520)">
        <span class="preset-name">Pressure Cooker</span>
        <span class="preset-val">1520 mmHg (2 atm)</span>
      </button>
    </div>
  </div>

  <!-- Substance Selection -->
  <div class="controls-panel">
    <h3>Select Substances to Compare</h3>
    <div class="substance-grid" id="substanceGrid"></div>
  </div>

  <!-- Graph -->
  <div class="graph-wrap">
    <canvas id="graphCanvas"></canvas>
  </div>

  <div class="thought-prompt">
    <strong>Stop and Think</strong>
    At sea level, water boils at 100 degrees C. Use the slider to set the pressure to Denver's altitude (526 mmHg). What happens to water's boiling point? Why would this matter if you were trying to boil pasta in Denver?
  </div>
</section>

<!-- ====== UNDERSTANDING ====== -->
<section>
  <h2>Understanding the Relationships</h2>
  <p>
    The graph above is built from a single principle: a substance boils when its <span class="key-term" title="The pressure exerted by the vapor of a liquid in equilibrium with its liquid phase at a given temperature.">vapor pressure</span> equals the <span class="key-term" title="The total pressure exerted by the atmosphere above the liquid.">atmospheric pressure</span> above it. Each curve shows how a substance's vapor pressure rises with temperature. Where the curve crosses the horizontal pressure line is that substance's boiling point at the current atmospheric pressure.
  </p>

  <div class="legend-grid">
    <div class="legend-card card-imf">
      <h4>IMF Strength and Vapor Pressure</h4>
      <p><strong>Stronger intermolecular forces</strong> hold molecules more tightly in the liquid phase. Fewer molecules escape into the gas phase at any given temperature, producing a <strong>lower vapor pressure</strong>. On the graph, substances with stronger IMFs have curves that sit lower and farther to the right.</p>
    </div>
    <div class="legend-card card-temp">
      <h4>Temperature and Vapor Pressure</h4>
      <p>As temperature increases, molecules gain kinetic energy and more of them have enough energy to overcome IMFs and enter the gas phase. Vapor pressure increases <strong>exponentially</strong> with temperature, which is why the curves are steep rather than straight lines.</p>
    </div>
    <div class="legend-card card-bp">
      <h4>Boiling Point Definition</h4>
      <p>The boiling point is the temperature at which <strong>vapor pressure equals atmospheric pressure</strong>. The dashed green line on the graph represents the current atmospheric pressure. Where it intersects each curve marks that substance's boiling point at the current conditions.</p>
    </div>
    <div class="legend-card card-press">
      <h4>External Pressure and Boiling Point</h4>
      <p><strong>Lower atmospheric pressure</strong> (high altitude) means molecules need less energy to escape, producing a <strong>lower boiling point</strong>. <strong>Higher pressure</strong> (pressure cooker) requires more energy, producing a <strong>higher boiling point</strong>. The substance itself does not change; only the threshold it must reach changes.</p>
    </div>
  </div>

  <div class="thought-prompt">
    <strong>Challenge Question</strong>
    Compare water and ethanol. Both exhibit hydrogen bonding, yet water has a significantly higher boiling point. What structural difference between the two molecules accounts for water having stronger intermolecular forces and therefore a lower vapor pressure at any given temperature?
  </div>
</section>

</div>

<footer>
  Interactive Thermochemistry Module &middot; Vapor Pressure and Boiling Points
</footer>

<script>
  /* ==============================
     SUBSTANCE DATA (Antoine Equation)
     log10(P_mmHg) = A - B / (C + T_celsius)
     ============================== */
  var substances = {
    ether: {
      name: 'Diethyl Ether', formula: 'C\u2084H\u2081\u2080O',
      color: '#C53030', normalBP: 34.6, dipole: 1.15,
      A: 6.92032, B: 1064.07, C: 228.800,
      imf: 'Weak dipole-dipole', imfShort: 'Weak IMFs',
      visible: true
    },
    dichloromethane: {
      name: 'Dichloromethane', formula: 'CH\u2082Cl\u2082',
      color: '#0D9488', normalBP: 39.6, dipole: 1.60,
      A: 7.40916, B: 1325.938, C: 252.615,
      imf: 'Dipole-dipole', imfShort: 'Dip-Dip',
      visible: false
    },
    acetone: {
      name: 'Acetone', formula: 'C\u2083H\u2086O',
      color: '#B7791F', normalBP: 56.5, dipole: 2.88,
      A: 7.11714, B: 1210.595, C: 229.664,
      imf: 'Dipole-dipole', imfShort: 'Dip-Dip',
      visible: true
    },
    chloroform: {
      name: 'Chloroform', formula: 'CHCl\u2083',
      color: '#059669', normalBP: 61.2, dipole: 1.01,
      A: 6.95465, B: 1170.966, C: 226.232,
      imf: 'Dipole-dipole', imfShort: 'Dip-Dip',
      visible: false
    },
    methanol: {
      name: 'Methanol', formula: 'CH\u2083OH',
      color: '#6B46C1', normalBP: 64.7, dipole: 1.70,
      A: 8.08097, B: 1582.271, C: 239.726,
      imf: 'Hydrogen bonding', imfShort: 'H-bonding',
      visible: false
    },
    hexane: {
      name: 'Hexane', formula: 'C\u2086H\u2081\u2084',
      color: '#64748B', normalBP: 68.7, dipole: 0.0,
      A: 6.87601, B: 1171.17, C: 224.41,
      imf: 'London dispersion only', imfShort: 'London only',
      visible: false
    },
    ethanol: {
      name: 'Ethanol', formula: 'C\u2082H\u2085OH',
      color: '#C05621', normalBP: 78.4, dipole: 1.69,
      A: 8.04494, B: 1554.3, C: 222.65,
      imf: 'Hydrogen bonding', imfShort: 'H-bonding',
      visible: true
    },
    water: {
      name: 'Water', formula: 'H\u2082O',
      color: '#2B6CB0', normalBP: 100.0, dipole: 1.85,
      A: 8.07131, B: 1730.63, C: 233.426,
      imf: 'Hydrogen bonding', imfShort: 'H-bonding',
      visible: true
    }
  };

  var currentPressure = 760;
  var canvas = document.getElementById('graphCanvas');
  var ctx = canvas.getContext('2d');

  /* ==============================
     BUILD SUBSTANCE TOGGLES
     ============================== */
  function buildToggles() {
    var grid = document.getElementById('substanceGrid');
    grid.innerHTML = '';
    var keys = Object.keys(substances);
    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      var s = substances[key];
      var label = document.createElement('label');
      label.className = 'substance-toggle' + (s.visible ? ' active' : '');
      label.dataset.sub = key;

      var cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.checked = s.visible;
      (function(k) {
        cb.addEventListener('change', function() { toggleSubstance(k); });
      })(key);

      var info = document.createElement('div');
      info.className = 'substance-info';
      info.innerHTML =
        '<div class="substance-name">' + s.name + ' (' + s.formula + ')</div>' +
        '<div class="substance-imf">' + s.imfShort + ' | Normal BP: ' + s.normalBP + ' degrees C | \u03BC: ' + s.dipole.toFixed(2) + ' D</div>';

      label.appendChild(cb);
      label.appendChild(info);
      grid.appendChild(label);
    }
  }

  function toggleSubstance(key) {
    substances[key].visible = !substances[key].visible;
    var toggles = document.querySelectorAll('.substance-toggle');
    for (var i = 0; i < toggles.length; i++) {
      var cb = toggles[i].querySelector('input[type="checkbox"]');
      if (cb.checked) toggles[i].classList.add('active');
      else toggles[i].classList.remove('active');
    }
    drawGraph();
  }

  /* ==============================
     PRESSURE CONTROLS
     ============================== */
  var pressureSlider = document.getElementById('pressureSlider');
  pressureSlider.addEventListener('input', function(e) {
    currentPressure = parseInt(e.target.value);
    updatePressureDisplay();
    drawGraph();
  });

  function updatePressureDisplay() {
    document.getElementById('pressureValue').textContent = currentPressure + ' mmHg';
    var atm = (currentPressure / 760).toFixed(2);
    var label = atm + ' atm';
    if (currentPressure === 760) label = 'Sea Level (1 atm)';
    else if (currentPressure === 526) label = 'Denver Altitude';
    else if (currentPressure === 1520) label = 'Pressure Cooker (2 atm)';
    else if (currentPressure === 400) label = 'Mt. Everest Summit';
    document.getElementById('pressureLabel').textContent = label;
  }

  function setPresetPressure(pressure) {
    currentPressure = pressure;
    pressureSlider.value = pressure;
    updatePressureDisplay();
    drawGraph();
  }

  /* ==============================
     ANTOINE CALCULATIONS
     ============================== */
  function calculateVaporPressure(substance, tempC) {
    var logP = substance.A - (substance.B / (tempC + substance.C));
    return Math.pow(10, logP);
  }

  function calculateTemperature(substance, pressureMMHg) {
    var logP = Math.log10(pressureMMHg);
    return (substance.B / (substance.A - logP)) - substance.C;
  }

  /* ==============================
     GRAPH DRAWING
     ============================== */
  function resizeCanvas() {
    var rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * window.devicePixelRatio;
    canvas.height = rect.height * window.devicePixelRatio;
    ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    drawGraph();
  }

  function drawGraph() {
    var rect = canvas.getBoundingClientRect();
    var width = rect.width;
    var height = rect.height;
    ctx.clearRect(0, 0, width, height);

    var margin = { top: 40, right: 80, bottom: 60, left: 80 };
    var graphWidth = width - margin.left - margin.right;
    var graphHeight = height - margin.top - margin.bottom;

    var tempMin = 0, tempMax = 140;
    var pressureMin = 0, pressureMax = 2000;

    function xScale(temp) { return margin.left + (temp - tempMin) / (tempMax - tempMin) * graphWidth; }
    function yScale(pressure) { return margin.top + graphHeight - (pressure - pressureMin) / (pressureMax - pressureMin) * graphHeight; }

    // Grid
    ctx.strokeStyle = '#E2E8F0';
    ctx.lineWidth = 1;
    for (var temp = 0; temp <= 140; temp += 20) {
      ctx.beginPath();
      ctx.moveTo(xScale(temp), margin.top);
      ctx.lineTo(xScale(temp), margin.top + graphHeight);
      ctx.stroke();
    }
    for (var pr = 0; pr <= 2000; pr += 200) {
      ctx.beginPath();
      ctx.moveTo(margin.left, yScale(pr));
      ctx.lineTo(margin.left + graphWidth, yScale(pr));
      ctx.stroke();
    }

    // Axes
    ctx.strokeStyle = '#1A202C';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(margin.left, margin.top);
    ctx.lineTo(margin.left, margin.top + graphHeight);
    ctx.lineTo(margin.left + graphWidth, margin.top + graphHeight);
    ctx.stroke();

    // X labels
    ctx.fillStyle = '#334155';
    ctx.font = '600 13px Source Sans 3, sans-serif';
    ctx.textAlign = 'center';
    for (var t = 0; t <= 140; t += 20) {
      ctx.fillText(t, xScale(t), margin.top + graphHeight + 22);
    }
    ctx.font = '700 14px Source Sans 3, sans-serif';
    ctx.fillText('Temperature (\u00B0C)', margin.left + graphWidth / 2, margin.top + graphHeight + 48);

    // Y labels
    ctx.textAlign = 'right';
    ctx.font = '600 13px Source Sans 3, sans-serif';
    for (var p = 0; p <= 2000; p += 200) {
      ctx.fillText(p, margin.left - 10, yScale(p) + 5);
    }
    ctx.save();
    ctx.translate(18, margin.top + graphHeight / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.textAlign = 'center';
    ctx.font = '700 14px Source Sans 3, sans-serif';
    ctx.fillText('Vapor Pressure (mmHg)', 0, 0);
    ctx.restore();

    // Atmospheric pressure line
    var pressureLineY = yScale(currentPressure);
    ctx.strokeStyle = '#2F855A';
    ctx.lineWidth = 2.5;
    ctx.setLineDash([10, 5]);
    ctx.beginPath();
    ctx.moveTo(margin.left, pressureLineY);
    ctx.lineTo(margin.left + graphWidth, pressureLineY);
    ctx.stroke();
    ctx.setLineDash([]);

    ctx.fillStyle = '#2F855A';
    ctx.font = '700 11px Source Sans 3, sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(currentPressure + ' mmHg', margin.left + graphWidth + 8, pressureLineY + 4);

    // Draw curves
    var keys = Object.keys(substances);
    for (var si = 0; si < keys.length; si++) {
      var substance = substances[keys[si]];
      if (!substance.visible) continue;

      // Curve
      ctx.strokeStyle = substance.color;
      ctx.lineWidth = 3.5;
      ctx.beginPath();
      var firstPoint = true;
      for (var temp = tempMin; temp <= tempMax; temp += 0.5) {
        var vp = calculateVaporPressure(substance, temp);
        if (isNaN(vp) || !isFinite(vp) || vp > pressureMax || vp < pressureMin) continue;
        var x = xScale(temp);
        var y = yScale(vp);
        if (firstPoint) { ctx.moveTo(x, y); firstPoint = false; }
        else { ctx.lineTo(x, y); }
      }
      ctx.stroke();

      // Curve label
      var labelTemp;
      if (substance.normalBP < 50) labelTemp = 60;
      else if (substance.normalBP < 65) labelTemp = 75;
      else if (substance.normalBP < 75) labelTemp = 80;
      else if (substance.normalBP < 85) labelTemp = 90;
      else labelTemp = 110;

      if (labelTemp <= tempMax && labelTemp >= tempMin) {
        var labelPressure = calculateVaporPressure(substance, labelTemp);
        if (labelPressure <= pressureMax && labelPressure >= pressureMin) {
          var labelX = xScale(labelTemp);
          var labelY = yScale(labelPressure);
          ctx.fillStyle = 'rgba(255,255,255,0.92)';
          ctx.font = '700 12px Source Sans 3, sans-serif';
          var textW = ctx.measureText(substance.name).width;
          ctx.fillRect(labelX - textW / 2 - 6, labelY - 26, textW + 12, 32);
          ctx.fillStyle = substance.color;
          ctx.textAlign = 'center';
          ctx.fillText(substance.name, labelX, labelY - 9);
          ctx.font = '500 11px Source Sans 3, sans-serif';
          ctx.fillText(substance.formula, labelX, labelY + 4);
        }
      }

      // Boiling point marker
      var bp = calculateTemperature(substance, currentPressure);
      if (bp >= tempMin && bp <= tempMax && !isNaN(bp) && isFinite(bp)) {
        var bpX = xScale(bp);
        var bpY = pressureLineY;

        ctx.fillStyle = substance.color;
        ctx.beginPath();
        ctx.arc(bpX, bpY, 7, 0, 2 * Math.PI);
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();

        // Dashed drop line
        ctx.strokeStyle = substance.color;
        ctx.lineWidth = 1.5;
        ctx.setLineDash([4, 4]);
        ctx.beginPath();
        ctx.moveTo(bpX, bpY);
        ctx.lineTo(bpX, margin.top + graphHeight);
        ctx.stroke();
        ctx.setLineDash([]);

        // BP temperature label
        ctx.fillStyle = substance.color;
        ctx.font = '700 12px Source Sans 3, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText(bp.toFixed(1) + '\u00B0C', bpX, margin.top + graphHeight + 38);
      }
    }
  }

  /* ==============================
     IFRAME AUTO-RESIZE
     ============================== */
  function postHeight() {
    var h = document.documentElement.scrollHeight;
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({ type: 'resize', height: h }, '*');
    }
  }
  window.addEventListener('load', function() {
    postHeight();
    setTimeout(postHeight, 500);
    setTimeout(postHeight, 2000);
  });
  window.addEventListener('resize', function() {
    postHeight();
    resizeCanvas();
  });
  if (typeof MutationObserver !== 'undefined') {
    var resizeObs = new MutationObserver(function() { setTimeout(postHeight, 100); });
    resizeObs.observe(document.body, { childList: true, subtree: true, attributes: true });
  }

  /* ==============================
     INITIALIZE
     ============================== */
  buildToggles();
  resizeCanvas();
</script>
</body>
</html>
