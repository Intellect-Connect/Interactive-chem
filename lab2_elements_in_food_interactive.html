<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elements in Food Investigation | CHEM 100 Lab 2</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,300;0,400;0,600;1,400&family=JetBrains+Mono:wght@400;600&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #1a1a2e;
    --paper: #faf8f4;
    --cream: #f2ede3;
    --rule: #d4c9b0;
    --accent: #2e7d32;
    --accent-light: #e8f5e9;
    --accent-dark: #1b5e20;
    --red: #c0392b;
    --red-light: #f9ebea;
    --blue: #1a4a7a;
    --blue-light: #e8f0f9;
    --gold: #b8860b;
    --gold-light: #fdf6e3;
    --orange: #e65100;
    --orange-light: #fff3e0;
    --canvas-bg: #fffef9;
    --border: #c8bfa8;
    --shadow: 0 2px 12px rgba(26,26,46,0.08);
    --green: #1a6b3c;
    --green-light: #e8f5ee;
    --purple: #5b2d8e;
    --purple-light: #f0eaf8;
    --teal: #1565c0;
    --teal-light: #e3f0fc;
    --teal-dark: #0d47a1;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: #e0ddd6;
    background-image:
      radial-gradient(ellipse at 15% 10%, rgba(46,125,50,0.07) 0%, transparent 50%),
      radial-gradient(ellipse at 85% 90%, rgba(26,74,122,0.06) 0%, transparent 50%);
    min-height: 100vh;
    color: var(--ink);
  }

  /* HEADER */
  .lab-header {
    background: var(--ink);
    color: var(--paper);
    padding: 0;
    position: relative;
    overflow: hidden;
  }
  .lab-header::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: repeating-linear-gradient(
      90deg, transparent, transparent 59px,
      rgba(255,255,255,0.04) 59px, rgba(255,255,255,0.04) 60px
    );
  }
  .header-inner {
    position: relative;
    max-width: 960px;
    margin: 0 auto;
    padding: 36px 40px 28px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: 20px;
  }
  .lab-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.18em;
    color: #6fcf6f;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .lab-title {
    font-family: 'Source Serif 4', serif;
    font-size: 30px;
    font-weight: 600;
    line-height: 1.15;
    color: #fff;
  }
  .lab-subtitle {
    font-size: 14px;
    color: rgba(255,255,255,0.5);
    margin-top: 6px;
    font-style: italic;
  }
  .header-meta {
    text-align: right;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: rgba(255,255,255,0.38);
    line-height: 1.8;
    flex-shrink: 0;
  }

  /* STUDENT BAR */
  .student-bar {
    background: var(--cream);
    border-bottom: 1px solid var(--rule);
  }
  .student-bar-inner {
    max-width: 960px;
    margin: 0 auto;
    padding: 16px 40px;
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 16px;
  }
  .field-group label {
    display: block;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #888;
    margin-bottom: 4px;
    font-family: 'JetBrains Mono', monospace;
  }
  .field-group input {
    width: 100%;
    border: none;
    border-bottom: 1.5px solid var(--border);
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 4px 0;
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s;
  }
  .field-group input:focus { border-color: var(--accent); }

  /* TAB NAV */
  .tab-nav-wrap {
    background: var(--ink);
    border-bottom: 2px solid rgba(255,255,255,0.08);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .tab-nav {
    max-width: 960px;
    margin: 0 auto;
    padding: 0 20px;
    display: flex;
    gap: 0;
  }
  .tab-btn {
    padding: 14px 16px;
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.45);
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.18s;
    letter-spacing: 0.03em;
    white-space: nowrap;
    position: relative;
    top: 2px;
  }
  .tab-btn:hover { color: rgba(255,255,255,0.75); }
  .tab-btn.active {
    color: #6fcf6f;
    border-bottom-color: #6fcf6f;
  }
  .tab-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    margin-right: 7px;
    opacity: 0.6;
  }

  /* TAB PANELS */
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* MAIN CONTENT */
  .main {
    max-width: 960px;
    margin: 0 auto;
    padding: 32px 40px 60px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* SCENARIO BANNER */
  .scenario-banner {
    background: var(--ink);
    border: 1px solid rgba(111,207,111,0.25);
    border-left: 4px solid #6fcf6f;
    border-radius: 4px;
    padding: 22px 26px;
    position: relative;
    overflow: hidden;
  }
  .scenario-banner::before {
    content: '';
    position: absolute;
    top: 0; right: 0; bottom: 0;
    width: 200px;
    background: radial-gradient(ellipse at right, rgba(111,207,111,0.06) 0%, transparent 70%);
  }
  .scenario-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.2em;
    color: #6fcf6f;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .scenario-title {
    font-family: 'Source Serif 4', serif;
    font-size: 17px;
    color: #fff;
    font-weight: 600;
    margin-bottom: 10px;
  }
  .scenario-body {
    font-size: 13.5px;
    color: rgba(255,255,255,0.72);
    line-height: 1.68;
  }
  .scenario-mission {
    margin-top: 14px;
    padding: 12px 16px;
    background: rgba(111,207,111,0.1);
    border-radius: 3px;
    font-size: 13px;
    color: #a8e6a8;
    line-height: 1.6;
  }
  .scenario-mission strong { color: #6fcf6f; }

  /* SECTION CARDS */
  .section-card {
    background: var(--paper);
    border: 1px solid var(--border);
    border-radius: 4px;
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .section-header {
    padding: 14px 24px;
    border-bottom: 1px solid var(--rule);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .section-num {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--ink);
    color: #fff;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .section-title {
    font-family: 'Source Serif 4', serif;
    font-size: 17px;
    font-weight: 600;
    color: var(--ink);
  }
  .section-badge {
    margin-left: auto;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 2px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }
  .badge-green { background: var(--green-light); color: var(--green); }
  .badge-blue { background: var(--blue-light); color: var(--blue); }
  .badge-gold { background: var(--gold-light); color: var(--gold); }
  .badge-red { background: var(--red-light); color: var(--red); }
  .badge-purple { background: var(--purple-light); color: var(--purple); }
  .badge-teal { background: var(--teal-light); color: var(--teal); }
  .section-body { padding: 24px; }

  /* REF BOXES */
  .ref-box {
    background: var(--blue-light);
    border: 1px solid rgba(26,74,122,0.2);
    border-left: 3px solid var(--blue);
    border-radius: 3px;
    padding: 16px 20px;
    margin-bottom: 20px;
  }
  .ref-box-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--blue);
    margin-bottom: 10px;
  }
  .ref-box p { font-size: 13.5px; line-height: 1.65; color: #2a3a50; }
  .ref-box p + p { margin-top: 8px; }

  .ref-box-green {
    background: var(--green-light);
    border: 1px solid rgba(26,107,60,0.2);
    border-left: 3px solid var(--green);
  }
  .ref-box-green .ref-box-title { color: var(--green); }
  .ref-box-green p { color: #1a3a28; }

  .ref-box-gold {
    background: var(--gold-light);
    border: 1px solid rgba(184,134,11,0.25);
    border-left: 3px solid var(--gold);
  }
  .ref-box-gold .ref-box-title { color: var(--gold); }
  .ref-box-gold p { color: #3a2e10; }

  .ref-box-red {
    background: var(--red-light);
    border: 1px solid rgba(192,57,43,0.2);
    border-left: 3px solid var(--red);
  }
  .ref-box-red .ref-box-title { color: var(--red); }
  .ref-box-red p { color: #4a1a16; }

  .ref-box-orange {
    background: var(--orange-light);
    border: 1px solid rgba(230,81,0,0.2);
    border-left: 3px solid var(--orange);
  }
  .ref-box-orange .ref-box-title { color: var(--orange); }
  .ref-box-orange p { color: #3e2000; }

  .ref-box-teal {
    background: var(--teal-light);
    border: 1px solid rgba(21,101,192,0.2);
    border-left: 3px solid var(--teal);
  }
  .ref-box-teal .ref-box-title { color: var(--teal); }
  .ref-box-teal p { color: #0a1f3a; }

  /* CONCEPT GRID */
  .concept-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    margin: 16px 0;
  }
  .concept-card {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 16px;
    position: relative;
  }
  .concept-card h4 {
    font-family: 'Source Serif 4', serif;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
    color: var(--ink);
  }
  .concept-card p { font-size: 12.5px; line-height: 1.6; color: #555; }
  .concept-card .example {
    margin-top: 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: #888;
    padding: 4px 8px;
    background: var(--cream);
    border-radius: 2px;
  }

  /* PROCEDURE STEPS */
  .proc-part-title {
    font-family: 'Source Serif 4', serif;
    font-size: 16px;
    font-weight: 600;
    color: var(--ink);
    margin: 20px 0 12px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--rule);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .proc-part-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 2px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
  }
  .proc-step {
    display: flex;
    gap: 14px;
    padding: 12px 0;
    border-bottom: 1px dashed var(--rule);
    align-items: flex-start;
  }
  .proc-step:last-child { border-bottom: none; }
  .step-num {
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background: var(--cream);
    border: 1.5px solid var(--border);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: var(--ink);
    margin-top: 1px;
  }
  .step-num.highlight {
    background: var(--accent);
    border-color: var(--accent-dark);
    color: #fff;
  }
  .step-num.highlight-teal {
    background: var(--teal);
    border-color: var(--teal-dark);
    color: #fff;
  }
  .step-content { flex: 1; }
  .step-text { font-size: 14px; line-height: 1.65; color: var(--ink); }
  .step-note {
    margin-top: 6px;
    font-size: 12px;
    color: #888;
    font-style: italic;
    padding: 5px 10px;
    background: var(--cream);
    border-radius: 2px;
  }
  .step-note.warning {
    background: var(--orange-light);
    color: var(--orange);
    font-style: normal;
    font-weight: 500;
    border-left: 2px solid var(--orange);
  }
  .step-note.tip {
    background: var(--green-light);
    color: var(--green);
    font-style: normal;
    border-left: 2px solid var(--green);
  }

  /* DATA TABLE */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13.5px;
    margin: 16px 0;
  }
  .data-table th {
    background: var(--ink);
    color: #fff;
    padding: 10px 14px;
    text-align: left;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.08em;
  }
  .data-table td {
    padding: 10px 14px;
    border-bottom: 1px solid var(--rule);
    vertical-align: middle;
  }
  .data-table tr:nth-child(even) td { background: var(--cream); }
  .data-table td.label-cell {
    font-weight: 500;
    color: #333;
    font-size: 13px;
  }
  .data-table td.label-cell .sub {
    display: block;
    font-size: 11px;
    color: #aaa;
    font-weight: 400;
    margin-top: 1px;
  }
  .data-table input[type="text"],
  .data-table input[type="number"],
  .data-table select,
  .data-table textarea {
    width: 100%;
    box-sizing: border-box;
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 6px 10px;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    background: #fff;
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .data-table input[type="text"].mono,
  .data-table input[type="number"] {
    font-family: 'JetBrains Mono', monospace;
  }
  .data-table select { cursor: pointer; }
  .data-table input:focus,
  .data-table select:focus,
  .data-table textarea:focus {
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(26,74,122,0.1);
  }
  .data-table td.group-header {
    background: var(--ink);
    color: #6fcf6f;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    padding: 7px 14px;
  }

  /* QUESTION BLOCKS */
  .q-block {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px dashed var(--rule);
  }
  .q-block:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
  .q-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--blue);
    margin-bottom: 6px;
  }
  .q-text {
    font-size: 14px;
    line-height: 1.65;
    color: var(--ink);
    margin-bottom: 10px;
  }
  .q-sub {
    font-size: 13.5px;
    color: #444;
    margin: 6px 0 8px 12px;
    line-height: 1.6;
  }
  textarea.open-response {
    width: 100%;
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 12px 14px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    line-height: 1.65;
    color: var(--ink);
    background: #fff;
    resize: vertical;
    min-height: 90px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  textarea.open-response:focus {
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(26,74,122,0.1);
  }

  /* AI FEEDBACK BUTTON */
  .ai-btn {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    margin-top: 8px;
    padding: 7px 14px;
    background: var(--blue-light);
    border: 1px solid rgba(26,74,122,0.3);
    border-radius: 3px;
    font-size: 12px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--blue);
    cursor: pointer;
    transition: all 0.18s;
    font-weight: 600;
    letter-spacing: 0.05em;
  }
  .ai-btn:hover { background: rgba(26,74,122,0.15); }
  .ai-feedback-area {
    margin-top: 10px;
    padding: 14px 16px;
    background: var(--blue-light);
    border-left: 3px solid var(--blue);
    border-radius: 3px;
    font-size: 13.5px;
    line-height: 1.68;
    color: #2a3a50;
    display: none;
  }
  .ai-feedback-area.visible { display: block; }

  /* NAVIGATION BUTTON */
  .nav-row {
    display: flex;
    justify-content: flex-end;
    margin-top: 24px;
    gap: 12px;
  }
  .nav-btn {
    padding: 11px 28px;
    border-radius: 3px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.18s;
    border: none;
  }
  .nav-btn-primary {
    background: var(--accent);
    color: #fff;
  }
  .nav-btn-primary:hover { background: var(--accent-dark); }
  .nav-btn-secondary {
    background: var(--cream);
    color: var(--ink);
    border: 1px solid var(--border);
  }
  .nav-btn-secondary:hover { background: var(--border); }

  /* PERIODIC TABLE */
  .ptable-container {
    overflow-x: auto;
    margin: 16px 0;
  }
  .ptable {
    display: grid;
    grid-template-columns: repeat(18, 1fr);
    gap: 3px;
    min-width: 720px;
  }
  .pt-cell {
    aspect-ratio: 1;
    border: 1px solid #ddd;
    border-radius: 2px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 7px;
    cursor: pointer;
    transition: all 0.2s;
    background: #f8f8f8;
    padding: 2px;
    position: relative;
    min-width: 34px;
  }
  .pt-cell:hover { transform: scale(1.15); z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
  .pt-cell .at-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 5.5px;
    color: #999;
    line-height: 1;
  }
  .pt-cell .sym {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    color: var(--ink);
    line-height: 1.1;
  }
  .pt-cell .el-name {
    font-size: 5px;
    color: #777;
    line-height: 1;
    text-align: center;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: 100%;
    text-align: center;
  }
  .pt-empty { background: transparent !important; border: none !important; cursor: default; }
  .pt-empty:hover { transform: none !important; box-shadow: none !important; }

  /* Color-coding states for periodic table */
  .pt-cell.marked-green {
    background: #bbdefb !important;
    border-color: #1565c0 !important;
  }
  .pt-cell.marked-green .sym { color: #0d47a1; }
  .pt-cell.marked-red {
    background: #f9c8c8 !important;
    border-color: #c0392b !important;
  }
  .pt-cell.marked-red .sym { color: #7f0000; }

  /* LEGEND */
  .pt-legend {
    display: flex;
    gap: 20px;
    margin-top: 12px;
    flex-wrap: wrap;
  }
  .pt-legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: #444;
  }
  .pt-legend-swatch {
    width: 18px;
    height: 18px;
    border-radius: 3px;
    border: 1.5px solid;
  }

  /* FOOD LABEL ANALYZER */
  .label-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 16px 0;
  }

  .submit-section {
    background: var(--ink);
    border-radius: 4px;
    padding: 28px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    margin: 24px 0;
  }
  .submit-info { color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.6; }
  .submit-info strong { color: #fff; display: block; margin-bottom: 4px; font-size: 15px; }
  .submit-main-btn {
    padding: 14px 32px;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 3px;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    letter-spacing: 0.05em;
    transition: background 0.2s;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .submit-main-btn:hover { background: var(--accent-dark); }
  .submit-main-btn:disabled { background: #aaa; cursor: not-allowed; }

  /* REFERENCE TAB */
  .ref-pill {
    padding: 5px 14px;
    border-radius: 20px;
    border: 1.5px solid var(--border);
    background: white;
    font-family: 'DM Sans', sans-serif;
    font-size: 12.5px;
    cursor: pointer;
    transition: all 0.15s;
    font-weight: 500;
  }
  .ref-pill:hover { border-color: var(--blue); color: var(--blue); }
  .ref-pill-active { background: var(--ink); color: white; border-color: var(--ink); }
  .ref-pill-macro.ref-pill-active { background: var(--teal); border-color: var(--teal); }
  .ref-pill-micro.ref-pill-active { background: var(--blue); border-color: var(--blue); }
  .ref-pill-toxic.ref-pill-active { background: var(--red); border-color: var(--red); }
  .ref-card {
    border: 1.5px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: white;
    transition: box-shadow 0.15s;
    cursor: pointer;
  }
  .ref-card:hover { box-shadow: 0 4px 16px rgba(26,74,122,0.12); }
  .ref-card-header {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 16px;
  }
  .ref-card-sym {
    font-family: 'JetBrains Mono', monospace;
    font-size: 22px;
    font-weight: 700;
    width: 48px;
    height: 48px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .ref-card-sym.macro { background: #e0f7fa; color: var(--teal); }
  .ref-card-sym.micro { background: #e3f2fd; color: var(--blue); }
  .ref-card-sym.toxic { background: #fce4ec; color: var(--red); }
  .ref-card-meta { flex: 1; }
  .ref-card-name { font-weight: 700; font-size: 15px; color: var(--ink); }
  .ref-card-atnum { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #aaa; }
  .ref-card-tag {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 2px 8px;
    border-radius: 10px;
  }
  .ref-card-tag.macro { background: #e0f7fa; color: var(--teal); }
  .ref-card-tag.micro { background: #e3f2fd; color: var(--blue); }
  .ref-card-tag.toxic { background: #fce4ec; color: var(--red); }
  .ref-card-body {
    padding: 0 16px 14px;
    font-size: 13px;
    line-height: 1.65;
    display: none;
    border-top: 1px solid var(--rule);
    margin-top: 2px;
  }
  .ref-card-body.open { display: block; }
  .ref-card-section { margin-top: 10px; }
  .ref-card-section-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 3px;
  }
  .ref-card-hook {
    background: var(--cream);
    border-left: 3px solid var(--gold);
    padding: 8px 12px;
    margin-top: 10px;
    font-size: 12.5px;
    font-style: italic;
    color: #555;
    border-radius: 0 4px 4px 0;
  }
  .ref-fortify-tag {
    display: inline-block;
    background: #f3e5f5;
    color: #6a1b9a;
    font-size: 11px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 10px;
    margin: 2px 2px 0 0;
  }

  /* SCORE PANEL */
  .score-panel {
    background: var(--paper);
    border: 1px solid var(--border);
    border-radius: 4px;
    box-shadow: var(--shadow);
    overflow: hidden;
    display: none;
  }
  .score-panel.visible { display: block; }
  .score-header {
    background: var(--ink);
    padding: 18px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
  }
  .score-header h3 {
    font-family: 'Source Serif 4', serif;
    font-size: 18px;
    color: #fff;
    font-weight: 600;
  }
  .score-bar-wrap {
    flex: 1;
    background: rgba(255,255,255,0.12);
    border-radius: 2px;
    height: 8px;
    overflow: hidden;
  }
  .score-bar {
    height: 100%;
    border-radius: 2px;
    width: 0%;
    transition: width 0.8s ease;
  }
  .score-body { padding: 20px 24px; font-size: 13.5px; line-height: 1.7; }

  /* FEEDBACK REPORT */
  .feedback-panel {
    background: var(--paper);
    border: 1px solid var(--border);
    border-top: 3px solid var(--blue);
    border-radius: 4px;
    box-shadow: var(--shadow);
    overflow: hidden;
    display: none;
  }
  .feedback-panel-header {
    padding: 16px 24px;
    background: var(--blue-light);
    border-bottom: 1px solid rgba(26,74,122,0.15);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .feedback-panel-header h3 {
    font-family: 'Source Serif 4', serif;
    font-size: 16px;
    font-weight: 600;
    color: var(--blue);
  }
  .feedback-body { padding: 20px 24px; font-size: 14px; line-height: 1.72; color: var(--ink); }

  /* FOOD ITEM INPUT AREA */
  .food-meta-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 16px;
    margin-bottom: 20px;
  }
  .form-field label {
    display: block;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #888;
    margin-bottom: 4px;
    font-family: 'JetBrains Mono', monospace;
  }
  .form-field input, .form-field select {
    width: 100%;
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 8px 12px;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    background: #fff;
    color: var(--ink);
    outline: none;
    transition: border-color 0.2s;
  }
  .form-field input:focus, .form-field select:focus { border-color: var(--blue); }

  /* DYNAMIC MINERAL ROWS */
  .mineral-add-row {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    align-items: center;
  }
  .add-row-btn {
    padding: 7px 16px;
    background: var(--cream);
    border: 1px dashed var(--border);
    border-radius: 3px;
    font-size: 12px;
    font-family: 'JetBrains Mono', monospace;
    cursor: pointer;
    color: #666;
    transition: all 0.18s;
  }
  .add-row-btn:hover { background: var(--green-light); border-color: var(--green); color: var(--green); }

  /* VALIDATION INDICATOR */
  .val-indicator {
    display: none;
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    padding: 3px 8px;
    border-radius: 2px;
    margin-top: 4px;
  }
  .val-ok { background: var(--green-light); color: var(--green); display: block; }
  .val-warn { background: var(--orange-light); color: var(--orange); display: block; }
  .val-err { background: var(--red-light); color: var(--red); display: block; }

  /* AI POLICY BANNER */
  .ai-policy-row {
    display: flex;
    gap: 10px;
    margin: 16px 0;
    flex-wrap: wrap;
  }
  .ai-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    border-radius: 2px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .ai-tag-no { background: var(--red-light); color: var(--red); }
  .ai-tag-yes { background: var(--green-light); color: var(--green); }

  /* MATERIALS */
  .materials-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-top: 4px;
  }
  .mat-group h4 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: #888;
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid var(--rule);
  }
  .mat-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 0;
    font-size: 13.5px;
    color: var(--ink);
    border-bottom: 1px dashed var(--rule);
  }
  .mat-item:last-child { border-bottom: none; }
  .mat-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* OBJECTIVES */
  .obj-list { list-style: none; display: flex; flex-direction: column; gap: 8px; }
  .obj-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 13.5px;
    line-height: 1.6;
    color: #333;
  }
  .obj-dot {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--green-light);
    color: var(--green);
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-top: 1px;
  }

  /* RUBRIC TABLE */
  .rubric-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13.5px;
    margin-top: 12px;
  }
  .rubric-table th {
    background: var(--ink);
    color: #fff;
    padding: 9px 14px;
    text-align: left;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.08em;
  }
  .rubric-table td {
    padding: 9px 14px;
    border-bottom: 1px solid var(--rule);
    font-size: 13px;
  }
  .rubric-table tr:nth-child(even) td { background: var(--cream); }
  .rubric-pts {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    color: var(--blue);
    white-space: nowrap;
  }
  .rubric-total {
    background: var(--ink) !important;
    color: #6fcf6f !important;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
  }

  /* SUBMIT BUTTON */
  .submit-btn {
    width: 100%;
    padding: 16px;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 4px;
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.18s;
    margin-top: 20px;
  }
  .submit-btn:hover { background: var(--accent-dark); }
  .submit-btn:disabled { background: #aaa; cursor: not-allowed; }

  /* ATTEMPT COUNTER */
  .attempt-status {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-top: 8px;
  }

  /* INVENTORY FILTER BUTTONS */
  .inv-filter-btn {
    padding: 6px 13px;
    border: 2px solid var(--blue);
    background: white;
    color: var(--blue);
    border-radius: 20px;
    cursor: pointer;
    font-weight: 600;
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.18s;
  }
  .inv-filter-btn:hover, .inv-filter-btn.inv-active {
    background: var(--blue);
    color: white;
  }
  .inv-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
  }
  .inv-type-fortified { background: #e1f5fe; color: #0277bd; }
  .inv-type-wholefood { background: #f1f8e9; color: #558b2f; }
  .inv-type-highrisk  { background: #fce4ec; color: #c2185b; }
  .inv-risk-low       { background: #c8e6c9; color: #2e7d32; }
  .inv-risk-flag      { background: #ffccbc; color: #d84315; }

  /* PHOTO NOTE */
  .photo-note {
    background: var(--orange-light);
    border: 1px solid rgba(230,81,0,0.2);
    border-left: 3px solid var(--orange);
    border-radius: 3px;
    padding: 14px 18px;
    font-size: 13px;
    color: #3e2000;
    line-height: 1.6;
    margin: 16px 0;
  }
  .photo-note strong { color: var(--orange); }

  /* INLINE ELEMENT BADGE */
  .el-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: var(--cream);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 2px 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    font-weight: 600;
    color: var(--ink);
    margin: 0 2px;
  }
  .el-badge.nutrient { background: var(--teal-light); border-color: rgba(21,101,192,0.3); color: var(--teal); }
  .el-badge.toxin { background: var(--red-light); border-color: rgba(192,57,43,0.3); color: var(--red); }

  /* RADIO/CHECKBOX */
  .radio-group, .check-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
  }
  .radio-item, .check-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 13.5px;
    line-height: 1.55;
    cursor: pointer;
  }
  .radio-item input, .check-item input {
    margin-top: 3px;
    flex-shrink: 0;
    accent-color: var(--blue);
  }

  /* MULTIPLE CHOICE */
  .mc-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin: 12px 0;
  }
  .mc-option {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 14px;
    border: 2px solid var(--border);
    border-radius: 7px;
    cursor: pointer;
    font-size: 13.5px;
    line-height: 1.55;
    transition: border-color 0.18s, background 0.18s;
    background: white;
  }
  .mc-option:hover {
    border-color: var(--blue);
    background: var(--teal-light);
  }
  .mc-option input[type="radio"] {
    margin-top: 3px;
    flex-shrink: 0;
    accent-color: var(--blue);
  }
  .mc-option.mc-selected {
    border-color: var(--blue);
    background: var(--teal-light);
  }
  .mc-option.mc-correct {
    border-color: var(--accent);
    background: var(--accent-light);
  }
  .mc-option.mc-incorrect {
    border-color: var(--red);
    background: var(--red-light);
  }
  .mc-reveal {
    display: none;
    margin-top: 12px;
    padding: 10px 14px;
    border-left: 4px solid var(--blue);
    background: var(--teal-light);
    font-size: 13px;
    border-radius: 0 6px 6px 0;
    line-height: 1.6;
  }
  .mc-reveal.show { display: block; }

  /* MATCHING */
  .matching-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 6px;
    margin: 12px 0;
  }
  .matching-table td {
    padding: 8px 12px;
    font-size: 13.5px;
    vertical-align: middle;
  }
  .matching-table .match-term {
    width: 45%;
    background: var(--cream);
    border: 1.5px solid var(--border);
    border-radius: 6px 0 0 6px;
    font-weight: 600;
    line-height: 1.45;
  }
  .matching-table .match-connector {
    width: 5%;
    text-align: center;
    color: var(--rule);
    font-size: 16px;
  }
  .matching-table .match-select-cell {
    width: 50%;
  }
  .match-select {
    width: 100%;
    padding: 7px 10px;
    border: 2px solid var(--border);
    border-radius: 0 6px 6px 0;
    font-family: 'DM Sans', sans-serif;
    font-size: 13px;
    background: white;
    cursor: pointer;
    outline: none;
    transition: border-color 0.18s;
  }
  .match-select:focus { border-color: var(--blue); }
  .match-select.match-correct { border-color: var(--accent); background: var(--accent-light); }
  .match-select.match-incorrect { border-color: var(--red); background: var(--red-light); }

  /* TRUE / FALSE */
  .tf-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin: 12px 0;
  }
  .tf-item {
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border: 1.5px solid var(--border);
    border-radius: 7px;
    background: white;
    font-size: 13.5px;
    line-height: 1.5;
    transition: background 0.15s;
  }
  .tf-item:hover { background: #fafaf7; }
  .tf-btn-group {
    display: flex;
    gap: 6px;
  }
  .tf-btn {
    padding: 5px 14px;
    border: 2px solid var(--border);
    border-radius: 5px;
    cursor: pointer;
    font-weight: 700;
    font-size: 12.5px;
    font-family: 'DM Sans', sans-serif;
    background: white;
    transition: all 0.15s;
    letter-spacing: 0.03em;
  }
  .tf-btn.tf-true-btn:hover, .tf-btn.tf-true-selected {
    background: var(--accent-light);
    border-color: var(--accent);
    color: var(--accent-dark);
  }
  .tf-btn.tf-false-btn:hover, .tf-btn.tf-false-selected {
    background: var(--red-light);
    border-color: var(--red);
    color: var(--red);
  }
  .tf-item.tf-answered-correct { border-color: var(--accent); background: var(--accent-light); }
  .tf-item.tf-answered-incorrect { border-color: var(--red); background: var(--red-light); }

  /* INLINE SHORT INPUT */
  .inline-input {
    display: inline-block;
    border: none;
    border-bottom: 1.5px solid var(--border);
    background: transparent;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 2px 4px;
    min-width: 140px;
    outline: none;
    transition: border-color 0.2s;
  }
  .inline-input:focus { border-color: var(--blue); }

  /* TOXIC ELEMENT CARDS */
  .toxin-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin: 16px 0;
  }
  .toxin-card {
    background: #fff;
    border: 1.5px solid rgba(192,57,43,0.3);
    border-radius: 4px;
    padding: 14px;
    text-align: center;
  }
  .toxin-sym {
    font-family: 'JetBrains Mono', monospace;
    font-size: 22px;
    font-weight: 600;
    color: var(--red);
    line-height: 1.1;
    margin-bottom: 2px;
  }
  .toxin-name {
    font-size: 11px;
    color: #666;
    margin-bottom: 8px;
  }
  .toxin-field label {
    display: block;
    font-size: 9px;
    font-family: 'JetBrains Mono', monospace;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 3px;
  }
  .toxin-field input {
    width: 100%;
    border: 1px solid rgba(192,57,43,0.25);
    border-radius: 2px;
    padding: 4px 6px;
    font-size: 11px;
    background: var(--red-light);
    color: #4a1a16;
    outline: none;
    font-family: 'DM Sans', sans-serif;
    margin-bottom: 4px;
  }
  .toxin-field input:focus { border-color: var(--red); }

  @media (max-width: 700px) {
    .header-inner { flex-direction: column; align-items: flex-start; }
    .student-bar-inner { grid-template-columns: 1fr; }
    .main { padding: 20px; }
    .concept-grid { grid-template-columns: 1fr; }
    .toxin-grid { grid-template-columns: 1fr 1fr; }
    .food-meta-grid { grid-template-columns: 1fr; }
    .label-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<div class="lab-header">
  <div class="header-inner">
    <div>
      <div class="lab-tag">CHEM 100 &mdash; Lab 2</div>
      <div class="lab-title">Food Elements Investigation</div>
      <div class="lab-subtitle">Nutrition, Labels &amp; Food Safety</div>
    </div>
    <div class="header-meta">
      Carson-Newman University<br>
      Chemistry in Society<br>
      Lab Report | 55 pts
    </div>
  </div>
</div>

<!-- STUDENT BAR -->
<div class="student-bar">
  <div class="student-bar-inner">
    <div class="field-group">
      <label>Student Name</label>
      <input type="text" id="student-name" placeholder="Last, First">
    </div>
    <div class="field-group">
      <label>Lab Section</label>
      <input type="text" id="student-section" placeholder="e.g. CHEM 100-03">
    </div>
    <div class="field-group">
      <label>Date</label>
      <input type="text" id="student-date" placeholder="MM/DD/YYYY">
    </div>
  </div>
</div>

<!-- TAB NAVIGATION -->
<div class="tab-nav-wrap">
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab(0)"><span class="tab-num">00</span>Intro</button>
    <button class="tab-btn" onclick="switchTab(1)"><span class="tab-num">01</span>Background</button>
    <button class="tab-btn" onclick="switchTab(2)"><span class="tab-num">02</span>Procedure</button>
    <button class="tab-btn" onclick="switchTab(3)"><span class="tab-num">03</span>Data Tables</button>
    <button class="tab-btn" onclick="switchTab(4)"><span class="tab-num">04</span>Reference</button>
    <button class="tab-btn" onclick="switchTab(5)"><span class="tab-num">05</span>Periodic Table</button>
    <button class="tab-btn" onclick="switchTab(6)"><span class="tab-num">06</span>Analysis</button>
    <button class="tab-btn" onclick="switchTab(7)"><span class="tab-num">07</span>Inventory</button>
  </div>
</div>

<!-- ============================================================ TAB 0: INTRO ============================================================ -->
<div id="tab-0" class="tab-panel active">
  <div class="main">
    <!-- SCENARIO -->
    <div class="scenario-banner">
      <div class="scenario-tag">Bracket City Scenario &mdash; Food Safety Alert</div>
      <div class="scenario-title">Heavy Metals Detected in Food Shipments</div>
      <div class="scenario-body">
        Welcome back, Food Safety Chemist! After last week's density investigation, we have more urgent news. Bracket City's lab has detected heavy metals in several food shipments. We need to know which elements <em>should</em> be in food (essential nutrients), which elements are <em>dangerous</em> contaminants (toxic metals), and how to evaluate both fortified and whole foods so we can make safe, evidence-based distribution decisions for our 5,000 residents.
      </div>
      <div class="scenario-mission">
        <strong>Your Mission:</strong> Research essential and toxic elements, color-code the periodic table to reveal the chemistry behind which elements belong in food and which don't, analyze your own food's nutrition label, and use the Bracket City inventory to make evidence-based distribution recommendations for 5,000 residents &mdash; especially children.
      </div>
      <div style="margin-top:14px; padding:12px 16px; background:rgba(255,255,255,0.06); border-radius:3px; font-size:12.5px; color:rgba(255,255,255,0.65); line-height:1.7;">
        <strong style="color:rgba(255,255,255,0.9); display:block; margin-bottom:6px; font-family:'JetBrains Mono',monospace; font-size:10px; letter-spacing:0.14em; text-transform:uppercase;">Color Coding Used in This Lab</strong>
        <span style="display:inline-flex; align-items:center; gap:6px; margin-right:18px;"><span style="display:inline-block; width:12px; height:12px; border-radius:2px; background:#bbdefb; border:1px solid #1565c0;"></span><strong style="color:#90caf9;">Blue</strong> &mdash; Essential nutrient elements (mark on periodic table)</span>
        <span style="display:inline-flex; align-items:center; gap:6px; margin-right:18px;"><span style="display:inline-block; width:12px; height:12px; border-radius:2px; background:#f9c8c8; border:1px solid #c0392b;"></span><strong style="color:#ffaaaa;">Red</strong> &mdash; Toxic contaminant elements (mark on periodic table)</span>
        <span style="display:inline-flex; align-items:center; gap:6px;"><span style="display:inline-block; width:12px; height:12px; border-radius:2px; background:#6fcf6f; border:1px solid #2e7d32;"></span><strong style="color:#6fcf6f;">Green</strong> &mdash; Section markers in the procedure</span>
      </div>
    </div>

    <!-- LEARNING OBJECTIVES -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">A</div>
        <div class="section-title">Learning Objectives</div>
        <div class="section-badge badge-green">By End of Lab</div>
      </div>
      <div class="section-body">
        <ul class="obj-list">
          <li class="obj-item"><span class="obj-dot">1</span> Use the periodic table to identify and compare elements found in food, explaining why an element's group and period predict its biological behavior</li>
          <li class="obj-item"><span class="obj-dot">2</span> Distinguish essential nutrient elements from toxic contaminant elements and explain the chemical mimicry mechanism that makes toxic metals dangerous</li>
          <li class="obj-item"><span class="obj-dot">3</span> Read a Nutrition Facts label and ingredient list using chemical knowledge — identifying elements by symbol, classifying % DV, and recognizing fortification compounds by name</li>
          <li class="obj-item"><span class="obj-dot">4</span> Apply element chemistry to evaluate your own food and compare it against inventory items using nutrient content, contamination risk, and shelf life</li>
          <li class="obj-item"><span class="obj-dot">5</span> Make evidence-based food distribution recommendations for a real food access scenario, citing specific chemical reasons and identifying vulnerable populations</li>
        </ul>
      </div>
    </div>

    <!-- MATERIALS -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">B</div>
        <div class="section-title">Materials</div>
        <div class="section-badge badge-blue">Per Student</div>
      </div>
      <div class="section-body">
        <div class="materials-grid">
          <div class="mat-group">
            <h4>Equipment</h4>
            <div class="mat-item"><div class="mat-dot" style="background:#1a4a7a;"></div> Digital food scale (from Lab 1)</div>
            <div class="mat-item"><div class="mat-dot" style="background:#2e7d32;"></div> ONE packaged food item with nutrition label</div>
            <div class="mat-item"><div class="mat-dot" style="background:#b8860b;"></div> Green and red highlighters or colored pencils</div>
            <div class="mat-item"><div class="mat-dot" style="background:#5b2d8e;"></div> Periodic table (provided in Tab 05 &mdash; built into this document)</div>
          </div>
          <div class="mat-group">
            <h4>References &amp; Access</h4>
            <div class="mat-item"><div class="mat-dot" style="background:#c0392b;"></div> Element Reference tab (Tab 04 &mdash; built into this document)</div>
            <div class="mat-item"><div class="mat-dot" style="background:#e65100;"></div> Bracket City Food Bank Inventory <span style="font-size:11px; color:var(--teal);">(Tab 07 — built into this document)</span></div>
            <div class="mat-item"><div class="mat-dot" style="background:#1a6b3c;"></div> USDA FoodData Central (fdc.nal.usda.gov) for unlabeled foods</div>
            <div class="mat-item"><div class="mat-dot" style="background:#888;"></div> Camera or phone for food photo (submitted to Canvas)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- OVERVIEW -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">C</div>
        <div class="section-title">Lab Overview &amp; Timeline</div>
        <div class="section-badge badge-gold">120 min total</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-gold">
          <div class="ref-box-title">AI Use Policy</div>
          <p>Parts 1 and 2 (element research) require your own reading from the Reference tab — AI tools are NOT permitted for these sections. Part 3 (personal food) allows AI for calculations only, such as unit conversions or % DV math. The Discussion Board activity, if assigned, requires AI and you must cite which tool you used.</p>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px; margin-top:8px;">
          <div style="display:flex; gap:14px; align-items:center; padding:10px 14px; background:var(--cream); border-radius:3px; font-size:13.5px;">
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; color:#888; width:70px; flex-shrink:0;">20 min</div>
            <div><strong>Part 1</strong> &mdash; Research essential nutrient elements (Data Table 1, periodic table blue), using Tab 04</div>
            <div class="ai-tag ai-tag-no" style="margin-left:auto;">No AI</div>
          </div>
          <div style="display:flex; gap:14px; align-items:center; padding:10px 14px; background:var(--cream); border-radius:3px; font-size:13.5px;">
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; color:#888; width:70px; flex-shrink:0;">15 min</div>
            <div><strong>Part 2</strong> &mdash; Research toxic contaminant elements (Data Table 1, periodic table red), using Tab 04</div>
            <div class="ai-tag ai-tag-no" style="margin-left:auto;">No AI</div>
          </div>
          <div style="display:flex; gap:14px; align-items:center; padding:10px 14px; background:var(--cream); border-radius:3px; font-size:13.5px;">
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; color:#888; width:70px; flex-shrink:0;">25 min</div>
            <div><strong>Part 3</strong> &mdash; Personal food: weigh, label-read, decode ingredients, compare to Bracket City inventory (Data Tables 2 &amp; 3)</div>
            <div class="ai-tag ai-tag-yes" style="margin-left:auto;">Calc only</div>
          </div>
          <div style="display:flex; gap:14px; align-items:center; padding:10px 14px; background:var(--cream); border-radius:3px; font-size:13.5px;">
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; color:#888; width:70px; flex-shrink:0;">40 min</div>
            <div><strong>Analysis</strong> &mdash; Q1 (periodic table patterns + mimicry), Q2 (food + inventory analysis), Q3 (contamination risk), Conclusion</div>
            <div class="ai-tag ai-tag-yes" style="margin-left:auto;">Feedback only</div>
          </div>
          <div style="display:flex; gap:14px; align-items:center; padding:10px 14px; background:#f0f0f0; border-radius:3px; font-size:13px; color:#666;">
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; color:#aaa; width:70px; flex-shrink:0;">After submit</div>
            <div><strong>Part 4 (If assigned)</strong> &mdash; Canvas Discussion Board: The Director's Memo &mdash; defend 3 inventory picks with chemical justification, then challenge a classmate's choice</div>
            <div class="ai-tag ai-tag-yes" style="margin-left:auto;">Post-lab</div>
          </div>
        </div>
      </div>
    </div>

    <!-- GRADING -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">D</div>
        <div class="section-title">Grading Breakdown</div>
        <div class="section-badge badge-blue">55 pts total</div>
      </div>
      <div class="section-body">
        <table class="data-table" style="font-size:13px;">
          <thead>
            <tr>
              <th style="width:12%;">Tab</th>
              <th style="width:44%;">Component</th>
              <th style="width:22%;">How It's Scored</th>
              <th style="width:10%; text-align:center;">Pts</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>03</td>
              <td><strong>Data Table 1</strong> — Elements in Food (14 rows: 10 nutrients + 4 toxic metals)</td>
              <td>Completeness of function/danger + source fields</td>
              <td style="text-align:center;">10</td>
            </tr>
            <tr>
              <td>03</td>
              <td><strong>Data Table 2</strong> — Your Personal Food (weigh + label minerals)</td>
              <td>Food named, serving recorded, 6+ minerals entered</td>
              <td style="text-align:center;">6</td>
            </tr>
            <tr>
              <td>03</td>
              <td><strong>Data Table 3</strong> — Bracket City Inventory Comparison (3 rows)</td>
              <td>Fortified pick, whole food pick, personal food row complete</td>
              <td style="text-align:center;">4</td>
            </tr>
            <tr>
              <td>05</td>
              <td><strong>Periodic Table</strong> — 10 blue (essential) + 4 red (toxic)</td>
              <td>Correct elements marked in correct color</td>
              <td style="text-align:center;">5</td>
            </tr>
            <tr style="background:#f0f8ff;">
              <td>06</td>
              <td><strong>Q1</strong> — Periodic Table Patterns + Mimicry Matching (pattern sentence, MC, 4 matches)</td>
              <td>Pattern written, MC correct, matching accuracy</td>
              <td style="text-align:center;">6</td>
            </tr>
            <tr style="background:#f0f8ff;">
              <td>06</td>
              <td><strong>Q2</strong> — Your Food Analysis + Inventory Comparison (4 parts: classify, minerals, inventory path, written paragraph)</td>
              <td>Data grid + written analysis depth and specificity</td>
              <td style="text-align:center;">10</td>
            </tr>
            <tr style="background:#f0f8ff;">
              <td>06</td>
              <td><strong>Q3</strong> — Contamination Risk + Storage Chemistry (4 T/F + flag item + written explanation)</td>
              <td>T/F accuracy, item flagged, written explanation depth</td>
              <td style="text-align:center;">8</td>
            </tr>
            <tr style="background:#f0f8ff;">
              <td>06</td>
              <td><strong>Conclusion</strong> — Periodic table chemistry + personal food insight + Bracket City recommendation</td>
              <td>All 3 parts addressed with specific data and chemical reasoning</td>
              <td style="text-align:center;">6</td>
            </tr>
            <tr style="background:#fffde7; font-weight:600;">
              <td colspan="3" style="text-align:right; padding-right:16px;">Total</td>
              <td style="text-align:center;">55</td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top:12px; font-size:12px; color:#888; line-height:1.7;">
          <strong>Photo submission:</strong> Your food-on-scale photo is submitted directly to the Canvas assignment — it is graded separately from this document and is required for full credit on Data Table 2.<br>
          <strong>AI feedback buttons</strong> in the Analysis tab provide formative feedback only — they do not affect your score. Your score is calculated at submission.
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-primary" onclick="switchTab(1)">Continue to Background &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 1: BACKGROUND ============================================================ -->
<div id="tab-1" class="tab-panel">
  <div class="main">

  <!-- REAL WORLD CONTEXT -->
  <div style="background:#fff; border:1px solid #c8bfa8; border-left:4px solid var(--blue); border-radius:4px; padding:22px 26px; margin-bottom:24px; box-shadow:0 2px 12px rgba(26,26,46,0.07);">
    <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.16em; text-transform:uppercase; color:var(--blue); margin-bottom:12px;">Real-World Context &mdash; Why This Matters</div>

    <p style="font-size:14px; line-height:1.75; color:#2a2a3e; margin-bottom:14px;">
      Picture a parent buying baby food at the grocery store. They check the label, see it lists iron and zinc, and assume it's safe. What they can't see is that the food also contains lead, arsenic, cadmium, and mercury &mdash; at levels high enough to raise alarm. In 2021, a U.S. congressional investigation found that some of the most trusted baby food brands, including Gerber and Beech-Nut, <strong>already had their own test results showing toxic metal contamination and kept selling the products without telling anyone.</strong> The FDA responded by launching a program called <em>Closer to Zero</em> to push those levels down. As of 2025, no binding legal limits exist for most of these metals in children's food.
      <a href="https://blogs.edf.org/health/2021/02/11/house-oversight-committee-draws-renewed-attention-to-heavy-metals-in-baby-food-and-calls-for-fda-to-act/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[EDF &mdash; House Oversight &amp; Heavy Metals in Baby Food]</a>
      <a href="https://www.fda.gov/food/environmental-contaminants-food/closer-zero-reducing-childhood-exposure-contaminants-foods" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[FDA &mdash; Closer to Zero Initiative]</a>
    </p>

    <p style="font-size:14px; line-height:1.75; color:#2a2a3e; margin-bottom:14px;">
      This isn't just a policy problem on paper. In the fall of 2023, pediatricians in 33 states started seeing toddlers with dangerously high lead levels in their blood &mdash; some four times above the point where doctors get concerned. The culprit turned out to be cinnamon applesauce pouches sold at major stores. Lead had been added to the cinnamon during processing overseas, and nobody caught it until children were already harmed. Over 200 kids were affected before the products were pulled. <strong>Scientists and health agencies agree: there is no amount of lead that is safe for a child's brain.</strong> Even small exposures can permanently lower IQ, cause attention problems, and affect behavior for life.
      <a href="https://www.technologynetworks.com/applied-sciences/articles/heavy-metals-were-found-in-baby-food-what-is-the-fda-doing-about-it-388629" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[Technology Networks &mdash; FDA &amp; Heavy Metals, 2024]</a>
      <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC12293182/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[PMC &mdash; Heavy Metals &amp; Health Effects in Children]</a>
    </p>

    <p style="font-size:14px; line-height:1.75; color:#2a2a3e; margin-bottom:14px;">
      These risks don't hit everyone equally. Families with fewer resources tend to rely on a smaller set of foods &mdash; often cheaper, processed options &mdash; which means if those foods have a contamination problem, there's less variety to buffer the exposure. At the same time, those same families are more likely to have children who aren't getting enough iron, calcium, or zinc. Here's where the chemistry gets important: <strong>when the body is running low on an essential mineral, it becomes less picky and absorbs more of whatever looks chemically similar &mdash; including toxic metals.</strong> A child who isn't getting enough calcium absorbs more lead. A child low in iron takes up more arsenic. Being nutrient-poor and toxin-exposed aren't two separate problems. They reinforce each other.
      <a href="https://odphp.health.gov/healthypeople/priority-areas/social-determinants-health/literature-summaries/food-insecurity" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[Healthy People 2030 &mdash; Food Insecurity]</a>
      <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10972712/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[PMC &mdash; Food Insecurity &amp; Health Disparities]</a>
    </p>

    <p style="font-size:14px; line-height:1.75; color:#2a2a3e; margin-bottom:16px;">
      So where does chemistry come in? The periodic table isn't just a poster on a classroom wall. It's a map that tells you how elements behave in the body &mdash; which ones are needed, which ones are dangerous, and <em>why</em> the dangerous ones are so hard for the body to screen out. Learning to read a nutrition label through a chemistry lens means you can spot what's there, what's missing, and what the label isn't required to tell you at all. <strong>That's exactly the skill that food safety researchers, nutritionists, and public health workers use every day to protect communities like Bracket City.</strong>
      <a href="https://www.edf.org/health/heavy-metals-food" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[EDF &mdash; Heavy Metals in Food]</a>
      <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC8078867/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue); margin-left:4px;">[PMC &mdash; Toxic Mechanisms of Heavy Metals]</a>
    </p>

    <div style="border-top:1px dashed #d4c9b0; padding-top:14px;">
      <div style="font-family:'JetBrains Mono',monospace; font-size:9.5px; font-weight:600; letter-spacing:0.12em; text-transform:uppercase; color:#aaa; margin-bottom:8px;">Sources</div>
      <div style="display:flex; flex-direction:column; gap:4px;">
        <a href="https://oversightdemocrats.house.gov/sites/evo-subsites/democrats-oversight.house.gov/files/2021-02-04%20ECP%20Baby%20Food%20Staff%20Report.pdf" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">U.S. House Subcommittee on Economic and Consumer Policy &mdash; Baby Foods Are Tainted with Dangerous Levels of Arsenic, Lead, Cadmium, and Mercury (Feb. 2021)</a>
        <a href="https://www.fda.gov/food/environmental-contaminants-food/closer-zero-reducing-childhood-exposure-contaminants-foods" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">FDA &mdash; Closer to Zero: Reducing Childhood Exposure to Contaminants in Foods (2021&ndash;present)</a>
        <a href="https://www.technologynetworks.com/applied-sciences/articles/heavy-metals-were-found-in-baby-food-what-is-the-fda-doing-about-it-388629" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">Technology Networks &mdash; Heavy Metals Were Found in Baby Food &mdash; What Is the FDA Doing About It? (2024)</a>
        <a href="https://www.cdc.gov/lead-prevention/news/outbreak-applesauce-pouches.html" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">CDC &mdash; Lead and Chromium Poisoning Outbreak Linked to Cinnamon Applesauce Pouches (2023&ndash;2024)</a>
        <a href="https://odphp.health.gov/healthypeople/priority-areas/social-determinants-health/literature-summaries/food-insecurity" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">Healthy People 2030 &mdash; Food Insecurity Literature Summary (ODPHP / HHS)</a>
        <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10972712/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">PMC10972712 &mdash; Food Insecurity, Neighborhood Food Environment, and Health Disparities (NIH, 2024)</a>
        <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC12293182/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">PMC12293182 &mdash; Heavy Metals and Cardiovascular Effects in Children (2025)</a>
        <a href="https://www.edf.org/health/heavy-metals-food" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">Environmental Defense Fund (EDF) &mdash; Heavy Metals in Food</a>
        <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC8078867/" target="_blank" rel="noopener" style="font-family:'JetBrains Mono',monospace; font-size:10px; color:var(--blue); text-decoration:none; border-bottom:1px dotted var(--blue);">PMC8078867 &mdash; Toxic Mechanisms of Five Heavy Metals: Mercury, Lead, Chromium, Cadmium, and Arsenic (2021)</a>
      </div>
    </div>
  </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">1</div>
        <div class="section-title">The Periodic Table &amp; Food Safety</div>
        <div class="section-badge badge-blue">Concept Review</div>
      </div>
      <div class="section-body">
        <div class="ref-box">
          <div class="ref-box-title">Why the Periodic Table Matters Here</div>
          <p>Lead doesn't sneak into a child's body by accident &mdash; it gets in because the body genuinely can't tell it apart from calcium at the point of absorption. Both elements sit in the same column of the periodic table, which means they behave similarly in chemical reactions. The body is trying to absorb calcium for strong bones and teeth, and lead hitches a ride using the same pathway. Understanding where elements live on this table explains <em>why</em> certain toxins are so dangerous and so hard to block. That's the real reason chemists care about this chart.</p>
        </div>

        <div class="concept-grid">
          <div class="concept-card">
            <h4>Element Symbol</h4>
            <p>A 1&ndash;2 letter abbreviation used on food labels and in chemical formulas. These correspond directly to boxes on the periodic table.</p>
            <div class="example">Fe = Iron &mdash; Ca = Calcium</div>
          </div>
          <div class="concept-card">
            <h4>Atomic Number</h4>
            <p>The number of protons in each atom &mdash; this defines the element. No two elements share the same atomic number.</p>
            <div class="example">Ca: Z = 20 &mdash; Pb: Z = 82</div>
          </div>
          <div class="concept-card">
            <h4>Group (Column)</h4>
            <p>Elements in the same group have similar chemical behavior. This is why lead can mimic calcium in the body &mdash; they share a group.</p>
            <div class="example">Ca &amp; Pb: both Group 2</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">2</div>
        <div class="section-title">Essential Nutritional Elements</div>
        <div class="section-badge badge-teal">Mark BLUE on Periodic Table</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-teal">
          <div class="ref-box-title">Not Getting Enough Makes Things Worse</div>
          <p>Here's something that often surprises people: being low on a nutrient can actually make toxic exposure more dangerous, not less. When your body is running short on iron, it ramps up absorption of anything that looks chemically similar &mdash; and arsenic fits the profile closely enough to sneak in. Same with calcium and lead. So a child who isn't eating enough iron-rich food doesn't just develop anemia. They also become more vulnerable to the toxic metals already present in their environment and food supply. <strong>Deficiency and contamination aren't separate problems &mdash; they amplify each other.</strong> That's the core public health issue this lab is built around.</p>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin:16px 0;">
          <div>
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:var(--teal); margin-bottom:10px;">Macrominerals (larger amounts needed)</div>
            <div style="display:flex; flex-direction:column; gap:6px;">
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Ca</span> Calcium &mdash; bones, teeth, muscle contraction</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">P</span> Phosphorus &mdash; bones, DNA, ATP energy</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">K</span> Potassium &mdash; nerve signals, fluid balance</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Na</span> Sodium &mdash; fluid balance, nerve function</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Mg</span> Magnesium &mdash; enzyme activation, muscle</div>
            </div>
          </div>
          <div>
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:var(--teal); margin-bottom:10px;">Microminerals &mdash; trace amounts, equally critical</div>
            <div style="display:flex; flex-direction:column; gap:6px;">
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Fe</span> Iron &mdash; oxygen transport in blood (hemoglobin)</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Zn</span> Zinc &mdash; immune function, wound healing</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Cu</span> Copper &mdash; red blood cells, nerve function</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">I</span> Iodine &mdash; thyroid hormones</div>
              <div style="display:flex; align-items:center; gap:8px; font-size:13.5px;"><span class="el-badge nutrient">Se</span> Selenium &mdash; antioxidant enzymes</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">3</div>
        <div class="section-title">Toxic Contaminant Elements</div>
        <div class="section-badge badge-red">Mark RED on Periodic Table</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-red">
          <div class="ref-box-title">These Are the Four From the Headlines</div>
          <p>Lead, arsenic, mercury, and cadmium are the exact elements at the center of the 2021 baby food investigation and the 2023 cinnamon applesauce recall. None of them have any job in the body &mdash; they're not nutrients, they serve no function, and there is no safe amount for a child to consume. You'll never see them listed on a Nutrition Facts label, even if they're present. They get into food through contaminated soil, irrigation water, industrial pollution, and sometimes through deliberate adulteration (adding cheap ingredients to increase weight or profit). <strong>A child's body absorbs up to 50% of the lead it ingests</strong> &mdash; compared to about 10% in adults &mdash; which is why children are so much more vulnerable to the damage these elements cause.</p>
        </div>

        <div class="toxin-grid">
          <div class="toxin-card">
            <div class="toxin-sym">Pb</div>
            <div class="toxin-name">Lead &mdash; At. No. 82</div>
            <div class="toxin-field"><label>Primary target organ</label><input type="text" id="toxin-pb-organ" placeholder="e.g. nervous system"></div>
            <div class="toxin-field"><label>Common food source (research)</label><input type="text" id="toxin-pb-source" placeholder="from FDA/EPA"></div>
          </div>
          <div class="toxin-card">
            <div class="toxin-sym">As</div>
            <div class="toxin-name">Arsenic &mdash; At. No. 33</div>
            <div class="toxin-field"><label>Primary target organ</label><input type="text" id="toxin-as-organ" placeholder="e.g. nervous system"></div>
            <div class="toxin-field"><label>Common food source (research)</label><input type="text" id="toxin-as-source" placeholder="from FDA/EPA"></div>
          </div>
          <div class="toxin-card">
            <div class="toxin-sym">Hg</div>
            <div class="toxin-name">Mercury &mdash; At. No. 80</div>
            <div class="toxin-field"><label>Primary target organ</label><input type="text" id="toxin-hg-organ" placeholder="e.g. nervous system"></div>
            <div class="toxin-field"><label>Common food source</label><input type="text" id="toxin-hg-source" value="Large fish (tuna, swordfish)" readonly style="background:#f0f0f0;"></div>
          </div>
          <div class="toxin-card">
            <div class="toxin-sym">Cd</div>
            <div class="toxin-name">Cadmium &mdash; At. No. 48</div>
            <div class="toxin-field"><label>Primary target organ</label><input type="text" id="toxin-cd-organ" placeholder="e.g. kidneys"></div>
            <div class="toxin-field"><label>Common food source (research)</label><input type="text" id="toxin-cd-source" placeholder="from FDA/EPA"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">4</div>
        <div class="section-title">Reading Nutrition Labels Chemically</div>
        <div class="section-badge badge-blue">Label Literacy</div>
      </div>
      <div class="section-body">
        <div class="ref-box">
          <div class="ref-box-title">Labels Show You Some Things &mdash; But Not Everything</div>
          <p>Here's something worth knowing before you ever pick up a food label again: <strong>toxic heavy metals will never appear on a Nutrition Facts panel, even if they're in the food.</strong> If an element has a % Daily Value listed, that means it's recognized as a nutrient your body needs. Lead, arsenic, mercury, and cadmium have no Daily Value because they have no nutritional role &mdash; so the label has no place to put them, and no requirement to disclose them. Fortified foods intentionally add beneficial minerals and list them; contamination enters silently and isn't disclosed anywhere. Learning to read labels chemically means understanding both what you see and what the label was never designed to tell you.</p>
        </div>

        <div style="margin:16px 0;">
          <div style="font-family:'Source Serif 4',serif; font-size:15px; font-weight:600; margin-bottom:10px;">Fortified vs. Whole Foods</div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
            <div style="background:#fff; border:1px solid var(--border); border-radius:4px; padding:16px;">
              <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:var(--green); margin-bottom:8px;">Fortified Foods</div>
              <div style="font-size:13px; color:#444; line-height:1.65;">Nutrients have been <em>intentionally added</em> to increase nutritional value. Look for chemical compound names in the ingredient list: "ferrous sulfate," "calcium carbonate," "zinc oxide," "ferric orthophosphate," "reduced iron."</div>
            </div>
            <div style="background:#fff; border:1px solid var(--border); border-radius:4px; padding:16px;">
              <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:var(--blue); margin-bottom:8px;">Whole Foods</div>
              <div style="font-size:13px; color:#444; line-height:1.65;">Minerals present are <em>naturally occurring</em> within the food's biological structure. Nutrient amounts are typically lower per serving. These may spoil faster due to moisture, enzymatic activity, and cellular structure.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(0)">&larr; Back</button>
      <button class="nav-btn nav-btn-primary" onclick="switchTab(2)">Continue to Procedure &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 2: PROCEDURE ============================================================ -->
<div id="tab-2" class="tab-panel">
  <div class="main">

    <!-- PHOTO NOTE -->
    <div class="photo-note">
      <strong>Documentation Requirement:</strong> You are required to photograph your food item on the scale for submission. Steps where a photo is required are marked with a <strong>green step number</strong>. Submit photos separately through your Canvas assignment &mdash; they cannot be uploaded within this document.
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">P1</div>
        <div class="section-title">Part 1 &mdash; Essential Nutrient Elements</div>
        <div class="section-badge badge-teal">No AI</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-teal">
          <div class="ref-box-title">What You're Doing</div>
          <p>Learning which elements your body needs and why. Use the <strong>Reference tab (Tab 04)</strong> — filter by Macromineral or Micromineral and open each card. Read what the element does and where it comes from. Then write it in your own words in Data Table 1. The Reference tab content is drawn from NIH Office of Dietary Supplements fact sheets.</p>
        </div>

        <div class="proc-step">
          <div class="step-num highlight-teal">1</div>
          <div class="step-content">
            <div class="step-text">Open <strong>Tab 04 (Reference)</strong> and click the <strong>Macrominerals</strong> filter pill. Read each of the 5 macromineral cards — Calcium, Phosphorus, Potassium, Sodium, Magnesium. Then switch to <strong>Microminerals</strong> and read Iron, Zinc, Copper, Iodine, and Selenium.</div>
            <div class="step-note tip">You do not need to memorize the cards. Read them once, then switch to Data Table 1 and write what you remember in your own words. Going back and forth between tabs is part of the process.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num highlight-teal">2</div>
          <div class="step-content">
            <div class="step-text">Fill in Data Table 1 completely. Symbols and atomic numbers are pre-filled — focus on the <strong>Function in Body</strong> and <strong>Good Food Sources</strong> columns. Write in your own words, not copied from the card.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num highlight-teal">3</div>
          <div class="step-content">
            <div class="step-text">Go to the <strong>Periodic Table tab (Tab 05)</strong> and click each of the 10 essential elements to mark them <strong style="color:var(--blue);">BLUE</strong>. The counter at the top of the tab tracks your progress.</div>
            <div class="step-note tip">Take a moment before moving on: notice where the 10 essential nutrients land on the table. You will write about this pattern in Analysis Q1.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">P2</div>
        <div class="section-title">Part 2 &mdash; Toxic Contaminant Elements</div>
        <div class="section-badge badge-red">No AI</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-red">
          <div class="ref-box-title">What You're Doing</div>
          <p>Learning which elements are dangerous and why. Use the <strong>Reference tab (Tab 04)</strong> — each toxic metal card explains the danger mechanism, mimicry connection, and contaminated food sources in plain language. Read each card carefully before filling in the toxic elements section of <strong>Data Table 1</strong>. All Reference tab content is sourced from FDA, EPA, and ATSDR.</p>
        </div>

        <div class="proc-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <div class="step-text">Open the <strong>Reference tab (Tab 04)</strong> and click the filter pill for <strong>Toxic Metals</strong>. You will see four cards: Lead, Arsenic, Mercury, and Cadmium. Open each one and read it before filling in the Toxic Contaminant Elements section of Data Table 1.</div>
            <div class="step-note tip">All Reference tab content is sourced from FDA, EPA, and ATSDR — the same agencies that set food safety limits. You are reading the same science, organized for efficiency.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <div class="step-text">Research lead (Pb), arsenic (As), mercury (Hg), and cadmium (Cd) to complete the <strong>Toxic Contaminant Elements</strong> section of Data Table 1. Fill in why each is dangerous and the common contaminated food sources.</div>
                        <div class="step-note warning">Mercury source (large fish) is pre-filled as a reference. Research the others independently using the Reference tab cards.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <div class="step-text">Go to the Periodic Table tab and click each of the 4 toxic elements to mark them RED. Observe their locations &mdash; you'll analyze the pattern in Analysis Q1.</div>
            <div class="step-note">Notice: Are they metals? Where are they relative to the essential nutrients?</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">P3</div>
        <div class="section-title">Part 3 &mdash; Personal Food Analysis</div>
        <div class="section-badge badge-gold">AI for Calculations Only</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-gold">
          <div class="ref-box-title">What You're Doing</div>
          <p>Applying your element knowledge to a real food item from your kitchen. You will weigh it, read its nutrition label, identify which elements are present, and determine whether it is fortified or a whole food. This becomes your personal data contribution to the Bracket City analysis.</p>
        </div>

        <div class="proc-part-title">
          <span class="proc-part-badge" style="background:var(--blue-light);color:var(--blue);">Step 3A</span>
          Choose Your Food
        </div>
        <div class="proc-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <div class="step-text">Select ONE packaged food from your kitchen that has a Nutrition Facts label listing minerals (Ca, Fe, K, Na, Mg, Zn, etc.) and an ingredient list. You need enough to weigh &mdash; at least 50 g.</div>
            <div class="step-note tip">Cereals, canned beans, dairy products, and bread are excellent choices. Avoid plain water, oils, or items without labels.</div>
            <div class="step-note warning">If you only have fresh, unlabeled whole foods available (loose fruit, vegetables, meat with no package): look up the USDA FoodData Central entry for that food at <a href="https://fdc.nal.usda.gov" target="_blank" rel="noopener" style="color:var(--blue);">fdc.nal.usda.gov</a> and use those values in your data table. Note in your table that your values came from the USDA database, not a physical label. Record what you actually weighed, then use the database to find mineral amounts per 100 g and calculate for your serving size.</div>
          </div>
        </div>

        <div class="proc-part-title">
          <span class="proc-part-badge" style="background:var(--blue-light);color:var(--blue);">Step 3B</span>
          Weigh &amp; Measure
        </div>
        <div class="proc-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <div class="step-text">Using your digital scale from Lab 1, weigh ONE serving of your food item in grams.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <div class="step-text">Record: food name, labeled serving size (g), and actual mass you weighed (g).</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num highlight">3</div>
          <div class="step-content">
            <div class="step-text">Take a photo showing your scale with the food item and a readable weight display. Submit this photo to the Canvas assignment &mdash; not inside this document.</div>
            <div class="step-note warning">Photo submission to Canvas is required for full credit on Data Table 2.</div>
          </div>
        </div>

        <div class="proc-part-title">
          <span class="proc-part-badge" style="background:var(--blue-light);color:var(--blue);">Steps 3C&ndash;3E</span>
          Label Analysis &amp; Bracket City Check
        </div>
        <div class="proc-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <div class="step-text"><strong>Step 3C:</strong> Identify ALL minerals listed on the nutrition label. Record element name, amount (mg), and % Daily Value for each.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num">2</div>
          <div class="step-content">
            <div class="step-text"><strong>Step 3D:</strong> Search the ingredient list for chemical compounds that added nutrients &mdash; iron compounds like "ferrous sulfate" or "reduced iron," calcium compounds like "calcium carbonate," zinc compounds like "zinc oxide." Determine if your food is fortified or a whole food.</div>
          </div>
        </div>
        <div class="proc-step">
          <div class="step-num">3</div>
          <div class="step-content">
            <div class="step-text"><strong>Step 3E:</strong> Open the <strong>Inventory tab (Tab 07)</strong>. Search for your food by name or browse the category. Use what you find to complete <strong>Data Table 3 (Row 3)</strong> — record your food's iron (mg), calcium (mg), contamination risk, and shelf life from the inventory. If your food is not listed, write "not listed" and use your nutrition label values for iron and calcium.</div>
          </div>
        </div>

        <div class="proc-part-title">
          <span class="proc-part-badge" style="background:var(--teal-light);color:var(--teal);">Step 3F</span>
          Inventory Comparison — Data Table 3
        </div>
        <div class="proc-step">
          <div class="step-num">1</div>
          <div class="step-content">
            <div class="step-text">Return to <strong>Data Tables (Tab 03)</strong> and open <strong>Data Table 3</strong>. Using the Bracket City Inventory (Tab 07), find ONE fortified food and ONE whole food that are different from your personal food. Fill in Rows 1 and 2 with their mineral data, contamination risk, and shelf life. Row 3 is your food from Step 3E.</div>
            <div class="step-note tip">Look for foods with different contamination risk levels — comparing a low-risk and a flagged item gives you more to analyze in Q3.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-card">
      <div class="section-header">
        <div class="section-num">P4</div>
        <div class="section-title">Part 4 &mdash; Canvas Discussion Board</div>
        <div class="section-badge badge-gold">After Submission</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-gold">
          <div class="ref-box-title">Complete This After You Submit Your Lab Report</div>
          <p>Complete this after submitting your lab report &mdash; no new data gathering is required. You are extending your own analysis into a class-wide conversation, then reading a classmate's thinking to pressure-test your chemistry. Navigate to <strong>"Lab 2: Discussion Board"</strong> on Canvas and post your response. Then respond to at least one classmate.</p>
        </div>

        <!-- PROMPT A -->
        <div style="margin-top:14px; border:1.5px solid var(--blue); border-radius:6px; overflow:hidden;">
          <div style="background:var(--blue); color:#fff; padding:10px 16px; display:flex; align-items:center; gap:12px;">
            <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.16em; text-transform:uppercase; opacity:0.8;">Prompt A</div>
            <div style="font-size:14px; font-weight:600;">The Director's Memo &mdash; 10 Items for 5,000 People</div>
          </div>
          <div style="padding:16px; background:#fff;">
            <div style="background:var(--blue-light); border-left:3px solid var(--blue); padding:10px 14px; border-radius:3px; font-size:13px; line-height:1.75; margin-bottom:14px; font-style:italic; color:#1a2a4a;">
              "We have a problem. Storage capacity is limited and the city council is cutting the food bank budget by 40%. We can only maintain 10 items from the 74 in our current inventory. I need your chemical expertise to justify which items we keep. Make your case &mdash; this will go in front of the council next week."<br>
              <span style="font-size:11.5px; font-style:normal; color:#666; margin-top:6px; display:block;">&mdash; Director, Bracket City Food Bank</span>
            </div>

            <div style="font-size:13.5px; font-weight:600; color:var(--ink); margin-bottom:8px;">Your Post (original):</div>
            <div style="font-size:13px; line-height:1.85; color:#333; margin-bottom:14px;">
              Name <strong>3 items from the Bracket City inventory</strong> you would recommend keeping. For each, provide a chemical justification that goes beyond preference &mdash; reference specific elements (name and symbol), their role in the body or contamination risk, and which of Bracket City's residents benefit most or are most protected. Draw directly from your Conclusion and Q3 work. If one of your 3 items comes from your own Data Table 3, explain why your analysis convinced you to prioritize it.
            </div>

            <div style="font-size:13.5px; font-weight:600; color:var(--ink); margin-bottom:8px;">Your Response (to a classmate):</div>
            <div style="font-size:13px; line-height:1.85; color:#333;">
              Read two classmates' posts. Find <strong>one item you would vote against</strong> &mdash; not because you dislike the food, but because the chemistry doesn't support it as a top priority. Explain specifically: which element concern, contamination risk, or nutrient gap makes another inventory item a stronger choice? You must name your alternative and cite a chemical reason. Disagreement grounded in evidence is the goal.
            </div>
          </div>
        </div>

        <div style="margin-top:12px; font-size:12px; color:#888; line-height:1.7; padding:10px 14px; background:var(--cream); border-radius:4px;">
          <strong>Timing note:</strong> Post your original entry any time after submitting this lab report. You can read and respond to classmates at any point &mdash; there is no dependency on when others post. Both posts are graded on chemical accuracy and specificity, not length.
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(1)">&larr; Back</button>
      <button class="nav-btn nav-btn-primary" onclick="switchTab(3)">Continue to Data Tables &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 3: DATA TABLES ============================================================ -->
<div id="tab-3" class="tab-panel">
  <div class="main">

    <!-- DATA TABLE 1: ESSENTIAL ELEMENTS -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">T1</div>
        <div class="section-title">Data Table 1 &mdash; Elements in Food</div>
        <div class="section-badge badge-teal">10 pts | No AI</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-teal">
          <div class="ref-box-title">How to Use the Reference Tab</div>
          <p>Symbols and atomic numbers are pre-filled. Open <strong>Tab 04 (Reference)</strong>, read each element card, then write the function or danger and the food sources in your own words. Do not copy the card text directly. Toxic metals have a different column header — explain <em>why</em> they are dangerous, not just that they are.</p>
        </div>
        <div class="ptable-container">
          <table class="data-table">
            <colgroup>
              <col style="width:14%">
              <col style="width:5%">
              <col style="width:6%">
              <col style="width:43%">
              <col style="width:32%">
            </colgroup>
            <thead>
              <tr>
                <th>Element</th>
                <th>Symbol</th>
                <th>Z</th>
                <th>Function in Body / Why Dangerous</th>
                <th>Food Sources / Contaminated Foods</th>
              </tr>
            </thead>
            <tbody>
              <tr><td class="group-header" colspan="5">MACROMINERALS — needed in gram-level amounts</td></tr>
              <tr>
                <td class="label-cell">Calcium</td>
                <td><input type="text" value="Ca" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="20" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-ca-fn" placeholder="What does calcium do in the body?"></td>
                <td><input type="text" id="dt1-ca-src" placeholder="Name 2+ foods high in calcium"></td>
              </tr>
              <tr>
                <td class="label-cell">Phosphorus</td>
                <td><input type="text" value="P" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="15" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-p-fn" placeholder="What does phosphorus do in the body?"></td>
                <td><input type="text" id="dt1-p-src" placeholder="Name 2+ foods high in phosphorus"></td>
              </tr>
              <tr>
                <td class="label-cell">Potassium</td>
                <td><input type="text" value="K" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="19" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-k-fn" placeholder="What does potassium do in the body?"></td>
                <td><input type="text" id="dt1-k-src" placeholder="Name 2+ foods high in potassium"></td>
              </tr>
              <tr>
                <td class="label-cell">Sodium</td>
                <td><input type="text" value="Na" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="11" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-na-fn" placeholder="What does sodium do in the body?"></td>
                <td><input type="text" id="dt1-na-src" placeholder="Name 2+ foods high in sodium"></td>
              </tr>
              <tr>
                <td class="label-cell">Magnesium</td>
                <td><input type="text" value="Mg" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="12" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-mg-fn" placeholder="What does magnesium do in the body?"></td>
                <td><input type="text" id="dt1-mg-src" placeholder="Name 2+ foods high in magnesium"></td>
              </tr>
              <tr><td class="group-header" colspan="5">MICROMINERALS — needed in milligram or microgram amounts</td></tr>
              <tr>
                <td class="label-cell">Iron</td>
                <td><input type="text" value="Fe" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="26" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-fe-fn" placeholder="What does iron do in the body?"></td>
                <td><input type="text" id="dt1-fe-src" placeholder="Name 2+ foods high in iron"></td>
              </tr>
              <tr>
                <td class="label-cell">Zinc</td>
                <td><input type="text" value="Zn" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="30" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-zn-fn" placeholder="What does zinc do in the body?"></td>
                <td><input type="text" id="dt1-zn-src" placeholder="Name 2+ foods high in zinc"></td>
              </tr>
              <tr>
                <td class="label-cell">Copper</td>
                <td><input type="text" value="Cu" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="29" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-cu-fn" placeholder="What does copper do in the body?"></td>
                <td><input type="text" id="dt1-cu-src" placeholder="Name 2+ foods high in copper"></td>
              </tr>
              <tr>
                <td class="label-cell">Iodine</td>
                <td><input type="text" value="I" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="53" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-i-fn" placeholder="What does iodine do in the body?"></td>
                <td><input type="text" id="dt1-i-src" placeholder="Name 2+ foods high in iodine"></td>
              </tr>
              <tr>
                <td class="label-cell">Selenium</td>
                <td><input type="text" value="Se" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="34" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt1-se-fn" placeholder="What does selenium do in the body?"></td>
                <td><input type="text" id="dt1-se-src" placeholder="Name 2+ foods high in selenium"></td>
              </tr>
              <tr><td class="group-header" colspan="5" style="background:#2d1a1a; color:#ff9999;">TOXIC CONTAMINANT ELEMENTS — no safe exposure level; never on a Nutrition Facts label</td></tr>
              <tr style="background:#fff5f5;">
                <td class="label-cell">Lead</td>
                <td><input type="text" value="Pb" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="82" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt2-pb-why" placeholder="Why is lead dangerous in the body?"></td>
                <td><input type="text" id="dt2-pb-src" placeholder="Which foods carry lead contamination?"></td>
              </tr>
              <tr style="background:#fff8f8;">
                <td class="label-cell">Arsenic</td>
                <td><input type="text" value="As" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="33" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt2-as-why" placeholder="Why is arsenic dangerous in the body?"></td>
                <td><input type="text" id="dt2-as-src" placeholder="Which foods carry arsenic contamination?"></td>
              </tr>
              <tr style="background:#fff5f5;">
                <td class="label-cell">Mercury</td>
                <td><input type="text" value="Hg" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="80" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt2-hg-why" placeholder="Why is mercury dangerous in the body?"></td>
                <td><input type="text" id="dt2-hg-src" value="Large fish (tuna, swordfish, shark)"></td>
              </tr>
              <tr style="background:#fff8f8;">
                <td class="label-cell">Cadmium</td>
                <td><input type="text" value="Cd" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" value="48" readonly style="background:#fff0f0; font-family:'JetBrains Mono',monospace;"></td>
                <td><input type="text" id="dt2-cd-why" placeholder="Why is cadmium dangerous in the body?"></td>
                <td><input type="text" id="dt2-cd-src" placeholder="Which foods carry cadmium contamination?"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- DATA TABLE 2: PERSONAL FOOD ANALYSIS -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">T2</div>
        <div class="section-title">Data Table 2 &mdash; Your Personal Food</div>
        <div class="section-badge badge-gold">6 pts | AI for Calc Only</div>
      </div>
      <div class="section-body">
        <div class="food-meta-grid">
          <div class="form-field">
            <label>Food Item Name</label>
            <input type="text" id="food-name" placeholder="e.g. Cheerios Original">
          </div>
          <div class="form-field">
            <label>Labeled Serving Size (g)</label>
            <input type="number" id="food-serving-labeled" placeholder="e.g. 28" step="0.1" min="0">
          </div>
          <div class="form-field">
            <label>Actual Mass Weighed (g)</label>
            <input type="number" id="food-serving-actual" placeholder="e.g. 27.6" step="0.1" min="0">
          </div>
          <div class="form-field">
            <label>Fortified or Whole Food?</label>
            <select id="food-type">
              <option value="">Select...</option>
              <option value="fortified">Fortified (nutrients added)</option>
              <option value="whole">Whole food (natural nutrients)</option>
              <option value="both">Both (minimally processed)</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:16px;">
          <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:#888; margin-bottom:8px;">Photo Documentation</div>
          <div style="background:#fff8e1; border:1.5px solid var(--gold); border-radius:8px; padding:14px 16px; font-size:13px; line-height:1.6;">
            <strong>Submit your photo directly to the Canvas assignment — do not upload it here.</strong><br>
            Your photo must show your food item on the scale with the weight display clearly visible. Without a photo submitted to Canvas, this portion of your grade will not be awarded.
          </div>
        </div>

        <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:#888; margin-bottom:4px;">Minerals from Nutrition Label or USDA FoodData Central</div>
        <div style="font-size:12px; color:#999; margin-bottom:10px;">If your food has no label, use <a href="https://fdc.nal.usda.gov" target="_blank" rel="noopener" style="color:var(--blue);">fdc.nal.usda.gov</a> and note "USDA database" in the Notes column.</div>

        <table class="data-table" id="mineral-table">
          <thead>
            <tr>
              <th>Element Name</th>
              <th>Symbol</th>
              <th>Amount (mg)</th>
              <th>Serving Size Used</th>
              <th>% Daily Value</th>
              <th>Notes (High/Low? Fortified?)</th>
            </tr>
          </thead>
          <tbody id="mineral-tbody">
            <tr>
              <td><input type="text" class="mineral-name" placeholder="e.g. Iron"></td>
              <td><input type="text" class="mono mineral-sym" placeholder="Fe" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" class="mineral-amt" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="text" class="mineral-serving" placeholder="g"></td>
              <td><input type="number" class="mineral-dv" placeholder="0" step="0.1" min="0" max="1000"></td>
              <td><input type="text" class="mineral-notes" placeholder="e.g. Low (<5% DV)"></td>
            </tr>
            <tr>
              <td><input type="text" class="mineral-name" placeholder=""></td>
              <td><input type="text" class="mono mineral-sym" placeholder="" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" class="mineral-amt" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="text" class="mineral-serving" placeholder="g"></td>
              <td><input type="number" class="mineral-dv" placeholder="0" step="0.1" min="0" max="1000"></td>
              <td><input type="text" class="mineral-notes" placeholder=""></td>
            </tr>
            <tr>
              <td><input type="text" class="mineral-name" placeholder=""></td>
              <td><input type="text" class="mono mineral-sym" placeholder="" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" class="mineral-amt" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="text" class="mineral-serving" placeholder="g"></td>
              <td><input type="number" class="mineral-dv" placeholder="0" step="0.1" min="0" max="1000"></td>
              <td><input type="text" class="mineral-notes" placeholder=""></td>
            </tr>
            <tr>
              <td><input type="text" class="mineral-name" placeholder=""></td>
              <td><input type="text" class="mono mineral-sym" placeholder="" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" class="mineral-amt" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="text" class="mineral-serving" placeholder="g"></td>
              <td><input type="number" class="mineral-dv" placeholder="0" step="0.1" min="0" max="1000"></td>
              <td><input type="text" class="mineral-notes" placeholder=""></td>
            </tr>
          </tbody>
        </table>
        <div class="mineral-add-row">
          <button class="add-row-btn" onclick="addMineralRow()">+ Add another mineral row</button>
        </div>

        <div style="margin-top:20px;">
          <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.14em; text-transform:uppercase; color:#888; margin-bottom:8px;">Fortification Compounds Found in Ingredient List</div>
          <textarea id="fortification-compounds" class="open-response" style="min-height:60px;" placeholder="List chemical compounds you found that indicate fortification, e.g. 'ferrous sulfate, calcium carbonate, zinc oxide.' If whole food, write 'None observed &mdash; naturally occurring nutrients.'"></textarea>
        </div>
      </div>
    </div>

    <!-- DATA TABLE 3: BRACKET CITY INVENTORY COMPARISON -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">T3</div>
        <div class="section-title">Data Table 3 &mdash; Bracket City Inventory Comparison</div>
        <div class="section-badge badge-teal">4 pts | Tab 07</div>
      </div>
      <div class="section-body">
        <div class="ref-box ref-box-teal">
          <div class="ref-box-title">Instructions</div>
          <p>Open <strong>Tab 07 (Inventory)</strong>. Choose one fortified food and one whole food from the inventory. Then look up your own food from Data Table 2 — if it appears in the inventory, record those values; if not, write "not listed" and use your label data. All values should come directly from the inventory table or your nutrition label.</p>
        </div>
        <table class="data-table">
          <colgroup>
            <col style="width:18%">
            <col style="width:10%">
            <col style="width:10%">
            <col style="width:12%">
            <col style="width:12%">
            <col style="width:12%">
            <col style="width:14%">
            <col style="width:12%">
          </colgroup>
          <thead>
            <tr>
              <th>Food Name / Inv. #</th>
              <th>Type</th>
              <th>Key Mineral (symbol)</th>
              <th>Iron (mg)</th>
              <th>Calcium (mg)</th>
              <th>% DV (key mineral)</th>
              <th>Contamination Risk</th>
              <th>Shelf Life (mo.)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input type="text" id="dt3-r1-food" placeholder="Fortified food, Inv. #"></td>
              <td><input type="text" value="Fortified" readonly style="background:#f0f9f8; font-family:'JetBrains Mono',monospace; font-size:11px;"></td>
              <td><input type="text" id="dt3-r1-mineral" placeholder="e.g. Fe" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" id="dt3-r1-fe" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="number" id="dt3-r1-ca" placeholder="0" min="0"></td>
              <td><input type="text" id="dt3-r1-dv" placeholder="e.g. 25%"></td>
              <td><input type="text" id="dt3-r1-risk" placeholder="Low / Arsenic..."></td>
              <td><input type="number" id="dt3-r1-shelf" placeholder="0" step="0.1" min="0"></td>
            </tr>
            <tr>
              <td><input type="text" id="dt3-r2-food" placeholder="Whole food, Inv. #"></td>
              <td><input type="text" value="Whole" readonly style="background:#f5f0ff; font-family:'JetBrains Mono',monospace; font-size:11px;"></td>
              <td><input type="text" id="dt3-r2-mineral" placeholder="e.g. K" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" id="dt3-r2-fe" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="number" id="dt3-r2-ca" placeholder="0" min="0"></td>
              <td><input type="text" id="dt3-r2-dv" placeholder="e.g. 8%"></td>
              <td><input type="text" id="dt3-r2-risk" placeholder="Low / Cadmium..."></td>
              <td><input type="number" id="dt3-r2-shelf" placeholder="0" step="0.1" min="0"></td>
            </tr>
            <tr>
              <td><input type="text" id="dt3-r3-food" placeholder="Your food (DT2) or 'not listed'"></td>
              <td><input type="text" id="dt3-r3-type" placeholder="Fortified / Whole"></td>
              <td><input type="text" id="dt3-r3-mineral" placeholder="e.g. Ca" maxlength="3" oninput="formatChemSym(this)"></td>
              <td><input type="number" id="dt3-r3-fe" placeholder="0.0" step="0.01" min="0"></td>
              <td><input type="number" id="dt3-r3-ca" placeholder="0" min="0"></td>
              <td><input type="text" id="dt3-r3-dv" placeholder="from your label"></td>
              <td><input type="text" id="dt3-r3-risk" placeholder="from inventory or 'not listed'"></td>
              <td><input type="number" id="dt3-r3-shelf" placeholder="0" step="0.1" min="0"></td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top:12px; font-size:12px; color:#888; line-height:1.6;">
          Row 3 is your own food. If it appears in the inventory, copy those values. If not, use your nutrition label for minerals and % DV, and write "not listed" for contamination risk and shelf life.
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(2)">&larr; Back</button>
      <button class="nav-btn nav-btn-primary" onclick="switchTab(4)">Element Reference &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 4: ELEMENT REFERENCE ============================================================ -->
<div id="tab-4" class="tab-panel">
  <div class="main">
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">REF</div>
        <div class="section-title">Element Reference Guide</div>
        <div class="section-badge badge-teal">Data Tables 1 &amp; 2 Support</div>
      </div>
      <div class="section-body">

        <div class="ref-box ref-box-teal" style="margin-bottom:16px;">
          <div class="ref-box-title">How to Use This Tab</div>
          <p>Everything you need to complete Data Tables 1 and 2 is here. Search by element name, symbol, or keyword (try "bones", "thyroid", "oxygen", "toxic", "kidney"). Click any card to expand the full profile. All data is sourced from NIH Office of Dietary Supplements, FDA, EPA, and ATSDR.</p>
        </div>

        <!-- Search bar -->
        <div style="position:relative; margin-bottom:20px;">
          <input type="text" id="ref-search" placeholder="Search elements... try 'iron', 'Fe', 'toxic', 'thyroid', 'oxygen'..." 
            style="width:100%; padding:11px 16px 11px 42px; font-size:14px; border:2px solid var(--border); border-radius:6px; font-family:'DM Sans',sans-serif; outline:none; transition:border-color 0.2s; box-sizing:border-box;"
            oninput="refFilter(this.value)"
            onfocus="this.style.borderColor='var(--blue)'"
            onblur="this.style.borderColor='var(--border)'">
          <span style="position:absolute; left:14px; top:50%; transform:translateY(-50%); font-size:16px; color:#aaa;">&#128269;</span>
          <span id="ref-count" style="position:absolute; right:14px; top:50%; transform:translateY(-50%); font-size:12px; color:#aaa; font-family:'JetBrains Mono',monospace;"></span>
        </div>

        <!-- Filter pills -->
        <div style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px;">
          <button class="ref-pill ref-pill-active" onclick="refPill(this,'all')">All Elements</button>
          <button class="ref-pill ref-pill-macro" onclick="refPill(this,'macro')">Macrominerals</button>
          <button class="ref-pill ref-pill-micro" onclick="refPill(this,'micro')">Microminerals</button>
          <button class="ref-pill ref-pill-toxic" onclick="refPill(this,'toxic')">Toxic Metals</button>
        </div>

        <!-- Element cards grid -->
        <div id="ref-grid" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(310px,1fr)); gap:16px;"></div>
        <div id="ref-noresults" style="display:none; text-align:center; padding:40px; color:#999; font-size:14px;">No elements match your search.</div>

      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(3)">&larr; Back to Data Tables</button>
      <button class="nav-btn nav-btn-primary" onclick="switchTab(5)">Continue to Periodic Table &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 4: PERIODIC TABLE ============================================================ -->
<div id="tab-5" class="tab-panel">
  <div class="main">
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">PT</div>
        <div class="section-title">Interactive Periodic Table &mdash; Mark Safe vs. Dangerous Elements</div>
        <div class="section-badge badge-green">5 pts</div>
      </div>
      <div class="section-body">
        <div class="ref-box">
          <div class="ref-box-title">Instructions</div>
          <p>Click any element to cycle through its states: unmarked &rarr; <strong style="color:var(--teal);">Blue</strong> (essential nutrient) &rarr; <strong style="color:var(--red);">Red</strong> (toxic contaminant) &rarr; unmarked. Mark all 10 essential nutrients teal and all 4 toxic heavy metals red. Observe the patterns in their periodic table locations &mdash; you will analyze these patterns in Analysis Question 1.</p>
        </div>

        <div class="pt-legend">
          <div class="pt-legend-item">
            <div class="pt-legend-swatch" style="background:#bbdefb; border-color:#1565c0;"></div>
            Blue = Essential Nutrient (mark 10 elements)
          </div>
          <div class="pt-legend-item">
            <div class="pt-legend-swatch" style="background:#f9c8c8; border-color:#c0392b;"></div>
            Red = Toxic Contaminant (mark 4 elements)
          </div>
          <div class="pt-legend-item">
            <div class="pt-legend-swatch" style="background:#f8f8f8; border-color:#ddd;"></div>
            Unclassified
          </div>
        </div>

        <div style="margin-top:12px; font-family:'JetBrains Mono',monospace; font-size:11px; color:var(--teal);">
          Marked blue: <span id="green-count">0</span>/10 &nbsp;&nbsp;|&nbsp;&nbsp;
          <span style="color:var(--red);">Marked red: <span id="red-count">0</span>/4</span>
        </div>

        <div class="ptable-container" style="margin-top:14px;">
          <div class="ptable" id="ptable"></div>
        </div>

      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(3)">&larr; Back</button>
      <button class="nav-btn nav-btn-primary" onclick="switchTab(6)">Continue to Analysis &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 5: ANALYSIS ============================================================ -->
<div id="tab-6" class="tab-panel">
  <div class="main">
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">AQ</div>
        <div class="section-title">Analysis Questions</div>
        <div class="section-badge badge-blue">30 pts total</div>
      </div>
      <div class="section-body">

        <!-- Q1: PATTERN + MIMICRY MATCHING (6 pts) -->
        <div class="q-block">
          <div class="q-label">Q1 &mdash; 6 pts | Periodic Table Patterns &amp; Chemical Mimicry</div>
          <div class="q-text">You color-coded the periodic table with 10 essential nutrients (blue) and 4 toxic metals (red). Before you answer, look at where those elements landed.</div>

          <div class="q-sub">Part A &mdash; In one sentence, describe the pattern you observed. Where do essential nutrients cluster? Where do the toxic metals sit?</div>
          <textarea class="open-response" id="q1-pattern" style="min-height:55px; margin-bottom:14px;" placeholder="I noticed that essential nutrients tend to be located in... while toxic metals are found in..."></textarea>

          <div class="q-sub">Part B &mdash; Select the statement that best explains <em>why</em> that pattern exists:</div>
          <div class="mc-options" id="q1-mc">
            <label class="mc-option" id="q1-opt-a">
              <input type="radio" name="q1-mc" value="a" onchange="handleMC('q1','a')">
              <span><strong>A.</strong> Essential nutrients are scattered randomly across all groups and periods, making their position unpredictable.</span>
            </label>
            <label class="mc-option" id="q1-opt-b">
              <input type="radio" name="q1-mc" value="b" onchange="handleMC('q1','b')">
              <span><strong>B.</strong> Essential nutrients concentrate in the s-block and lighter p-block elements (Groups 1&ndash;2 and 13&ndash;18), while toxic heavy metals cluster in the d-block (transition metals, Groups 3&ndash;12). Elements in the same group share electron configurations and therefore similar ionic radii and bonding chemistry &mdash; which is exactly why a toxic metal can fool the body into accepting it in place of the nutrient above it in the same group.</span>
            </label>
            <label class="mc-option" id="q1-opt-c">
              <input type="radio" name="q1-mc" value="c" onchange="handleMC('q1','c')">
              <span><strong>C.</strong> Toxic metals are only dangerous in Period 6 and below; any element in Period 1&ndash;5 is safe at any dose.</span>
            </label>
            <label class="mc-option" id="q1-opt-d">
              <input type="radio" name="q1-mc" value="d" onchange="handleMC('q1','d')">
              <span><strong>D.</strong> An element's position on the periodic table tells us nothing reliable about whether it is nutritionally essential or toxic.</span>
            </label>
          </div>
          <div class="q-sub" style="margin-top:10px; color:var(--gold);">Your selection is recorded. Correct answers will be reviewed with your instructor after submission.</div>

          <div class="q-sub" style="margin-top:18px;">Part C &mdash; Match each toxic element to the nutrient it most closely mimics. Use the Reference tab (Tab 04) or federal sources: <a href="https://www.fda.gov/food/environmental-contaminants-food/closer-zero-reducing-childhood-exposure-contaminants-foods" target="_blank" rel="noopener" style="color:var(--teal);">FDA Closer to Zero</a> &mdash; <a href="https://www.epa.gov/lead/health-effects-lead" target="_blank" rel="noopener" style="color:var(--teal);">EPA Lead</a> &mdash; <a href="https://www.atsdr.cdc.gov/toxprofiles/tp2.pdf" target="_blank" rel="noopener" style="color:var(--teal);">ATSDR Arsenic</a> &mdash; <a href="https://www.atsdr.cdc.gov/toxprofiles/tp5.pdf" target="_blank" rel="noopener" style="color:var(--teal);">ATSDR Cadmium</a></div>

          <table class="matching-table" id="q2-matching">
            <tbody>
              <tr>
                <td class="match-term">Lead (Pb)<br><span style="font-size:11.5px; font-weight:400; color:#666;">Group 14, Period 6</span></td>
                <td class="match-connector">&rarr;</td>
                <td class="match-select-cell">
                  <select class="match-select" id="q2-match-pb" onchange="highlightMatch(this)">
                    <option value="">-- Select match --</option>
                    <option value="ca">Mimics Calcium (Ca) &mdash; accumulates in bone, displacing Ca and damaging the nervous system</option>
                    <option value="fe">Mimics Iron (Fe) &mdash; competes for absorption, reducing oxygen-carrying capacity</option>
                    <option value="zn">Mimics Zinc (Zn) &mdash; displaces Zn in enzymes, disrupting protein synthesis and immune function</option>
                    <option value="phosphate">Mimics Phosphate (PO&#8324;&sup3;&macr;) &mdash; substitutes into ATP and DNA backbone, collapsing energy metabolism</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td class="match-term">Arsenic (As)<br><span style="font-size:11.5px; font-weight:400; color:#666;">Group 15, Period 4</span></td>
                <td class="match-connector">&rarr;</td>
                <td class="match-select-cell">
                  <select class="match-select" id="q2-match-as" onchange="highlightMatch(this)">
                    <option value="">-- Select match --</option>
                    <option value="ca">Mimics Calcium (Ca) &mdash; accumulates in bone, displacing Ca and damaging the nervous system</option>
                    <option value="fe">Mimics Iron (Fe) &mdash; competes for absorption, reducing oxygen-carrying capacity</option>
                    <option value="zn">Mimics Zinc (Zn) &mdash; displaces Zn in enzymes, disrupting protein synthesis and immune function</option>
                    <option value="phosphate">Mimics Phosphate (PO&#8324;&sup3;&macr;) &mdash; substitutes into ATP and DNA backbone, collapsing energy metabolism</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td class="match-term">Mercury (Hg)<br><span style="font-size:11.5px; font-weight:400; color:#666;">Group 12, Period 6</span></td>
                <td class="match-connector">&rarr;</td>
                <td class="match-select-cell">
                  <select class="match-select" id="q2-match-hg" onchange="highlightMatch(this)">
                    <option value="">-- Select match --</option>
                    <option value="ca">Mimics Calcium (Ca) &mdash; accumulates in bone, displacing Ca and damaging the nervous system</option>
                    <option value="se">Mimics Selenium (Se) &mdash; binds selenoproteins and blocks antioxidant enzymes, causing oxidative damage</option>
                    <option value="zn">Mimics Zinc (Zn) &mdash; displaces Zn in enzymes, disrupting protein synthesis and immune function</option>
                    <option value="phosphate">Mimics Phosphate (PO&#8324;&sup3;&macr;) &mdash; substitutes into ATP and DNA backbone, collapsing energy metabolism</option>
                  </select>
                </td>
              </tr>
              <tr>
                <td class="match-term">Cadmium (Cd)<br><span style="font-size:11.5px; font-weight:400; color:#666;">Group 12, Period 5</span></td>
                <td class="match-connector">&rarr;</td>
                <td class="match-select-cell">
                  <select class="match-select" id="q2-match-cd" onchange="highlightMatch(this)">
                    <option value="">-- Select match --</option>
                    <option value="ca">Mimics Calcium (Ca) &mdash; accumulates in bone, displacing Ca and damaging the nervous system</option>
                    <option value="fe">Mimics Iron (Fe) &mdash; competes for absorption, reducing oxygen-carrying capacity</option>
                    <option value="zn">Mimics Zinc (Zn) &mdash; displaces Zn in enzymes, disrupting protein synthesis and immune function</option>
                    <option value="phosphate">Mimics Phosphate (PO&#8324;&sup3;&macr;) &mdash; substitutes into ATP and DNA backbone, collapsing energy metabolism</option>
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
          <button class="ai-btn" style="margin-top:12px;" onclick="checkMatching(); getAIFeedback('q1-feedback', 'q1-pattern', 'Q1: Student described the periodic table clustering pattern for essential nutrients vs toxic metals, selected the best explanation, and matched toxic metals to nutrient mimics. Evaluate: (1) pattern sentence accuracy — essential nutrients in s- and p-blocks, toxic metals in d-block; (2) whether MC choice B is selected; (3) matching accuracy and whether the student connects group/period position to chemical similarity.')">Check Matches &amp; Get Feedback</button>
          <div class="ai-feedback-area" id="q1-feedback"></div>
        </div>

        <!-- Q2: YOUR FOOD + INVENTORY ANALYSIS (10 pts) -->
        <div class="q-block">
          <div class="q-label">Q2 &mdash; 10 pts | Your Food Analysis &amp; Inventory Comparison</div>
          <div class="q-text">You weighed and labeled your food in Data Table 2. Now analyze it using the chemistry from this lab, then place it in the context of the Bracket City inventory you compiled in Data Table 3.</div>

          <div class="q-sub">Part A &mdash; Confirm your food item and classify it.</div>
          <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin:8px 0 18px;">
            <div>
              <label style="font-size:12px; color:#888; display:block; margin-bottom:3px;">Food item (exact name from package)</label>
              <input type="text" class="inline-input" id="q3-food-confirm" placeholder="e.g. Cheerios Original" style="width:100%;">
            </div>
            <div>
              <label style="font-size:12px; color:#888; display:block; margin-bottom:3px;">Fortified, whole food, or both?</label>
              <select id="q3-food-type" style="width:100%; padding:5px 8px; border:1.5px solid var(--border); border-radius:5px; font-size:13px; background:white;">
                <option value="">-- Select --</option>
                <option value="fortified">Fortified / Packaged</option>
                <option value="whole">Whole Food</option>
                <option value="both">Both (minimally processed)</option>
              </select>
            </div>
            <div>
              <label style="font-size:12px; color:#888; display:block; margin-bottom:3px;">Fortification compounds in ingredient list (or "none")</label>
              <input type="text" class="inline-input" id="q3-fortify" placeholder="e.g. ferrous sulfate, zinc oxide" style="width:100%;">
            </div>
          </div>

          <div class="q-sub">Part B &mdash; Record the top 3 minerals from your Nutrition Facts label (name, symbol, % DV).</div>
          <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin:8px 0 18px;">
            <div style="background:var(--cream); border:1px solid var(--border); border-radius:6px; padding:10px;">
              <label style="font-size:11px; color:#888; display:block; margin-bottom:4px;">Mineral 1</label>
              <input type="text" class="inline-input" id="q3-m1-name" placeholder="Name (e.g. Iron)" style="width:100%; margin-bottom:4px;">
              <input type="text" class="inline-input" id="q3-m1-sym" placeholder="Symbol (Fe)" style="width:100%; margin-bottom:4px;" maxlength="3" oninput="formatChemSym(this)">
              <input type="number" class="inline-input" id="q3-m1-dv" placeholder="% DV" min="0" max="999" style="width:100%;">
            </div>
            <div style="background:var(--cream); border:1px solid var(--border); border-radius:6px; padding:10px;">
              <label style="font-size:11px; color:#888; display:block; margin-bottom:4px;">Mineral 2</label>
              <input type="text" class="inline-input" id="q3-m2-name" placeholder="Name" style="width:100%; margin-bottom:4px;">
              <input type="text" class="inline-input" id="q3-m2-sym" placeholder="Symbol" style="width:100%; margin-bottom:4px;" maxlength="3" oninput="formatChemSym(this)">
              <input type="number" class="inline-input" id="q3-m2-dv" placeholder="% DV" min="0" max="999" style="width:100%;">
            </div>
            <div style="background:var(--cream); border:1px solid var(--border); border-radius:6px; padding:10px;">
              <label style="font-size:11px; color:#888; display:block; margin-bottom:4px;">Mineral 3 (if listed)</label>
              <input type="text" class="inline-input" id="q3-m3-name" placeholder="Name or none listed" style="width:100%; margin-bottom:4px;">
              <input type="text" class="inline-input" id="q3-m3-sym" placeholder="Symbol" style="width:100%; margin-bottom:4px;" maxlength="3" oninput="formatChemSym(this)">
              <input type="number" class="inline-input" id="q3-m3-dv" placeholder="% DV" min="0" max="999" style="width:100%;">
            </div>
          </div>

          <div class="q-sub">Part C &mdash; Is your food in the Bracket City inventory (Tab 07)?</div>
          <div style="display:flex; gap:12px; margin:6px 0 16px; flex-wrap:wrap;">
            <label class="radio-item" style="margin:0;"><input type="radio" name="q7-in-inv" value="yes" onchange="toggleQ7Paths()"> Yes &mdash; found it (record values in DT3 Row 3)</label>
            <label class="radio-item" style="margin:0;"><input type="radio" name="q7-in-inv" value="similar" onchange="toggleQ7Paths()"> No, but a similar item is listed</label>
            <label class="radio-item" style="margin:0;"><input type="radio" name="q7-in-inv" value="no" onchange="toggleQ7Paths()"> Not found in the inventory</label>
          </div>
          <div id="q7-path-yes" style="display:none;"></div>
          <div id="q7-path-no" style="display:none;"></div>
          <div id="q7-path-similar" style="display:none;"></div>

          <div class="q-sub">Part D &mdash; Written analysis. Address all three points in a single paragraph.</div>
          <div style="background:var(--cream); border-left:3px solid var(--teal); padding:10px 14px; border-radius:4px; font-size:12.5px; line-height:1.8; margin-bottom:10px;">
            <strong>1.</strong> What does your food provide? Name each element, its % DV, and classify as high (&gt;20%), adequate (5&ndash;19%), or low (&lt;5%). If fortified, name the chemical compound form from the ingredient list.<br>
            <strong>2.</strong> How does your food compare to the fortified and whole food in Data Table 3? Reference specific nutrient amounts, contamination risk, and shelf life from the inventory.<br>
            <strong>3.</strong> Would you recommend your food for Bracket City? Name which residents benefit most and whether any populations should receive it less frequently.
          </div>
          <textarea class="open-response" id="q2-written" style="min-height:130px;" placeholder="My food is [name]. It provides [element] at [% DV] which is high/adequate/low... The fortification compound in the ingredient list is [name]... Compared to [DT3 item 1], my food has [more/less] [nutrient] because... The whole food I chose, [item], differs in [specific way]... My recommendation for Bracket City is [yes/no/conditional] because... The residents who benefit most are [population] because..."></textarea>
          <button class="ai-btn" onclick="getAIFeedback('q2-feedback', 'q2-written', 'Q2 (10 pts): Student analyzes their personal food and compares it to two Bracket City inventory items. Award points for: (1) specific % DV values with correct high/adequate/low classification; (2) fortification compound named by chemical name if applicable; (3) direct numerical comparison to the inventory fortified item from DT3; (4) direct numerical comparison to the inventory whole food from DT3; (5) evidence-based distribution recommendation naming a specific population. Penalize responses that are vague, omit specific numbers, or fail to compare against the DT3 inventory items.')">Get Feedback</button>
          <div class="ai-feedback-area" id="q2-feedback"></div>
        </div>

        <!-- Q3: CONTAMINATION RISK + STORAGE CHEMISTRY (8 pts) -->
        <div class="q-block">
          <div class="q-label">Q3 &mdash; 8 pts | Contamination Risk &amp; Storage Chemistry</div>
          <div class="q-text">Use the Bracket City Inventory (Tab 07) as your primary source. Every statement below draws on real values from that table.</div>

          <div class="q-sub">Part A &mdash; Mark each statement TRUE or FALSE.</div>
          <div class="tf-list" id="q5-tf">
            <div class="tf-item" id="tf-1">
              <span>Fresh produce like spinach, carrots, and broccoli spoils faster than canned goods mainly because of its high water content, which supports bacterial growth and enzymatic breakdown. This is why the inventory shows shelf lives under 1 month for most fresh items.</span>
              <div class="tf-btn-group">
                <button class="tf-btn tf-true-btn" onclick="selectTF(1,'T')">TRUE</button>
                <button class="tf-btn tf-false-btn" onclick="selectTF(1,'F')">FALSE</button>
              </div>
              <input type="hidden" id="tf-val-1" value="">
            </div>
            <div class="tf-item" id="tf-2">
              <span>According to the Bracket City inventory, canned black beans have a 48-month shelf life, cost $0.40 per serving, and deliver 2.1 mg of iron &mdash; more than fresh chicken breast (0.5 mg, $1.50/serving, 0.1-month shelf life). A food bank selecting for cost, storage, and iron content simultaneously would be scientifically justified in prioritizing black beans.</span>
              <div class="tf-btn-group">
                <button class="tf-btn tf-true-btn" onclick="selectTF(2,'T')">TRUE</button>
                <button class="tf-btn tf-false-btn" onclick="selectTF(2,'F')">FALSE</button>
              </div>
              <input type="hidden" id="tf-val-2" value="">
            </div>
            <div class="tf-item" id="tf-3">
              <span>Spinach and kale both carry a cadmium (Cd) contamination flag in the Bracket City inventory. Because cadmium accumulates in the kidneys with no established safe exposure level, the food bank should consider limiting distribution frequency to children even though both foods are nutritionally valuable sources of calcium and iron.</span>
              <div class="tf-btn-group">
                <button class="tf-btn tf-true-btn" onclick="selectTF(3,'T')">TRUE</button>
                <button class="tf-btn tf-false-btn" onclick="selectTF(3,'F')">FALSE</button>
              </div>
              <input type="hidden" id="tf-val-3" value="">
            </div>
            <div class="tf-item" id="tf-4">
              <span>A fortified food always delivers more bioavailable minerals than the equivalent whole food, because fortification adds measured, standardized amounts of compounds like ferrous sulfate directly to the product.</span>
              <div class="tf-btn-group">
                <button class="tf-btn tf-true-btn" onclick="selectTF(4,'T')">TRUE</button>
                <button class="tf-btn tf-false-btn" onclick="selectTF(4,'F')">FALSE</button>
              </div>
              <input type="hidden" id="tf-val-4" value="">
            </div>
          </div>

          <div class="q-sub" style="margin-top:18px;">Part B &mdash; Flag the highest-risk item. Review the contamination risk column in the inventory. Select the ONE item you believe poses the greatest cumulative risk to Bracket City residents, considering: vulnerable population, likely distribution frequency, and what repeated low-level exposure adds up to over time.</div>
          <div style="display:flex; gap:16px; margin:8px 0 14px; flex-wrap:wrap; align-items:center;">
            <div>
              <label style="font-size:12px; color:#888;">Flagged Item:</label><br>
              <input type="text" class="inline-input" id="q6-item" placeholder="Food item name from inventory" style="width:220px; margin-top:4px;">
            </div>
            <div>
              <label style="font-size:12px; color:#888;">Toxic Element of Concern:</label><br>
              <div class="radio-group" style="flex-direction:row; gap:12px; margin-top:8px;">
                <label class="radio-item"><input type="radio" name="q6-toxin" value="Pb"> Pb (Lead)</label>
                <label class="radio-item"><input type="radio" name="q6-toxin" value="As"> As (Arsenic)</label>
                <label class="radio-item"><input type="radio" name="q6-toxin" value="Hg"> Hg (Mercury)</label>
                <label class="radio-item"><input type="radio" name="q6-toxin" value="Cd"> Cd (Cadmium)</label>
              </div>
            </div>
          </div>

          <div class="q-sub">Part C &mdash; Explain your flag using your Q1 matching work as the chemical foundation.</div>
          <textarea class="open-response" id="q6b" style="min-height:110px;" placeholder="I flagged [item] because it contains [element]. In Q1, I matched [element] to [nutrient] it mimics because they share [chemical property]. When [element] substitutes in, it disrupts [body system] by... The most vulnerable population is [group] because... Even low-level repeated exposure through the food bank matters because..."></textarea>
          <button class="ai-btn" onclick="checkTrueFalse(); getAIFeedback('q3-feedback', 'q6b', 'Q3 (8 pts): Student answered 4 T/F items about food storage chemistry and contamination, then flagged the highest-risk inventory item. Evaluate the written explanation for: (1) correct identification of the nutrient mimicked from Q1 matching with a chemical reason; (2) mechanistic explanation of the biological disruption; (3) correct vulnerable population with justification; (4) explanation of why sub-threshold repeated food bank exposure is still a concern. Award 2 pts per element present. T/F answers: TF1=T, TF2=T, TF3=T, TF4=F.')">Check T/F &amp; Get Feedback</button>
          <div class="ai-feedback-area" id="q3-feedback"></div>
        </div>

        <!-- CONCLUSION (6 pts) -->
        <div class="q-block">
          <div class="q-label">Conclusion &mdash; 6 pts</div>
          <div class="q-text">You have analyzed 14 elements, weighed your own food, compared three inventory items, and flagged a contamination risk. Now make your case in a well-developed paragraph covering all three parts below.</div>
          <div style="background:var(--cream); border-left:3px solid var(--gold); padding:10px 14px; border-radius:4px; font-size:12.5px; line-height:1.9; margin-bottom:12px;">
            <strong>1.</strong> What does an element's position on the periodic table tell us about whether it belongs in food or poses a danger? Connect group and period to chemical behavior &mdash; go beyond stating where they are to explaining <em>why</em> that position matters.<br>
            <strong>2.</strong> What is the single most important thing you learned about your own food? Reference a specific value from your label or inventory comparison and explain what it means chemically.<br>
            <strong>3.</strong> What is your one actionable recommendation for Bracket City? Name a specific food or category, give a chemical reason, and identify who benefits most.
          </div>
          <textarea class="open-response" id="conclusion" style="min-height:130px;" placeholder="The periodic table shows that... because elements in the same group share... My own food, [name], taught me that... because [specific value from label or inventory]. My recommendation for Bracket City is to prioritize [food/category] because chemically... This benefits [population] most because..."></textarea>
          <button class="ai-btn" onclick="getAIFeedback('conclusion-feedback', 'conclusion', 'Conclusion (6 pts, 2 per part): Part 1 — periodic table chemistry: reward explanations connecting group/period position to electron configuration and ionic radius, explaining WHY similar position means similar behavior, not just where elements are located. Part 2 — personal food insight with specific data cited from label or inventory comparison. Part 3 — concrete Bracket City recommendation naming a food or category, a chemical reason (element function, mimicry, bioavailability, or contamination), and a benefiting population. Penalize vague responses that lack data, do not explain the chemistry mechanism, or fail to make a real recommendation.')">Get Feedback</button>
          <div class="ai-feedback-area" id="conclusion-feedback"></div>
        </div>
      </div>
    </div>


    <!-- SUBMIT -->
    <div class="submit-section">
      <div class="submit-info">
        <strong>Submit Your Lab Report</strong>
        All data fields and analysis questions will be scored automatically. Written responses receive AI-assisted instructor feedback. Complete all sections before submitting. Total: 55 points.
      </div>
      <div id="attempt-status" style="font-family:'JetBrains Mono',monospace; font-size:11.5px; color:#888; margin-bottom:10px; line-height:1.7;"></div>
      <button class="submit-main-btn" id="submit-btn" onclick="submitLab()">Submit Lab Report</button>
    </div>

    <!-- SCORE PANEL -->
    <div id="scorePanel" class="score-panel" style="display:none;">
      <div class="score-header">Lab 2 Score</div>
      <div class="score-bar-wrap"><div class="score-bar" id="scoreBar" style="width:0%"></div></div>
      <div class="score-text" id="scoreText"></div>
      <div class="score-details" id="scoreDetails"></div>
    </div>

    <!-- AI FEEDBACK REPORT PANEL -->
    <div id="feedbackReportPanel" style="display:none; margin-top:20px; background:#fff; border:1px solid #c8bfa8; border-left:4px solid var(--blue); border-radius:4px; padding:24px 28px; box-shadow:0 2px 12px rgba(26,26,46,0.07);">
      <div style="font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:600; letter-spacing:0.16em; text-transform:uppercase; color:var(--blue); margin-bottom:14px;">Instructor Feedback Report</div>
      <div id="feedbackReportContent" style="font-size:13.5px; line-height:1.8; color:#2a2a3e;">
        <div style="display:flex; align-items:center; gap:10px; color:#888; font-size:13px;">
          <div class="spinner" style="display:inline-block; width:16px; height:16px; border:2px solid #ddd; border-top-color:var(--blue); border-radius:50%; animation:spin 0.8s linear infinite;"></div>
          Generating your personalized feedback report...
        </div>
      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(5)">&larr; Back to Periodic Table</button>
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(7)">Bracket City Inventory &rarr;</button>
    </div>
  </div>
</div>

<!-- ============================================================ TAB 6: INVENTORY ============================================================ -->
<div id="tab-7" class="tab-panel">
  <div class="main">
    <div class="section-card">
      <div class="section-header">
        <div class="section-num">INV</div>
        <div class="section-title">Bracket City Food Bank Inventory</div>
        <div class="section-badge badge-gold">74 Items | Reference Tool</div>
      </div>
      <div class="section-body" style="padding:0;">

        <!-- Crisis Banner -->
        <div style="background:#c62828; color:white; padding:10px 18px; font-weight:600; font-size:13px; border-radius:2px; margin-bottom:0;">
          ACTIVE INVESTIGATION: 74 Items Under Analysis &mdash; 5,000 Residents Depending on Your Chemical Knowledge
        </div>

        <!-- Stats row -->
        <div style="display:grid; grid-template-columns:repeat(5,1fr); gap:8px; padding:12px; background:#f5f5f5;">
          <div style="background:#fff; padding:10px; border-radius:5px; text-align:center; border-left:3px solid #1565c0; box-shadow:0 1px 4px rgba(0,0,0,0.08);">
            <div style="font-size:1.7em; font-weight:700; color:#1565c0;" id="inv-total">52</div>
            <div style="font-size:11px; color:#666; margin-top:2px;">Total Items</div>
          </div>
          <div style="background:#fff; padding:10px; border-radius:5px; text-align:center; border-left:3px solid #1565c0; box-shadow:0 1px 4px rgba(0,0,0,0.08);">
            <div style="font-size:1.7em; font-weight:700; color:#1565c0;" id="inv-fortified">20</div>
            <div style="font-size:11px; color:#666; margin-top:2px;">Fortified Foods</div>
          </div>
          <div style="background:#fff; padding:10px; border-radius:5px; text-align:center; border-left:3px solid #2e7d32; box-shadow:0 1px 4px rgba(0,0,0,0.08);">
            <div style="font-size:1.7em; font-weight:700; color:#2e7d32;" id="inv-whole">26</div>
            <div style="font-size:11px; color:#666; margin-top:2px;">Whole Foods</div>
          </div>
          <div style="background:#fff; padding:10px; border-radius:5px; text-align:center; border-left:3px solid #c0392b; box-shadow:0 1px 4px rgba(0,0,0,0.08);">
            <div style="font-size:1.7em; font-weight:700; color:#c0392b;" id="inv-highrisk">6</div>
            <div style="font-size:11px; color:#666; margin-top:2px;">High Risk Items</div>
          </div>
          <div style="background:#fff; padding:10px; border-radius:5px; text-align:center; border-left:3px solid #e65100; box-shadow:0 1px 4px rgba(0,0,0,0.08);">
            <div style="font-size:1.7em; font-weight:700; color:#e65100;" id="inv-flags">13</div>
            <div style="font-size:11px; color:#666; margin-top:2px;">Contamination Flags</div>
          </div>
        </div>

        <!-- Search and Filter -->
        <div style="padding:12px; background:#fafafa; border-bottom:2px solid #e0e0e0;">
          <input type="text" id="inv-search" placeholder="Search by food name, compound, element, or contamination risk..." style="width:100%; padding:9px 12px; font-size:13px; border:2px solid #ddd; border-radius:5px; margin-bottom:10px; font-family:'DM Sans',sans-serif; outline:none; transition:border-color 0.2s;" onfocus="this.style.borderColor='#1565c0'" onblur="this.style.borderColor='#ddd'">
          <div style="display:flex; flex-wrap:wrap; gap:7px;" id="inv-filters">
            <button class="inv-filter-btn inv-active" data-inv-filter="all">All Items</button>
            <button class="inv-filter-btn" data-inv-filter="fortified">Fortified Foods</button>
            <button class="inv-filter-btn" data-inv-filter="whole">Whole Foods</button>
            <button class="inv-filter-btn" data-inv-filter="pantry">Pantry Staples</button>
            <button class="inv-filter-btn" data-inv-filter="highrisk">High Risk (Baby Food)</button>
            <button class="inv-filter-btn" data-inv-filter="contamination">Has Contamination Risk</button>
            <button class="inv-filter-btn" data-inv-filter="arsenic">Arsenic</button>
            <button class="inv-filter-btn" data-inv-filter="lead">Lead</button>
            <button class="inv-filter-btn" data-inv-filter="mercury">Mercury</button>
            <button class="inv-filter-btn" data-inv-filter="cadmium">Cadmium</button>
          </div>
        </div>

        <!-- Table -->
        <div style="overflow-x:auto;">
          <table id="inv-table" style="width:100%; border-collapse:collapse; font-size:12.5px;">
            <thead style="background:linear-gradient(135deg,#1a4a7a,#1565c0); color:white; position:sticky; top:0; z-index:5;">
              <tr>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="item"># ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="name">Food Name ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="category">Category ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="type">Type ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="iron">Fe (mg) ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="calcium">Ca (mg) ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap;">Key Compounds</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="risk">Risk ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="shelf">Shelf (mo) ⇅</th>
                <th style="padding:9px 7px; text-align:center; white-space:nowrap; cursor:pointer;" data-inv-sort="cost">Cost ⇅</th>
              </tr>
            </thead>
            <tbody id="inv-body"></tbody>
          </table>
          <div id="inv-noresults" style="display:none; text-align:center; padding:28px; color:#999; font-size:14px;">No items match your search criteria.</div>
        </div>

        <!-- Legend -->
        <div style="display:flex; flex-wrap:wrap; gap:12px; justify-content:center; padding:12px 16px; background:#fafafa; border-top:2px solid #e0e0e0;">
          <div style="display:flex; align-items:center; gap:6px; font-size:12px;"><span style="display:inline-block; padding:2px 8px; border-radius:10px; font-size:11px; font-weight:600; background:#e1f5fe; color:#0277bd;">Fortified</span> Nutrients added during processing</div>
          <div style="display:flex; align-items:center; gap:6px; font-size:12px;"><span style="display:inline-block; padding:2px 8px; border-radius:10px; font-size:11px; font-weight:600; background:#f1f8e9; color:#558b2f;">Whole Food</span> Natural nutrients only</div>
          <div style="display:flex; align-items:center; gap:6px; font-size:12px;"><span style="display:inline-block; padding:2px 8px; border-radius:10px; font-size:11px; font-weight:600; background:#fce4ec; color:#c2185b;">High Risk</span> Baby food requiring special testing</div>
          <div style="display:flex; align-items:center; gap:6px; font-size:12px;"><span style="display:inline-block; padding:3px 10px; border-radius:12px; font-size:11px; font-weight:600; background:#c8e6c9; color:#2e7d32;">Low Risk</span> No contamination detected</div>
          <div style="display:flex; align-items:center; gap:6px; font-size:12px;"><span style="display:inline-block; padding:3px 10px; border-radius:12px; font-size:11px; font-weight:600; background:#ffccbc; color:#d84315;">As / Pb / Hg / Cd</span> Contamination flagged</div>
        </div>

      </div>
    </div>

    <div class="nav-row">
      <button class="nav-btn nav-btn-secondary" onclick="switchTab(6)">&larr; Back to Analysis</button>
    </div>
  </div>
</div>

<!-- ============================================================ JAVASCRIPT ============================================================ -->
<script>
const SHEETS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbx69Jq2ktdQG0zE8tDc7LRqH_vve74sM4O5_cP-sPluaTdYNZVW9KlyU7eESxf96o4pvg/exec';
const AI_PROXY_ENDPOINT = 'https://script.google.com/macros/s/AKfycbx69Jq2ktdQG0zE8tDc7LRqH_vve74sM4O5_cP-sPluaTdYNZVW9KlyU7eESxf96o4pvg/exec';
const MAX_ATTEMPTS = 2;
const LAB_STORAGE_KEY = 'chem100_lab2_attempts';

// ====================================================================
// TAB NAVIGATION
// ====================================================================
const tabs = document.querySelectorAll('.tab-panel');
const tabBtns = document.querySelectorAll('.tab-btn');

function switchTab(idx) {
  tabs.forEach((t, i) => {
    t.classList.toggle('active', i === idx);
    tabBtns[i].classList.toggle('active', i === idx);
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ====================================================================
// PERIODIC TABLE
// ====================================================================
const elements = [
  // Period 1
  {sym:'H',  num:1,  name:'Hydrogen',   col:1,  row:1},
  {sym:'He', num:2,  name:'Helium',     col:18, row:1},
  // Period 2
  {sym:'Li', num:3,  name:'Lithium',    col:1,  row:2},
  {sym:'Be', num:4,  name:'Beryllium',  col:2,  row:2},
  {sym:'B',  num:5,  name:'Boron',      col:13, row:2},
  {sym:'C',  num:6,  name:'Carbon',     col:14, row:2},
  {sym:'N',  num:7,  name:'Nitrogen',   col:15, row:2},
  {sym:'O',  num:8,  name:'Oxygen',     col:16, row:2},
  {sym:'F',  num:9,  name:'Fluorine',   col:17, row:2},
  {sym:'Ne', num:10, name:'Neon',       col:18, row:2},
  // Period 3
  {sym:'Na', num:11, name:'Sodium',     col:1,  row:3},
  {sym:'Mg', num:12, name:'Magnesium',  col:2,  row:3},
  {sym:'Al', num:13, name:'Aluminum',   col:13, row:3},
  {sym:'Si', num:14, name:'Silicon',    col:14, row:3},
  {sym:'P',  num:15, name:'Phosphorus', col:15, row:3},
  {sym:'S',  num:16, name:'Sulfur',     col:16, row:3},
  {sym:'Cl', num:17, name:'Chlorine',   col:17, row:3},
  {sym:'Ar', num:18, name:'Argon',      col:18, row:3},
  // Period 4
  {sym:'K',  num:19, name:'Potassium',  col:1,  row:4},
  {sym:'Ca', num:20, name:'Calcium',    col:2,  row:4},
  {sym:'Sc', num:21, name:'Scandium',   col:3,  row:4},
  {sym:'Ti', num:22, name:'Titanium',   col:4,  row:4},
  {sym:'V',  num:23, name:'Vanadium',   col:5,  row:4},
  {sym:'Cr', num:24, name:'Chromium',   col:6,  row:4},
  {sym:'Mn', num:25, name:'Manganese',  col:7,  row:4},
  {sym:'Fe', num:26, name:'Iron',       col:8,  row:4},
  {sym:'Co', num:27, name:'Cobalt',     col:9,  row:4},
  {sym:'Ni', num:28, name:'Nickel',     col:10, row:4},
  {sym:'Cu', num:29, name:'Copper',     col:11, row:4},
  {sym:'Zn', num:30, name:'Zinc',       col:12, row:4},
  {sym:'Ga', num:31, name:'Gallium',    col:13, row:4},
  {sym:'Ge', num:32, name:'Germanium',  col:14, row:4},
  {sym:'As', num:33, name:'Arsenic',    col:15, row:4},
  {sym:'Se', num:34, name:'Selenium',   col:16, row:4},
  {sym:'Br', num:35, name:'Bromine',    col:17, row:4},
  {sym:'Kr', num:36, name:'Krypton',    col:18, row:4},
  // Period 5
  {sym:'Rb', num:37, name:'Rubidium',   col:1,  row:5},
  {sym:'Sr', num:38, name:'Strontium',  col:2,  row:5},
  {sym:'Y',  num:39, name:'Yttrium',    col:3,  row:5},
  {sym:'Zr', num:40, name:'Zirconium',  col:4,  row:5},
  {sym:'Nb', num:41, name:'Niobium',    col:5,  row:5},
  {sym:'Mo', num:42, name:'Molybdenum', col:6,  row:5},
  {sym:'Tc', num:43, name:'Technetium', col:7,  row:5},
  {sym:'Ru', num:44, name:'Ruthenium',  col:8,  row:5},
  {sym:'Rh', num:45, name:'Rhodium',    col:9,  row:5},
  {sym:'Pd', num:46, name:'Palladium',  col:10, row:5},
  {sym:'Ag', num:47, name:'Silver',     col:11, row:5},
  {sym:'Cd', num:48, name:'Cadmium',    col:12, row:5},
  {sym:'In', num:49, name:'Indium',     col:13, row:5},
  {sym:'Sn', num:50, name:'Tin',        col:14, row:5},
  {sym:'Sb', num:51, name:'Antimony',   col:15, row:5},
  {sym:'Te', num:52, name:'Tellurium',  col:16, row:5},
  {sym:'I',  num:53, name:'Iodine',     col:17, row:5},
  {sym:'Xe', num:54, name:'Xenon',      col:18, row:5},
  // Period 6
  {sym:'Cs', num:55, name:'Cesium',     col:1,  row:6},
  {sym:'Ba', num:56, name:'Barium',     col:2,  row:6},
  {sym:'La', num:57, name:'Lanthanum',  col:3,  row:6},
  {sym:'Hf', num:72, name:'Hafnium',    col:4,  row:6},
  {sym:'Ta', num:73, name:'Tantalum',   col:5,  row:6},
  {sym:'W',  num:74, name:'Tungsten',   col:6,  row:6},
  {sym:'Re', num:75, name:'Rhenium',    col:7,  row:6},
  {sym:'Os', num:76, name:'Osmium',     col:8,  row:6},
  {sym:'Ir', num:77, name:'Iridium',    col:9,  row:6},
  {sym:'Pt', num:78, name:'Platinum',   col:10, row:6},
  {sym:'Au', num:79, name:'Gold',       col:11, row:6},
  {sym:'Hg', num:80, name:'Mercury',    col:12, row:6},
  {sym:'Tl', num:81, name:'Thallium',   col:13, row:6},
  {sym:'Pb', num:82, name:'Lead',       col:14, row:6},
  {sym:'Bi', num:83, name:'Bismuth',    col:15, row:6},
  {sym:'Po', num:84, name:'Polonium',   col:16, row:6},
  {sym:'At', num:85, name:'Astatine',   col:17, row:6},
  {sym:'Rn', num:86, name:'Radon',      col:18, row:6},
  // Period 7
  {sym:'Fr', num:87, name:'Francium',   col:1,  row:7},
  {sym:'Ra', num:88, name:'Radium',     col:2,  row:7},
  {sym:'Ac', num:89, name:'Actinium',   col:3,  row:7},
  {sym:'Rf', num:104, name:'Rutherfordium', col:4, row:7},
  {sym:'Db', num:105, name:'Dubnium',   col:5,  row:7},
  {sym:'Sg', num:106, name:'Seaborgium',col:6,  row:7},
  {sym:'Bh', num:107, name:'Bohrium',   col:7,  row:7},
  {sym:'Hs', num:108, name:'Hassium',   col:8,  row:7},
  {sym:'Mt', num:109, name:'Meitnerium',col:9,  row:7},
  {sym:'Ds', num:110, name:'Darmstadtium',col:10,row:7},
  {sym:'Rg', num:111, name:'Roentgenium',col:11,row:7},
  {sym:'Cn', num:112, name:'Copernicium',col:12,row:7},
  {sym:'Nh', num:113, name:'Nihonium',  col:13, row:7},
  {sym:'Fl', num:114, name:'Flerovium', col:14, row:7},
  {sym:'Mc', num:115, name:'Moscovium', col:15, row:7},
  {sym:'Lv', num:116, name:'Livermorium',col:16,row:7},
  {sym:'Ts', num:117, name:'Tennessine',col:17, row:7},
  {sym:'Og', num:118, name:'Oganesson', col:18, row:7},
];

// State storage for element marks
const elementState = {}; // sym -> 'none'|'green'|'red'

function buildPeriodicTable() {
  const grid = document.getElementById('ptable');
  grid.innerHTML = '';
  // Build 7 rows x 18 cols
  const cellMap = {};
  elements.forEach(el => {
    cellMap[`${el.row}-${el.col}`] = el;
  });

  for (let row = 1; row <= 7; row++) {
    for (let col = 1; col <= 18; col++) {
      const el = cellMap[`${row}-${col}`];
      const div = document.createElement('div');
      if (!el) {
        div.className = 'pt-cell pt-empty';
      } else {
        div.className = 'pt-cell';
        div.id = 'pt-' + el.sym;
        div.innerHTML = `<span class="at-num">${el.num}</span><span class="sym">${el.sym}</span><span class="el-name">${el.name}</span>`;
        div.title = `${el.name} (${el.sym}) — Atomic #${el.num}. Click to mark.`;
        elementState[el.sym] = 'none';
        div.addEventListener('click', () => toggleElementMark(el.sym));
      }
      grid.appendChild(div);
    }
  }
}

function toggleElementMark(sym) {
  const current = elementState[sym];
  const next = current === 'none' ? 'green' : current === 'green' ? 'red' : 'none';
  elementState[sym] = next;
  const cell = document.getElementById('pt-' + sym);
  cell.classList.remove('marked-green', 'marked-red');
  if (next === 'green') cell.classList.add('marked-green');
  if (next === 'red') cell.classList.add('marked-red');
  updateElementCounts();
}

function updateElementCounts() {
  const greens = Object.values(elementState).filter(s => s === 'green').length;
  const reds = Object.values(elementState).filter(s => s === 'red').length;
  document.getElementById('green-count').textContent = greens;
  document.getElementById('red-count').textContent = reds;
}

buildPeriodicTable();

// ====================================================================
// PHOTO UPLOAD
// ====================================================================
// ====================================================================
// ADD MINERAL ROW
// ====================================================================
function addMineralRow() {
  const tbody = document.getElementById('mineral-tbody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" class="mineral-name" placeholder=""></td>
    <td><input type="text" class="mono mineral-sym" placeholder="" maxlength="3" oninput="formatChemSym(this)"></td>
    <td><input type="number" class="mineral-amt" placeholder="0.0" step="0.01" min="0"></td>
    <td><input type="text" class="mineral-serving" placeholder="g"></td>
    <td><input type="number" class="mineral-dv" placeholder="0" step="0.1" min="0" max="1000"></td>
    <td><input type="text" class="mineral-notes" placeholder=""></td>
  `;
  tbody.appendChild(tr);
}

// ====================================================================
// AI FEEDBACK (INDIVIDUAL QUESTIONS)
// ====================================================================
async function getAIFeedback(feedbackId, questionIds, questionLabel) {
  const feedbackArea = document.getElementById(feedbackId);

  // Collect responses
  const responses = questionIds.split(',').map(id => {
    const el = document.getElementById(id.trim());
    return el ? el.value.trim() : '';
  }).filter(r => r.length > 0);

  if (responses.length === 0) {
    alert('Please write a response before requesting feedback.');
    return;
  }

  if (!AI_PROXY_ENDPOINT) {
    feedbackArea.classList.add('visible');
    feedbackArea.innerHTML = '<strong style="display:block; font-family:JetBrains Mono,monospace; font-size:10px; letter-spacing:0.12em; text-transform:uppercase; color:var(--blue); margin-bottom:8px;">Instructor Feedback</strong><p style="margin:0;">AI feedback is not yet configured for this lab. Your response has been saved and will be reviewed by your instructor.</p>';
    return;
  }

  feedbackArea.classList.add('visible');
  feedbackArea.innerHTML = '<em style="color:#aaa; font-size:13px;">Analyzing your response...</em>';

  const studentName = document.getElementById('student-name').value.trim() || 'Student';
  const combinedResponse = responses.join('\n\n');

  const prompt = `Student: ${studentName}
Question: ${questionLabel}
Student Response: ${combinedResponse}

Provide brief, specific feedback (3-5 sentences). Be warm and encouraging. Point out what the student did well chemically, and identify any missing details or misconceptions. If they mention the periodic table, food labels, or elemental symbols, address the accuracy of those claims. Do not give the answer outright but guide them toward complete thinking. Use plain text, no markdown, no bullet points.`;

  const systemPrompt = `You are a chemistry instructor at a liberal arts university giving concise, constructive, scientifically accurate feedback on student lab reports for an introductory (CHEM 100) course. Your students are non-majors, many encountering chemistry formally for the first time. Be encouraging but rigorous. Connect chemistry to everyday experience. Never use bullet points. IMPORTANT: Before giving feedback, evaluate whether the writing sounds authentically like a first-year non-major student. Red flags for AI-generated text include: overly formal academic phrasing, sophisticated vocabulary inconsistent with introductory coursework, perfectly structured arguments with no errors or hesitation, hedging language like "it is worth noting" or "furthermore" or "in conclusion", and responses that address every possible angle of a question simultaneously with no personal voice. If the response shows these signs, do not give content feedback. Instead respond only with: "Your response reads like it may have been written with AI assistance. This is a CHEM 100 course and I want to hear your own thinking in your own words. Please rewrite this the way you would explain it to a friend — using simpler, more natural language. What do YOU actually understand about this topic?" If the writing is clearly a genuine student attempt — even if imperfect, incomplete, or grammatically rough — give normal constructive feedback.`;

  try {
    const res = await fetch(AI_PROXY_ENDPOINT, {
      method: 'POST',
      body: JSON.stringify({ action: 'feedback', system: systemPrompt, prompt })
    });
    const data = await res.json();
    const text = data.feedback || '';
    if (text) {
      feedbackArea.innerHTML = '<strong style="display:block; font-family:JetBrains Mono,monospace; font-size:10px; letter-spacing:0.12em; text-transform:uppercase; color:var(--blue); margin-bottom:8px;">Instructor Feedback</strong>' +
        text.split('\n').filter(l => l.trim()).map(l => `<p style="margin:0 0 8px 0;">${l}</p>`).join('');
    } else {
      feedbackArea.innerHTML = '<em style="color:#888; font-size:13px;">Feedback unavailable. Continue and your instructor will review this response.</em>';
    }
  } catch(e) {
    feedbackArea.innerHTML = '<em style="color:#888; font-size:13px;">Feedback unavailable at this time. Your response is recorded.</em>';
  }
}

// ====================================================================
// ATTEMPT MANAGEMENT
// ====================================================================
function getAttempts() {
  try { return JSON.parse(localStorage.getItem(LAB_STORAGE_KEY) || '[]'); } catch { return []; }
}
function saveAttempt(ts, score, total) {
  const attempts = getAttempts();
  attempts.push({ timestamp: ts, score, total });
  try { localStorage.setItem(LAB_STORAGE_KEY, JSON.stringify(attempts)); } catch {}
}
function updateAttemptStatus() {
  const attempts = getAttempts();
  const el = document.getElementById('attempt-status');
  if (!el) return;
  if (attempts.length === 0) {
    el.textContent = 'No submissions recorded on this device yet.';
  } else {
    el.textContent = `Submission ${attempts.length} of ${MAX_ATTEMPTS} recorded on this device.`;
    if (attempts.length >= MAX_ATTEMPTS) {
      const btn = document.getElementById('submit-btn');
      if (btn) { btn.disabled = true; btn.textContent = 'Maximum submissions reached'; }
    }
  }
}
updateAttemptStatus();

// ====================================================================
// Q7 PATH TOGGLE
// ====================================================================
function toggleQ7Paths() {
  const val = (document.querySelector('input[name="q7-in-inv"]:checked') || {}).value;
  document.getElementById('q7-path-yes').style.display     = val === 'yes'     ? 'block' : 'none';
  document.getElementById('q7-path-no').style.display      = val === 'no'      ? 'block' : 'none';
  document.getElementById('q7-path-similar').style.display = val === 'similar' ? 'block' : 'none';
}

// ====================================================================
// SCORING ENGINE
// ====================================================================
async function submitLab() {
  const name    = document.getElementById('student-name').value.trim();
  const section = document.getElementById('student-section').value.trim();
  const date    = document.getElementById('student-date').value.trim();

  if (!name) { alert('Please enter your name before submitting.'); return; }

  const attempts = getAttempts();
  if (attempts.length >= MAX_ATTEMPTS) {
    alert('You have reached the maximum number of submissions. Contact your instructor if needed.');
    return;
  }

  const total = 55;
  let score = 0;
  const details = [];

  // --- DT1: Combined Elements Table (10 pts) ---
  // 14 rows total (10 nutrients + 4 toxics). Each row: function/why field + sources field.
  // Count complete rows (both fields filled with meaningful content).
  // Scale: 14/14 = 10pts, partial credit graduated.
  const dt1Nutrients = ['ca','p','k','na','mg','fe','zn','cu','i','se'];
  let dt1CompleteRows = 0;
  dt1Nutrients.forEach(el => {
    const fn  = document.getElementById('dt1-' + el + '-fn');
    const src = document.getElementById('dt1-' + el + '-src');
    const fnOk  = fn  && fn.value.trim().length > 5;
    const srcOk = src && src.value.trim().length > 3;
    if (fnOk && srcOk) dt1CompleteRows++;
  });
  const dt2Metals = ['pb','as','hg','cd'];
  dt2Metals.forEach(m => {
    const why = document.getElementById('dt2-' + m + '-why');
    const src = document.getElementById('dt2-' + m + '-src');
    const whyOk = why && why.value.trim().length > 5;
    const srcOk = src && src.value.trim().length > 3;
    if (whyOk && srcOk) dt1CompleteRows++;
  });
  // Scale 14 rows -> 10 pts, graduated
  const dt1pts = dt1CompleteRows >= 14 ? 10 :
                 dt1CompleteRows >= 12 ? 9  :
                 dt1CompleteRows >= 10 ? 8  :
                 dt1CompleteRows >= 8  ? 6  :
                 dt1CompleteRows >= 6  ? 5  :
                 dt1CompleteRows >= 4  ? 3  :
                 dt1CompleteRows >= 2  ? 2  : 0;
  score += dt1pts;
  details.push('Data Table 1 (Elements): ' + dt1pts + '/10 (' + dt1CompleteRows + '/14 rows complete)');

  // --- DT2: Personal Food (6 pts) ---
  const foodName   = (document.getElementById('food-name')           || {}).value || '';
  const servLabel  = (document.getElementById('food-serving-labeled')|| {}).value || '';
  const servActual = (document.getElementById('food-serving-actual') || {}).value || '';
  const foodType   = (document.getElementById('food-type')           || {}).value || '';
  const mineralRows = document.querySelectorAll('#mineral-tbody tr');
  let filledMinerals = 0;
  mineralRows.forEach(row => {
    const nm = row.querySelector('.mineral-name');
    const am = row.querySelector('.mineral-amt');
    if (nm && nm.value.trim() && am && am.value) filledMinerals++;
  });
  let dt2pts = 0;
  if (foodName.trim())              dt2pts++;
  if (servLabel && servActual)      dt2pts++;
  if (foodType)                     dt2pts++;
  if (filledMinerals >= 2)          dt2pts++;
  if (filledMinerals >= 4)          dt2pts++;
  if (filledMinerals >= 6)          dt2pts++;
  dt2pts = Math.min(6, dt2pts);
  score += dt2pts;
  details.push('Data Table 2 (Personal Food): ' + dt2pts + '/6 (food: ' + (foodName.trim()||'blank') + ', ' + filledMinerals + ' minerals — photo graded separately via Canvas)');

  // --- DT3: Inventory Comparison (4 pts) ---
  // Rows 1 & 2: food name + at least one mineral/data field each = 1pt per row
  // Row 3 (personal food): food name + type = 2pts
  const dt3r1food = ((document.getElementById('dt3-r1-food')||{}).value||'').trim();
  const dt3r1data = ((document.getElementById('dt3-r1-mineral')||{}).value||'').trim() ||
                    ((document.getElementById('dt3-r1-fe')||{}).value||'').trim();
  const dt3r2food = ((document.getElementById('dt3-r2-food')||{}).value||'').trim();
  const dt3r2data = ((document.getElementById('dt3-r2-mineral')||{}).value||'').trim() ||
                    ((document.getElementById('dt3-r2-fe')||{}).value||'').trim();
  const dt3r3food = ((document.getElementById('dt3-r3-food')||{}).value||'').trim();
  const dt3r3type = ((document.getElementById('dt3-r3-type')||{}).value||'').trim();
  let dt3pts = 0;
  if (dt3r1food && dt3r1data) dt3pts++;
  if (dt3r2food && dt3r2data) dt3pts++;
  if (dt3r3food)              dt3pts++;
  if (dt3r3type)              dt3pts++;
  score += dt3pts;
  details.push('Data Table 3 (Inventory Comparison): ' + dt3pts + '/4 (fortified: ' + (dt3r1food||'blank') + ', whole: ' + (dt3r2food||'blank') + ', personal: ' + (dt3r3food||'blank') + ')');

  // --- Periodic Table (5 pts) ---
  const essentialSyms = ['Ca','P','K','Na','Mg','Fe','Zn','Cu','I','Se'];
  const toxicSyms     = ['Pb','As','Hg','Cd'];
  const blueCorrect   = essentialSyms.filter(s => elementState[s] === 'green').length;
  const redCorrect    = toxicSyms.filter(s => elementState[s] === 'red').length;
  const ptPct = (blueCorrect + redCorrect) / 14;
  const ptPts = ptPct >= 1 ? 5 : ptPct >= 0.8 ? 4 : ptPct >= 0.6 ? 3 : ptPct >= 0.4 ? 2 : ptPct >= 0.2 ? 1 : 0;
  score += ptPts;
  details.push('Periodic Table: ' + ptPts + '/5 (' + blueCorrect + '/10 blue correct, ' + redCorrect + '/4 red correct)');

  // --- Q1: Periodic Table Patterns + Mimicry Matching (6 pts) ---
  // 1pt: pattern sentence written (>20 chars)
  // 1pt: MC answered
  // 2pts: MC correct (B)
  // 2pts: matching accuracy (0.5pt each correct)
  const q1pattern = ((document.getElementById('q1-pattern')||{}).value||'').trim();
  const q1mc      = document.querySelector('input[name="q1-mc"]:checked');
  const correctMatches = { pb: 'ca', as: 'phosphate', hg: 'se', cd: 'zn' };
  let matchScore = 0;
  ['pb','as','hg','cd'].forEach(m => {
    const s = document.getElementById('q2-match-' + m);
    if (s && s.value === correctMatches[m]) matchScore += 0.5;
  });
  let q1pts = 0;
  if (q1pattern.length > 20)              q1pts += 1;
  if (q1mc)                               q1pts += 1;
  if (q1mc && q1mc.value === 'b')         q1pts += 2;
  q1pts += Math.round(matchScore * 2);   // 0.5 * 2 = 1 per correct, max 2
  q1pts = Math.min(6, q1pts);
  score += q1pts;
  const matchDetails = ['pb','as','hg','cd'].map(m => {
    const s = document.getElementById('q2-match-' + m);
    return m.toUpperCase() + ':' + (s && s.value ? (s.value === correctMatches[m] ? 'correct' : 'wrong') : 'blank');
  }).join(' ');
  details.push('Q1 (Patterns + Mimicry): ' + q1pts + '/6 (pattern: ' + (q1pattern.length > 20 ? 'written' : 'blank') + ', MC: ' + (q1mc ? q1mc.value.toUpperCase() + (q1mc.value==='b'?' [correct]':' [incorrect]') : 'blank') + ', matching: ' + matchDetails + ')');

  // --- Q2: Food Analysis + Inventory Comparison (10 pts) ---
  // 2pts: Part A grid complete (food name + type + fortify)
  // 3pts: Part B minerals (1pt per mineral with name + % DV, up to 3)
  // 1pt:  Part C inventory radio selected
  // 4pts: Part D written analysis quality (length + substance threshold)
  const q2foodConfirm = ((document.getElementById('q3-food-confirm')||{}).value||'').trim();
  const q2foodType    = ((document.getElementById('q3-food-type')||{}).value||'').trim();
  const q2fortify     = ((document.getElementById('q3-fortify')||{}).value||'').trim();
  const q2invRadio    = document.querySelector('input[name="q7-in-inv"]:checked');
  const q2written     = ((document.getElementById('q2-written')||{}).value||'').trim();
  let q2MineralPts = 0;
  [1,2,3].forEach(n => {
    const nm = ((document.getElementById('q3-m' + n + '-name')||{}).value||'').trim();
    const dv = ((document.getElementById('q3-m' + n + '-dv')||{}).value||'').trim();
    if (nm.length > 0 && dv.length > 0) q2MineralPts++;
  });
  let q2pts = 0;
  if (q2foodConfirm && q2foodType)   q2pts += 1;
  if (q2fortify)                     q2pts += 1;
  q2pts += Math.min(3, q2MineralPts);
  if (q2invRadio)                    q2pts += 1;
  if (q2written.length > 100)        q2pts += 1;
  if (q2written.length > 250)        q2pts += 1;
  if (q2written.length > 450)        q2pts += 2;
  q2pts = Math.min(10, q2pts);
  score += q2pts;
  details.push('Q2 (Food + Inventory Analysis): ' + q2pts + '/10 (grid: ' + (q2foodConfirm||'blank') + ', minerals: ' + q2MineralPts + '/3, inventory path: ' + (q2invRadio ? q2invRadio.value : 'not selected') + ', written: ' + (q2written.length === 0 ? 'blank' : q2written.length + ' chars') + ')');

  // --- Q3: Contamination T/F + Risk Flag + Written (8 pts) ---
  // 4pts: T/F (1pt each: TF1=T, TF2=T, TF3=T, TF4=F)
  // 1pt:  flag item named
  // 1pt:  toxin radio selected
  // 2pts: written explanation quality
  const tfAnswers = { 1: 'T', 2: 'T', 3: 'T', 4: 'F' };
  let tfScore = 0;
  [1,2,3,4].forEach(n => {
    const val = ((document.getElementById('tf-val-' + n)||{}).value||'');
    if (val === tfAnswers[n]) tfScore++;
  });
  const q6item   = ((document.getElementById('q6-item')||{}).value||'').trim();
  const q6toxin  = document.querySelector('input[name="q6-toxin"]:checked');
  const q6written = ((document.getElementById('q6b')||{}).value||'').trim();
  let q3pts = tfScore;
  if (q6item.length > 2)   q3pts += 1;
  if (q6toxin)              q3pts += 1;
  if (q6written.length > 80)  q3pts += 1;
  if (q6written.length > 220) q3pts += 1;
  q3pts = Math.min(8, q3pts);
  score += q3pts;
  const tfDetail = [1,2,3,4].map(n => {
    const val = ((document.getElementById('tf-val-' + n)||{}).value||'?');
    return 'TF' + n + ':' + val + (val === tfAnswers[n] ? '(+)' : val === '?' ? '' : '(x)');
  }).join(' ');
  details.push('Q3 (Contamination + Storage): ' + q3pts + '/8 (' + tfDetail + ', flagged: ' + (q6item||'blank') + ', toxin: ' + (q6toxin ? q6toxin.value : 'none') + ', written: ' + (q6written.length||0) + ' chars)');

  // --- Conclusion (6 pts) ---
  const conclusionText = ((document.getElementById('conclusion')||{}).value||'').trim();
  let concPts = 0;
  if (conclusionText.length > 80)  concPts = 2;
  if (conclusionText.length > 200) concPts = 4;
  if (conclusionText.length > 400) concPts = 6;
  score += concPts;
  details.push('Conclusion: ' + concPts + '/6 (' + (conclusionText.length === 0 ? 'blank' : conclusionText.length + ' chars') + ')');

  const pct = Math.round((score / total) * 100);
  const timestamp = new Date().toLocaleString();

  // Collect mineral rows for payload
  const mineralData = [];
  document.querySelectorAll('#mineral-tbody tr').forEach(row => {
    const nm = row.querySelector('.mineral-name');
    const sy = row.querySelector('.mineral-sym');
    const am = row.querySelector('.mineral-amt');
    const dv = row.querySelector('.mineral-dv');
    if (nm && nm.value.trim()) {
      mineralData.push(nm.value + '(' + (sy ? sy.value : '') + '):' + (am ? am.value : '') + 'mg,' + (dv ? dv.value : '') + '%DV');
    }
  });

  const ptSummary = essentialSyms.map(s => s + ':' + elementState[s]).join(',') + '|' +
                    toxicSyms.map(s => s + ':' + elementState[s]).join(',');

  const get = id => ((document.getElementById(id)||{}).value||'').trim();

  const payload = {
    lab_id: 'Lab_2',
    timestamp, name, section, date,
    score: score.toFixed(1), total, percent: pct,
    // DT2 personal food
    food_item:             foodName.trim() || 'blank',
    food_type:             foodType || 'blank',
    food_serving_labeled:  servLabel || 'blank',
    food_serving_actual:   servActual || 'blank',
    minerals_recorded:     mineralData.join(' | ') || 'blank',
    fortification_compounds: get('fortification-compounds') || 'blank',
    // Periodic table
    periodic_table_marks: ptSummary,
    // Q1
    q1_response: (() => {
      const mc = document.querySelector('input[name="q1-mc"]:checked');
      const matches = ['pb','as','hg','cd'].map(m => {
        const s = document.getElementById('q2-match-' + m);
        return m.toUpperCase() + '->' + (s && s.value ? s.options[s.selectedIndex].text.split('—')[0].trim() : 'blank');
      }).join(' | ');
      return 'Pattern: ' + (get('q1-pattern')||'blank') + ' | MC: ' + (mc ? mc.value.toUpperCase() : 'blank') + ' | Matches: ' + matches;
    })(),
    // Q2
    q2_response: (() => {
      const minerals = [1,2,3].map(n =>
        [get('q3-m'+n+'-name'), get('q3-m'+n+'-sym'), get('q3-m'+n+'-dv')+'%DV']
          .filter(v => v && v !== '%DV').join('/')
      ).filter(Boolean).join(' | ') || 'none';
      const inv = document.querySelector('input[name="q7-in-inv"]:checked');
      return 'Food: ' + get('q3-food-confirm') + ' | Type: ' + get('q3-food-type') +
             ' | Fortify: ' + get('q3-fortify') + ' | Minerals: ' + minerals +
             ' | Inventory path: ' + (inv ? inv.value : 'not selected') +
             ' | Analysis: ' + get('q2-written');
    })(),
    // Q3
    q3_response: (() => {
      const tfs = [1,2,3,4].map(n => 'TF'+n+':'+(((document.getElementById('tf-val-'+n)||{}).value)||'?')).join(' ');
      const toxin = document.querySelector('input[name="q6-toxin"]:checked');
      return tfs + ' | Flagged: ' + get('q6-item') + ' | Toxin: ' + (toxin ? toxin.value : 'none') + ' | Explanation: ' + get('q6b');
    })(),
    // DT3 inventory comparison
    dt3_comparison: (() => {
      const r = n => ({
        food: get('dt3-r'+n+'-food'), mineral: get('dt3-r'+n+'-mineral'),
        fe: get('dt3-r'+n+'-fe'), risk: get('dt3-r'+n+'-risk'), shelf: get('dt3-r'+n+'-shelf')
      });
      return [1,2,3].map(n => 'Row'+n+':'+JSON.stringify(r(n))).join(' | ');
    })(),
    conclusion: get('conclusion'),
    details: details.join(' | ')
  };

  showScorePanel(name, score, total, pct, timestamp, details);
  saveAttempt(timestamp, score.toFixed(1), total);
  updateAttemptStatus();
  generateFeedbackReport(name, score, total, pct, details, payload);

  if (SHEETS_ENDPOINT) {
    const statusEl = document.getElementById('sheets-status');
    if (statusEl) { statusEl.textContent = 'Sending to gradebook...'; statusEl.style.color = 'var(--gold)'; }
    try {
      await fetch(SHEETS_ENDPOINT, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (statusEl) { statusEl.textContent = 'Submitted to gradebook successfully.'; statusEl.style.color = 'var(--green)'; }
    } catch(err) {
      if (statusEl) { statusEl.textContent = 'Could not reach gradebook — screenshot your score and email it to your instructor.'; statusEl.style.color = 'var(--red)'; }
    }
  }
}
// ====================================================================
// SHOW SCORE PANEL
// ====================================================================
function showScorePanel(name, score, total, pct, timestamp, details) {
  const panel = document.getElementById('scorePanel');
  panel.classList.add('visible');
  panel.scrollIntoView({ behavior: 'smooth', block: 'start' });

  setTimeout(() => {
    const bar = document.getElementById('scoreBar');
    bar.style.width = pct + '%';
    bar.style.background = pct >= 85 ? 'var(--green)' : pct >= 65 ? 'var(--gold)' : 'var(--red)';
  }, 100);

  document.getElementById('scoreText').textContent = name + '  |  ' + score.toFixed(1) + ' / ' + total + ' pts  (' + pct + '%)  |  ' + timestamp;
  document.getElementById('scoreDetails').innerHTML =
    '<strong style="display:block;margin-bottom:8px;">Item-by-item breakdown:</strong>' +
    details.map(d => '<span style="display:block; padding:3px 0; border-bottom:1px dashed var(--rule);">' + d + '</span>').join('') +
    '<div style="margin-top:12px; padding:12px; background:var(--orange-light); border-radius:3px; font-size:12.5px; color:#3e2000; line-height:1.6;"><strong>Reminder:</strong> Your Canvas Discussion Board post (20 pts) is graded separately. Make sure it is submitted on Canvas before the deadline.</div>' +
    '<div id="sheets-status" style="margin-top:12px; font-family:JetBrains Mono,monospace; font-size:11px;"></div>';
}

// ====================================================================
// AI FEEDBACK REPORT
// ====================================================================
async function generateFeedbackReport(name, score, total, pct, details, payload) {
  const panel = document.getElementById('feedbackReportPanel');
  const content = document.getElementById('feedbackReportContent');
  panel.style.display = 'block';
  panel.scrollIntoView({ behavior: 'smooth', block: 'start' });

  const attemptNum = getAttempts().length;
  const attemptsLeft = MAX_ATTEMPTS - attemptNum;

  const prompt = `You are an encouraging CHEM 100 instructor providing personalized written feedback after a student submitted Lab 2: Food Elements Investigation.

Student: ${name}
Score: ${score.toFixed(1)} / ${total} points (${pct}%)
Attempt: ${attemptNum} of ${MAX_ATTEMPTS}
Attempts remaining: ${attemptsLeft}

Item-by-item scoring:
${details.join('\n')}

Student data summary:
- Food item analyzed: ${payload.food_item} (${payload.food_type})
- Minerals recorded: ${payload.minerals_recorded}
- Fortification compounds noted: ${payload.fortification_compounds}
- Periodic table marks: ${payload.periodic_table_marks}
- Q1 (Periodic Table Patterns): ${payload.q1_response ? payload.q1_response.substring(0, 200) : 'blank'}
- Q2 (Ca vs Pb similarity): ${payload.q2_response ? payload.q2_response.substring(0, 200) : 'blank'}
- Q3 (Personal food): ${payload.q3_response ? payload.q3_response.substring(0, 200) : 'blank'}
- Conclusion: ${payload.conclusion ? payload.conclusion.substring(0, 200) : 'blank'}

Write personalized feedback with sections:
1. Brief warm opening (1-2 sentences) acknowledging their specific score
2. STRENGTHS — 2-3 specific things they did well, referencing actual responses or data
3. AREAS TO REVIEW — specific items where points were lost, with brief explanation of the correct chemistry (do not just say "review this")
4. PERIODIC TABLE — comment on whether their element marking appears correct; note patterns they should have observed about nutrient vs. toxin placement
5. FOOD ANALYSIS — briefly comment on their specific food item choice; are their mineral values plausible? Any flags?
6. If attempt 1 of 2: 1-2 specific, actionable things to improve before resubmission
7. If attempt 2 of 2: encouragement and note that instructor will review written responses

Tone: warm, specific, constructive. Plain text with ALL CAPS section headers. No markdown. 4-6 paragraphs.`;

  if (!AI_PROXY_ENDPOINT) {
    content.innerHTML = '<p style="color:#888;">AI feedback is not configured. Your score has been recorded in the gradebook.</p>';
    return;
  }

  try {
    const response = await fetch(AI_PROXY_ENDPOINT, {
      method: 'POST',
      body: JSON.stringify({
        action: 'feedback',
        system: 'You are an encouraging CHEM 100 instructor providing personalized post-submission feedback. Be warm, specific, and constructive. Use plain text only, no markdown, no bullet points.',
        prompt
      })
    });
    const data = await response.json();
    const text = data.feedback || null;
    if (text) {
      const formatted = text.split('\n').map(line => {
        const t = line.trim();
        if (!t) return '<br>';
        if (/^[A-Z][A-Z\s\-&]+[A-Z:]$/.test(t) || /^[A-Z][A-Z\s]+:/.test(t)) {
          return '<strong style="display:block; margin-top:16px; margin-bottom:4px; font-family:JetBrains Mono,monospace; font-size:11px; letter-spacing:0.12em; color:var(--blue);">' + t + '</strong>';
        }
        return '<p style="margin:0 0 10px 0;">' + t + '</p>';
      }).join('');
      content.innerHTML = formatted;
    } else {
      content.innerHTML = '<p style="color:var(--red);">Feedback could not be generated. Your score is recorded. Please review the breakdown above.</p>';
    }
  } catch(err) {
    content.innerHTML = '<p style="color:var(--red);">Feedback unavailable at this time. Your score has been recorded successfully.</p>';
  }
}

// ====================================================================
// CHEMICAL SYMBOL FORMATTER
// Enforces: first letter uppercase, subsequent letters lowercase
// e.g. "fe" -> "Fe", "MG" -> "Mg", "NA" -> "Na"
// ====================================================================
function formatChemSym(input) {
  const raw = input.value.replace(/[^a-zA-Z]/g, '');
  if (!raw) { input.value = ''; return; }
  const formatted = raw.charAt(0).toUpperCase() + raw.slice(1).toLowerCase();
  input.value = formatted;
}

// ====================================================================
// Q1 MULTIPLE CHOICE
// ====================================================================
const Q1_CORRECT = 'b';
const Q1_EXPLANATIONS = {
  a: 'Incorrect. Nutrient distribution on the periodic table is not random &mdash; essential elements cluster in predictable blocks. Groups predict chemical behavior, and that structure directly determines biological function.',
  b: 'Correct. Essential macro- and micronutrients (Ca, Na, K, Mg, Fe, Zn, I, Se, P, Cu) are concentrated in the s-block and p-block. Toxic heavy metals like Pb, Hg, Cd, and As sit in the d-block or lower p-block. Elements in the same group share valence electron configurations, which is why Pb mimics Ca and As mimics phosphate &mdash; the body cannot always distinguish them at the point of absorption.',
  c: 'Incorrect. Period 6 placement does not automatically confer toxicity &mdash; barium (Ba, Period 6, Group 2) is used safely in medical imaging at controlled doses. Toxicity is determined by biological function, dose, and chemical behavior, not period number alone.',
  d: 'Incorrect. The entire foundation of predicting nutrient function and contamination risk rests on periodic trends. Group membership (valence electrons, ionic radius, electronegativity) is precisely why certain toxic metals mimic essential nutrients.'
};

function handleMC(qid, selected) {
  ['a','b','c','d'].forEach(opt => {
    const el = document.getElementById(`${qid}-opt-${opt}`);
    if (!el) return;
    el.classList.remove('mc-selected','mc-correct','mc-incorrect');
    if (opt === selected) el.classList.add('mc-selected');
  });
}

// ====================================================================
// Q2 MATCHING
// ====================================================================
const Q2_ANSWERS = { 'q2-match-pb': 'ca', 'q2-match-as': 'phosphate', 'q2-match-hg': 'se', 'q2-match-cd': 'zn' };

function highlightMatch(sel) {
  // no immediate feedback — selection recorded silently
}

function checkMatching() {
  // answers recorded in selects; scoring happens at submission
}

// ====================================================================
// Q5 TRUE / FALSE
// ====================================================================
const TF_ANSWERS = { 1:'T', 2:'F', 3:'T', 4:'F', 5:'T', 6:'F' };

function selectTF(num, val) {
  const item = document.getElementById(`tf-${num}`);
  const hidden = document.getElementById(`tf-val-${num}`);
  if (!item || !hidden) return;
  hidden.value = val;
  const btns = item.querySelectorAll('.tf-btn');
  btns.forEach(b => { b.classList.remove('tf-true-selected','tf-false-selected'); });
  if (val === 'T') btns[0].classList.add('tf-true-selected');
  else             btns[1].classList.add('tf-false-selected');
}

function checkTrueFalse() {
  // answers recorded in hidden inputs; scoring happens at submission
}

// ====================================================================
// SUBMISSION DATA COLLECTION (append new field IDs)
// ====================================================================
// ====================================================================
const inventoryData = [
  {item:1,  name:"General Mills Cheerios",      category:"Fortified Cereal",   type:"Fortified",  iron:8.99, calcium:89.9,  compounds:"Reduced Iron, Calcium Carbonate, Zinc Oxide",                                              shelf:12,  cost:0.32, risk:"Low",          vulnerable:"None"},
  {item:2,  name:"Kellogg's Corn Flakes",        category:"Fortified Cereal",   type:"Fortified",  iron:12.2, calcium:2,     compounds:"Ferrous Sulfate, Salt",                                                                     shelf:12,  cost:0.28, risk:"Low",          vulnerable:"None"},
  {item:3,  name:"Post Raisin Bran",             category:"Fortified Cereal",   type:"Fortified",  iron:16.2, calcium:29,    compounds:"Ferrous Orthophosphate, Zinc Oxide",                                                        shelf:9,   cost:0.45, risk:"Low",          vulnerable:"None"},
  {item:4,  name:"Quaker Instant Oatmeal",       category:"Fortified Cereal",   type:"Fortified",  iron:7.2,  calcium:150,   compounds:"Ferric Orthophosphate, Calcium Carbonate",                                                  shelf:18,  cost:0.40, risk:"Low",          vulnerable:"None"},
  {item:5,  name:"Wonder Bread",                 category:"Fortified Grain",    type:"Fortified",  iron:2.7,  calcium:120,   compounds:"Ferrous Sulfate, Calcium Propionate",                                                       shelf:0.3, cost:0.22, risk:"Low",          vulnerable:"None"},
  {item:6,  name:"Nature's Own Whole Wheat",     category:"Fortified Grain",    type:"Fortified",  iron:1.8,  calcium:40,    compounds:"Ferrous Sulfate",                                                                           shelf:0.3, cost:0.35, risk:"Low",          vulnerable:"None"},
  {item:7,  name:"Enriched White Rice",          category:"Fortified Grain",    type:"Fortified",  iron:2.8,  calcium:16,    compounds:"Ferric Orthophosphate",                                                                     shelf:24,  cost:0.15, risk:"Arsenic",      vulnerable:"Infants/Children"},
  {item:8,  name:"Kellogg's Special K Protein",  category:"Fortified Cereal",   type:"Fortified",  iron:18,   calcium:200,   compounds:"Ferrous Fumarate, Zinc Oxide, Calcium Carbonate",                                           shelf:12,  cost:0.55, risk:"Low",          vulnerable:"None"},
  {item:9,  name:"Cheerios Multi-Grain",         category:"Fortified Cereal",   type:"Fortified",  iron:9,    calcium:100,   compounds:"Ferrous Fumarate, Calcium Carbonate, Zinc Oxide",                                           shelf:12,  cost:0.38, risk:"Low",          vulnerable:"None"},
  {item:10, name:"Cream of Wheat",               category:"Fortified Cereal",   type:"Fortified",  iron:11,   calcium:150,   compounds:"Ferric Orthophosphate, Calcium Carbonate",                                                  shelf:24,  cost:0.25, risk:"Low",          vulnerable:"None"},
  {item:11, name:"Barilla Pasta",                category:"Fortified Grain",    type:"Fortified",  iron:2.1,  calcium:10,    compounds:"Ferrous Sulfate",                                                                           shelf:24,  cost:0.30, risk:"Low",          vulnerable:"None"},
  {item:12, name:"General Mills Total",          category:"Fortified Cereal",   type:"Fortified",  iron:18,   calcium:1000,  compounds:"Ferric Orthophosphate, Calcium Carbonate, Zinc Oxide",                                      shelf:12,  cost:0.62, risk:"Low",          vulnerable:"None"},
  {item:13, name:"Silk Almond Milk",             category:"Fortified Beverage", type:"Fortified",  iron:0.7,  calcium:450,   compounds:"Calcium Carbonate, Tricalcium Phosphate",                                                   shelf:6,   cost:0.45, risk:"Low",          vulnerable:"None"},
  {item:14, name:"Oatly Oat Milk",               category:"Fortified Beverage", type:"Fortified",  iron:0.6,  calcium:350,   compounds:"Calcium Carbonate, Dicalcium Phosphate",                                                    shelf:0.3, cost:0.50, risk:"Low",          vulnerable:"None"},
  {item:15, name:"Gatorade Orange",              category:"Fortified Beverage", type:"Fortified",  iron:0,    calcium:0,     compounds:"Sodium Chloride, Monopotassium Phosphate",                                                  shelf:9,   cost:0.75, risk:"Low",          vulnerable:"None"},
  {item:16, name:"Powerade Fruit Punch",         category:"Fortified Beverage", type:"Fortified",  iron:0,    calcium:0,     compounds:"Salt, Potassium Citrate",                                                                   shelf:9,   cost:0.65, risk:"Low",          vulnerable:"None"},
  {item:17, name:"Ensure Original",             category:"Fortified Beverage", type:"Fortified",  iron:4.5,  calcium:300,   compounds:"Ferrous Sulfate, Calcium Phosphate, Magnesium Chloride, Zinc Sulfate",                      shelf:15,  cost:2.50, risk:"Low",          vulnerable:"None"},
  {item:18, name:"Tropicana OJ Calcium",         category:"Fortified Beverage", type:"Fortified",  iron:0.5,  calcium:350,   compounds:"Calcium Hydroxide, Tricalcium Phosphate",                                                   shelf:0.2, cost:0.60, risk:"Low",          vulnerable:"None"},
  {item:19, name:"V8 Vegetable Juice",           category:"Fortified Beverage", type:"Whole Food", iron:0.7,  calcium:30,    compounds:"Natural minerals from vegetables",                                                          shelf:0.2, cost:0.55, risk:"Low",          vulnerable:"None"},
  {item:20, name:"Soylent Complete",             category:"Fortified Beverage", type:"Fortified",  iron:8,    calcium:500,   compounds:"Calcium Carbonate, Ferrous Fumarate, Magnesium Phosphate, Zinc Gluconate, Potassium Iodide",shelf:12,  cost:3.00, risk:"Low",          vulnerable:"None"},
  {item:21, name:"Bananas",                      category:"Produce",            type:"Whole Food", iron:0.3,  calcium:5,     compounds:"Natural",                                                                                   shelf:0.2, cost:0.15, risk:"Low",          vulnerable:"None"},
  {item:22, name:"Spinach",                      category:"Produce",            type:"Whole Food", iron:2.7,  calcium:99,    compounds:"Natural",                                                                                   shelf:0.1, cost:0.40, risk:"Cadmium",      vulnerable:"Children"},
  {item:23, name:"Carrots",                      category:"Produce",            type:"Whole Food", iron:0.3,  calcium:33,    compounds:"Natural",                                                                                   shelf:1,   cost:0.25, risk:"Lead",         vulnerable:"Children"},
  {item:24, name:"Broccoli",                     category:"Produce",            type:"Whole Food", iron:0.7,  calcium:47,    compounds:"Natural",                                                                                   shelf:0.3, cost:0.50, risk:"Low",          vulnerable:"None"},
  {item:25, name:"Sweet Potatoes",               category:"Produce",            type:"Whole Food", iron:0.6,  calcium:30,    compounds:"Natural",                                                                                   shelf:0.8, cost:0.30, risk:"Lead",         vulnerable:"Children"},
  {item:26, name:"Tomatoes",                     category:"Produce",            type:"Whole Food", iron:0.3,  calcium:10,    compounds:"Natural",                                                                                   shelf:0.3, cost:0.35, risk:"Low",          vulnerable:"None"},
  {item:27, name:"Apples",                       category:"Produce",            type:"Whole Food", iron:0.1,  calcium:6,     compounds:"Natural",                                                                                   shelf:1.5, cost:0.40, risk:"Low",          vulnerable:"None"},
  {item:28, name:"Oranges",                      category:"Produce",            type:"Whole Food", iron:0.1,  calcium:40,    compounds:"Natural",                                                                                   shelf:0.8, cost:0.45, risk:"Low",          vulnerable:"None"},
  {item:29, name:"Kale",                         category:"Produce",            type:"Whole Food", iron:1.5,  calcium:150,   compounds:"Natural",                                                                                   shelf:0.2, cost:0.60, risk:"Cadmium",      vulnerable:"Children"},
  {item:30, name:"Green Beans",                  category:"Produce",            type:"Whole Food", iron:1.0,  calcium:37,    compounds:"Natural",                                                                                   shelf:0.2, cost:0.45, risk:"Low",          vulnerable:"None"},
  {item:31, name:"Canned Tuna",                  category:"Protein",            type:"Whole Food", iron:0.8,  calcium:11,    compounds:"Tuna, water, salt",                                                                         shelf:48,  cost:0.85, risk:"Mercury",      vulnerable:"Pregnant/Children"},
  {item:32, name:"Canned Salmon",                category:"Protein",            type:"Whole Food", iron:0.7,  calcium:277,   compounds:"Salmon, water, salt",                                                                       shelf:48,  cost:1.20, risk:"Low",          vulnerable:"None"},
  {item:33, name:"Chicken Breast",               category:"Protein",            type:"Whole Food", iron:0.5,  calcium:11,    compounds:"Natural",                                                                                   shelf:0.1, cost:1.50, risk:"Low",          vulnerable:"None"},
  {item:34, name:"Ground Beef",                  category:"Protein",            type:"Whole Food", iron:2.1,  calcium:18,    compounds:"Natural",                                                                                   shelf:0.1, cost:2.00, risk:"Low",          vulnerable:"None"},
  {item:35, name:"Eggs",                         category:"Protein",            type:"Whole Food", iron:1.8,  calcium:56,    compounds:"Natural",                                                                                   shelf:1,   cost:0.60, risk:"Low",          vulnerable:"None"},
  {item:36, name:"Peanut Butter",                category:"Protein",            type:"Whole Food", iron:0.6,  calcium:17,    compounds:"Peanuts, salt, sugar",                                                                      shelf:9,   cost:0.25, risk:"Low",          vulnerable:"None"},
  {item:37, name:"Black Beans",                  category:"Protein",            type:"Whole Food", iron:2.1,  calcium:35,    compounds:"Black beans, water, salt",                                                                  shelf:48,  cost:0.40, risk:"Low",          vulnerable:"None"},
  {item:38, name:"Chickpeas",                    category:"Protein",            type:"Whole Food", iron:2.9,  calcium:49,    compounds:"Chickpeas, water, salt",                                                                    shelf:48,  cost:0.45, risk:"Low",          vulnerable:"None"},
  {item:39, name:"Tofu",                         category:"Protein",            type:"Whole Food", iron:5.4,  calcium:350,   compounds:"Soybeans, water, calcium sulfate",                                                          shelf:0.3, cost:0.80, risk:"Low",          vulnerable:"None"},
  {item:40, name:"Almonds",                      category:"Protein",            type:"Whole Food", iron:1.1,  calcium:75,    compounds:"Natural",                                                                                   shelf:12,  cost:0.70, risk:"Low",          vulnerable:"None"},
  {item:41, name:"Whole Milk",                   category:"Dairy",              type:"Whole Food", iron:0,    calcium:276,   compounds:"Natural (Vitamin D added)",                                                                shelf:0.2, cost:0.50, risk:"Low",          vulnerable:"None"},
  {item:42, name:"Cheddar Cheese",               category:"Dairy",              type:"Whole Food", iron:0.2,  calcium:204,   compounds:"Natural",                                                                                   shelf:1,   cost:0.80, risk:"Low",          vulnerable:"None"},
  {item:43, name:"Greek Yogurt",                 category:"Dairy",              type:"Whole Food", iron:0.1,  calcium:187,   compounds:"Natural",                                                                                   shelf:0.4, cost:1.10, risk:"Low",          vulnerable:"None"},
  {item:44, name:"Cottage Cheese",               category:"Dairy",              type:"Whole Food", iron:0.2,  calcium:125,   compounds:"Natural",                                                                                   shelf:0.3, cost:0.75, risk:"Low",          vulnerable:"None"},
  {item:45, name:"Butter",                       category:"Dairy",              type:"Whole Food", iron:0,    calcium:3,     compounds:"Natural",                                                                                   shelf:3,   cost:0.30, risk:"Low",          vulnerable:"None"},
  {item:46, name:"Gerber Rice Cereal",           category:"Baby Food",          type:"High Risk",  iron:7,    calcium:90,    compounds:"Electrolytic Iron, Calcium Carbonate, Zinc Sulfate",                                        shelf:12,  cost:0.35, risk:"Arsenic",      vulnerable:"Infants 4-12mo"},
  {item:47, name:"Beech-Nut Carrots",            category:"Baby Food",          type:"High Risk",  iron:0.3,  calcium:26,    compounds:"Carrots, water",                                                                            shelf:24,  cost:0.90, risk:"Lead",         vulnerable:"Infants 4-12mo"},
  {item:48, name:"Earth's Best Organic Biscuits",  category:"Baby Food",          type:"High Risk",  iron:1.2,  calcium:20,    compounds:"Whole grain wheat flour",                                                                   shelf:12,  cost:0.45, risk:"Cadmium/Lead", vulnerable:"Infants 6-12mo"},
  {item:49, name:"Happy Baby Puffs",             category:"Baby Food",          type:"High Risk",  iron:1.4,  calcium:50,    compounds:"Rice flour, sweet potato powder",                                                           shelf:12,  cost:0.55, risk:"Arsenic/Lead", vulnerable:"Infants 6-12mo"},
  {item:50, name:"Baby Spinach Puree",           category:"Baby Food",          type:"High Risk",  iron:0.8,  calcium:30,    compounds:"Spinach, water",                                                                            shelf:18,  cost:0.85, risk:"Cadmium",      vulnerable:"Infants 4-12mo"},
  {item:51, name:"Canned Tuna (Toddler)",        category:"Baby Food",          type:"High Risk",  iron:0.7,  calcium:9,     compounds:"Tuna, water, salt",                                                                         shelf:48,  cost:0.72, risk:"Mercury",      vulnerable:"Pregnant/Children <6"},
  {item:52, name:"Apple Juice",                  category:"Baby Food",          type:"High Risk",  iron:0.3,  calcium:17,    compounds:"Apples, water",                                                                             shelf:12,  cost:0.40, risk:"Arsenic",      vulnerable:"Children <6"},

  // --- PANTRY STAPLES ---
  // Baking foundations
  {item:53, name:"All-Purpose Flour (Enriched)", category:"Pantry Staple",      type:"Fortified",  iron:1.6,  calcium:7,     compounds:"Reduced Iron, Niacin, Thiamin Mononitrate, Riboflavin, Folic Acid",                           shelf:12,  cost:0.08, risk:"Low",          vulnerable:"None"},
  {item:54, name:"Baking Powder",                category:"Pantry Staple",      type:"Whole Food", iron:0.1,  calcium:58,    compounds:"Sodium bicarbonate, Cream of tartar, Monocalcium phosphate",                                   shelf:12,  cost:0.05, risk:"Low",          vulnerable:"None"},
  {item:55, name:"Baking Soda",                  category:"Pantry Staple",      type:"Whole Food", iron:0.0,  calcium:0,     compounds:"Sodium bicarbonate (NaHCO3)",                                                                   shelf:36,  cost:0.02, risk:"Low",          vulnerable:"None"},
  {item:56, name:"Granulated Sugar",             category:"Pantry Staple",      type:"Whole Food", iron:0.0,  calcium:1,     compounds:"Sucrose",                                                                                       shelf:24,  cost:0.05, risk:"Low",          vulnerable:"None"},
  {item:57, name:"Brown Sugar",                  category:"Pantry Staple",      type:"Whole Food", iron:0.4,  calcium:21,    compounds:"Sucrose, molasses",                                                                             shelf:18,  cost:0.06, risk:"Low",          vulnerable:"None"},
  {item:58, name:"Canola Oil",                   category:"Pantry Staple",      type:"Whole Food", iron:0.0,  calcium:0,     compounds:"Refined canola oil",                                                                            shelf:24,  cost:0.10, risk:"Low",          vulnerable:"None"},
  {item:59, name:"Iodized Salt",                 category:"Pantry Staple",      type:"Fortified",  iron:0.1,  calcium:24,    compounds:"Sodium chloride, Potassium iodide",                                                             shelf:60,  cost:0.01, risk:"Low",          vulnerable:"None"},
  {item:60, name:"Vanilla Extract",              category:"Pantry Staple",      type:"Whole Food", iron:0.1,  calcium:1,     compounds:"Ethanol, water, vanilla bean extractives",                                                      shelf:48,  cost:0.15, risk:"Low",          vulnerable:"None"},

  // Cooking staples — pair with existing inventory items
  {item:61, name:"Canned Diced Tomatoes",        category:"Pantry Staple",      type:"Whole Food", iron:1.8,  calcium:35,    compounds:"Natural",                                                                                       shelf:36,  cost:0.20, risk:"Low",          vulnerable:"None"},
  {item:62, name:"Canned Coconut Milk",          category:"Pantry Staple",      type:"Whole Food", iron:3.5,  calcium:16,    compounds:"Coconut extract, water, guar gum",                                                             shelf:24,  cost:0.35, risk:"Low",          vulnerable:"None"},
  {item:63, name:"Chicken Broth (Low-Sodium)",   category:"Pantry Staple",      type:"Whole Food", iron:0.5,  calcium:14,    compounds:"Natural",                                                                                       shelf:12,  cost:0.18, risk:"Low",          vulnerable:"None"},
  {item:64, name:"Rolled Oats",                  category:"Pantry Staple",      type:"Whole Food", iron:2.1,  calcium:21,    compounds:"Whole grain oats",                                                                              shelf:24,  cost:0.07, risk:"Low",          vulnerable:"None"},
  {item:65, name:"Cornmeal (Yellow)",            category:"Pantry Staple",      type:"Fortified",  iron:2.4,  calcium:7,     compounds:"Degermed yellow cornmeal, Ferrous Sulfate, Niacin, Thiamin",                                   shelf:24,  cost:0.09, risk:"Arsenic",      vulnerable:"Infants/Children"},
  {item:66, name:"Red Lentils (Dried)",          category:"Pantry Staple",      type:"Whole Food", iron:3.3,  calcium:19,    compounds:"Natural",                                                                                       shelf:36,  cost:0.12, risk:"Low",          vulnerable:"None"},
  {item:67, name:"Honey",                        category:"Pantry Staple",      type:"Whole Food", iron:0.1,  calcium:1,     compounds:"Glucose, fructose, water, trace enzymes",                                                       shelf:60,  cost:0.20, risk:"Low",          vulnerable:"Children <12 mo"},
  {item:68, name:"Olive Oil",                    category:"Pantry Staple",      type:"Whole Food", iron:0.1,  calcium:1,     compounds:"Monounsaturated fatty acids (oleic acid)",                                                      shelf:18,  cost:0.22, risk:"Low",          vulnerable:"None"},
  {item:69, name:"Apple Cider Vinegar",          category:"Pantry Staple",      type:"Whole Food", iron:0.1,  calcium:1,     compounds:"Acetic acid, water, apple cider",                                                               shelf:60,  cost:0.08, risk:"Low",          vulnerable:"None"},
  {item:70, name:"Soy Sauce (Low-Sodium)",       category:"Pantry Staple",      type:"Whole Food", iron:0.4,  calcium:4,     compounds:"Water, soybeans, wheat, salt",                                                                  shelf:24,  cost:0.12, risk:"Low",          vulnerable:"None"},

  // Spices — used in small amounts; mineral values per 1 tsp serving
  {item:71, name:"Garlic Powder",                category:"Pantry Staple",      type:"Whole Food", iron:0.2,  calcium:8,     compounds:"Dehydrated garlic (allium sativum)",                                                            shelf:36,  cost:0.05, risk:"Low",          vulnerable:"None"},
  {item:72, name:"Cinnamon (Ground)",            category:"Pantry Staple",      type:"Whole Food", iron:0.9,  calcium:78,    compounds:"Cinnamaldehyde, eugenol",                                                                       shelf:36,  cost:0.06, risk:"Lead",         vulnerable:"Children"},
  {item:73, name:"Cumin (Ground)",               category:"Pantry Staple",      type:"Whole Food", iron:1.4,  calcium:20,    compounds:"Cuminaldehyde, cymene, terpenoids",                                                             shelf:36,  cost:0.05, risk:"Low",          vulnerable:"None"},
  {item:74, name:"Chili Powder",                 category:"Pantry Staple",      type:"Whole Food", iron:0.9,  calcium:19,    compounds:"Capsaicin, carotenoids (dried chili, cumin, oregano)",                                         shelf:36,  cost:0.05, risk:"Low",          vulnerable:"None"}
];

let invCurrentFilter = 'all';
let invCurrentSort = null;
let invSortAsc = true;

function invRenderTable(data) {
  const tbody = document.getElementById('inv-body');
  const noRes = document.getElementById('inv-noresults');
  if (!tbody) return;
  if (data.length === 0) {
    tbody.innerHTML = '';
    noRes.style.display = 'block';
    return;
  }
  noRes.style.display = 'none';
  const typeClass = {
    'Fortified':  'inv-type-fortified',
    'Whole Food': 'inv-type-wholefood',
    'High Risk':  'inv-type-highrisk'
  };
  tbody.innerHTML = data.map(it => {
    const riskClass = it.risk === 'Low' ? 'inv-risk-low' : 'inv-risk-flag';
    return `<tr style="transition:background 0.12s;" onmouseover="this.style.background='#f0f4f8'" onmouseout="this.style.background=''">
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0;"><strong>${it.item}</strong></td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0;"><strong>${it.name}</strong></td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0; font-size:12px;">${it.category}</td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0;"><span class="inv-badge ${typeClass[it.type] || ''}">${it.type}</span></td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0; font-family:'JetBrains Mono',monospace; font-size:12px;">${it.iron}</td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0; font-family:'JetBrains Mono',monospace; font-size:12px;">${it.calcium}</td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0; font-size:11.5px; color:#555; font-style:italic; max-width:260px;">${it.compounds}</td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0;"><span class="inv-badge ${riskClass}">${it.risk}</span></td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0; font-family:'JetBrains Mono',monospace; font-size:12px;">${it.shelf}</td>
      <td style="padding:7px 7px; border-bottom:1px solid #e0e0e0; font-family:'JetBrains Mono',monospace; font-size:12px;">$${it.cost.toFixed(2)}</td>
    </tr>`;
  }).join('');
}

function invFilter() {
  const term = (document.getElementById('inv-search') ? document.getElementById('inv-search').value : '').toLowerCase();
  const filtered = inventoryData.filter(it => {
    const matchSearch = !term ||
      it.name.toLowerCase().includes(term) ||
      it.category.toLowerCase().includes(term) ||
      it.compounds.toLowerCase().includes(term) ||
      it.risk.toLowerCase().includes(term);
    const f = invCurrentFilter;
    const matchFilter =
      f === 'all' ||
      (f === 'fortified'     && it.type === 'Fortified') ||
      (f === 'whole'         && it.type === 'Whole Food') ||
      (f === 'pantry'        && it.category === 'Pantry Staple') ||
      (f === 'highrisk'      && it.type === 'High Risk') ||
      (f === 'contamination' && it.risk !== 'Low') ||
      (f === 'arsenic'       && it.risk.toLowerCase().includes('arsenic')) ||
      (f === 'lead'          && it.risk.toLowerCase().includes('lead')) ||
      (f === 'mercury'       && it.risk.toLowerCase().includes('mercury')) ||
      (f === 'cadmium'       && it.risk.toLowerCase().includes('cadmium'));
    return matchSearch && matchFilter;
  });
  invRenderTable(filtered);
}

function invSort(col) {
  const sorted = [...inventoryData].sort((a, b) => {
    const va = a[col], vb = b[col];
    if (typeof va === 'number' && typeof vb === 'number') return invSortAsc ? va - vb : vb - va;
    const sa = String(va).toLowerCase(), sb = String(vb).toLowerCase();
    if (sa < sb) return invSortAsc ? -1 : 1;
    if (sa > sb) return invSortAsc ? 1 : -1;
    return 0;
  });
  invSortAsc = invCurrentSort === col ? !invSortAsc : true;
  invCurrentSort = col;
  invRenderTable(sorted);
}

function invInit() {
  // Compute stats dynamically from the data array
  const setEl = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
  setEl('inv-total',     inventoryData.length);
  setEl('inv-fortified', inventoryData.filter(i => i.type === 'Fortified').length);
  setEl('inv-whole',     inventoryData.filter(i => i.type === 'Whole Food').length);
  setEl('inv-highrisk',  inventoryData.filter(i => i.type === 'High Risk').length);
  setEl('inv-flags',     inventoryData.filter(i => i.risk !== 'Low').length);

  invRenderTable(inventoryData);

  const search = document.getElementById('inv-search');
  if (search) search.addEventListener('input', invFilter);

  document.querySelectorAll('[data-inv-filter]').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('[data-inv-filter]').forEach(b => b.classList.remove('inv-active'));
      this.classList.add('inv-active');
      invCurrentFilter = this.dataset.invFilter;
      invFilter();
    });
  });

  document.querySelectorAll('[data-inv-sort]').forEach(th => {
    th.addEventListener('click', function() {
      invSort(this.dataset.invSort);
    });
  });
}

// ====================================================================
// REFERENCE TAB — ELEMENT CARDS
// ====================================================================
const REF_ELEMENTS = [
  {
    sym: 'Ca', name: 'Calcium', atnum: 20, type: 'macro',
    hook: 'The most abundant mineral in the human body — 99% of it is locked inside your bones and teeth. The other 1% is doing everything else.',
    function: 'Builds and maintains bones and teeth. Triggers muscle contraction (including your heartbeat). Required for nerve signal transmission and blood clotting. Without Ca²⁺ ions, muscles cannot release after contracting.',
    foodSources: 'Dairy (milk, yogurt, cheese), fortified plant milks, sardines with bones, tofu made with calcium sulfate, kale, bok choy, fortified orange juice.',
    fortifyForms: ['Calcium carbonate', 'Calcium citrate', 'Calcium phosphate'],
    dailyValue: '1,300 mg/day (adults under 50); 1,000 mg (adults 19–50)',
    labNote: 'Ca is a macromineral — needed in gram-level amounts. Lead (Pb) mimics Ca chemically, which is why lead poisoning disrupts bone development and neurological function.',
    keywords: 'bones teeth muscle nerve heart dairy milk yogurt fortified macromineral'
  },
  {
    sym: 'P', name: 'Phosphorus', atnum: 15, type: 'macro',
    hook: 'Phosphorus is in every cell of your body — literally. DNA itself has a phosphate backbone. No phosphorus, no genetic information storage.',
    function: 'Forms the backbone of DNA and RNA (as phosphate groups). Key component of ATP — the molecule your cells use to store and transfer energy. Combines with calcium to form hydroxyapatite, the mineral that makes bones hard.',
    foodSources: 'Meat, fish, poultry, dairy, eggs, legumes, nuts, seeds, whole grains. Phosphorus is so widespread that deficiency is rare in people eating varied diets.',
    fortifyForms: ['Sodium phosphate', 'Calcium phosphate', 'Phosphoric acid (beverages)'],
    dailyValue: '700 mg/day (adults)',
    labNote: 'Arsenic (As) sits directly below phosphorus on the periodic table (Group 15). Because they share the same valence electron configuration, arsenic mimics phosphate (PO₄³⁻) and can substitute into ATP and DNA — disrupting energy metabolism at the molecular level.',
    keywords: 'DNA RNA ATP energy bones phosphate macromineral genetic arsenic mimic'
  },
  {
    sym: 'K', name: 'Potassium', atnum: 19, type: 'macro',
    hook: 'A banana has about 422 mg of potassium. Your heart generates its electrical pulse using potassium ions moving across cell membranes 60–100 times per minute.',
    function: 'Regulates fluid balance inside cells. Generates electrical signals in nerve and muscle cells by moving in and out across the cell membrane (in partnership with sodium). Critical for maintaining normal blood pressure and heart rhythm.',
    foodSources: 'Bananas, potatoes (with skin), sweet potatoes, spinach, beans, lentils, avocados, oranges, tomatoes, salmon, dairy.',
    fortifyForms: ['Potassium chloride', 'Potassium citrate'],
    dailyValue: '4,700 mg/day (adults)',
    labNote: 'K is in the same group (Group 1) as sodium (Na). This is why they work together — both are alkali metals with similar ionic behavior, and cells use the contrast between K⁺ (inside) and Na⁺ (outside) to generate electrical potential.',
    keywords: 'heart nerve fluid blood pressure banana macromineral alkali sodium electrical'
  },
  {
    sym: 'Na', name: 'Sodium', atnum: 11, type: 'macro',
    hook: 'Table salt is NaCl — sodium chloride. The average American consumes about 3,400 mg of sodium per day; the recommended limit is 2,300 mg. Excess sodium raises blood pressure by pulling water into the bloodstream.',
    function: 'Regulates fluid balance outside cells. Works with potassium to generate electrical signals in nerves and muscles. Maintains blood volume and blood pressure. Controls water distribution between compartments in the body.',
    foodSources: 'Table salt, processed and packaged foods, canned soups, bread, cheese, cured meats, sauces. Sodium occurs naturally in small amounts in many foods.',
    fortifyForms: ['Sodium chloride (iodized salt)', 'Sodium bicarbonate', 'Monosodium glutamate (MSG)'],
    dailyValue: '2,300 mg/day maximum (adults)',
    labNote: 'Sodium is the primary cation (positive ion) outside cells, while potassium dominates inside cells. This gradient is actively maintained by the sodium-potassium pump, which uses ATP — connecting back to phosphorus.',
    keywords: 'salt blood pressure fluid nerve muscle table salt processed food macromineral hypertension'
  },
  {
    sym: 'Mg', name: 'Magnesium', atnum: 12, type: 'macro',
    hook: 'Magnesium is required for over 300 enzyme reactions in the human body. It is also the central atom in chlorophyll — the molecule that makes plants green and captures sunlight. Green vegetables are green because they contain magnesium.',
    function: 'Activates hundreds of enzymes involved in energy production, protein synthesis, and DNA repair. Required for muscle and nerve function. Helps regulate blood sugar and blood pressure. Contributes to bone structure.',
    foodSources: 'Dark leafy greens (spinach, kale), nuts (especially almonds and cashews), seeds, legumes, whole grains, dark chocolate, avocados.',
    fortifyForms: ['Magnesium oxide', 'Magnesium citrate', 'Magnesium glycinate'],
    dailyValue: '420 mg/day (adult males); 320 mg/day (adult females)',
    labNote: 'Mg²⁺ and Ca²⁺ are both Group 2 divalent cations (alkaline earth metals). They compete for absorption in the gut. High calcium supplementation can reduce magnesium absorption — a real-world example of how periodic table position predicts chemical competition.',
    keywords: 'enzyme chlorophyll green vegetables nuts seeds bone blood sugar energy macromineral alkaline earth'
  },
  {
    sym: 'Fe', name: 'Iron', atnum: 26, type: 'micro',
    hook: 'Iron is what makes blood red. Hemoglobin, the protein that carries oxygen in red blood cells, contains iron at its center. Without enough iron, your cells starve for oxygen even when you are breathing normally.',
    function: 'Central component of hemoglobin (oxygen transport in red blood cells) and myoglobin (oxygen storage in muscles). Required for electron transport chain enzymes that generate ATP. Supports immune function and DNA synthesis.',
    foodSources: 'Heme iron (more absorbable): red meat, poultry, fish, shellfish. Non-heme iron: beans, lentils, fortified cereals, tofu, spinach, pumpkin seeds. Vitamin C enhances non-heme iron absorption.',
    fortifyForms: ['Ferrous sulfate (FeSO₄)', 'Ferrous fumarate', 'Ferric iron', 'Reduced iron'],
    dailyValue: '8 mg/day (adult males); 18 mg/day (premenopausal females)',
    labNote: 'Iron deficiency is the most common nutritional deficiency worldwide. When iron levels are low, the body upregulates iron transporters — and arsenic (As) can exploit these same pathways. This is why iron-deficient children absorb significantly more arsenic from food.',
    keywords: 'blood oxygen hemoglobin red blood cells anemia fatigue meat beans cereal fortified micromineral arsenic'
  },
  {
    sym: 'Zn', name: 'Zinc', atnum: 30, type: 'micro',
    hook: 'Zinc is involved in the structure of over 300 proteins. It helps wounds heal, keeps your immune system working, and is why zinc lozenges are sold at pharmacies during cold season.',
    function: 'Structural component of hundreds of enzymes and proteins (zinc-finger proteins regulate gene expression). Essential for immune cell development and function. Required for wound healing, cell division, protein synthesis, and taste and smell.',
    foodSources: 'Oysters (highest source by far), red meat, poultry, beans, nuts, whole grains, dairy. Plant-based zinc is less bioavailable due to phytates that inhibit absorption.',
    fortifyForms: ['Zinc oxide', 'Zinc sulfate', 'Zinc gluconate'],
    dailyValue: '11 mg/day (adult males); 8 mg/day (adult females)',
    labNote: 'Cadmium (Cd) sits directly below zinc on the periodic table (Group 12) and mimics Zn²⁺ in enzyme binding sites. Once inside a cell, cadmium displaces zinc from zinc-dependent enzymes — disrupting protein synthesis and causing cellular damage.',
    keywords: 'immune wound healing enzymes proteins taste smell oysters meat beans micromineral cadmium mimic'
  },
  {
    sym: 'Cu', name: 'Copper', atnum: 29, type: 'micro',
    hook: 'Copper has been used as an antimicrobial material for thousands of years — hospital doorknobs are sometimes made of copper alloys because bacteria die on contact with copper surfaces within hours.',
    function: 'Required for iron metabolism — copper-containing enzymes help incorporate iron into hemoglobin. Component of enzymes involved in energy production, antioxidant defense (superoxide dismutase), connective tissue formation, and nervous system function.',
    foodSources: 'Liver and organ meats (highest concentrations), shellfish (especially oysters), nuts, seeds, dark chocolate, whole grains, legumes.',
    fortifyForms: ['Copper sulfate', 'Cupric oxide'],
    dailyValue: '900 mcg/day (adults)',
    labNote: 'Copper and iron work closely together — copper deficiency can cause anemia even when iron intake is adequate, because copper is needed to release stored iron and build hemoglobin. This is why the periodic table position (transition metals, d-block) helps predict shared metabolic roles.',
    keywords: 'iron hemoglobin enzymes antioxidant connective tissue liver shellfish chocolate micromineral anemia'
  },
  {
    sym: 'I', name: 'Iodine', atnum: 53, type: 'micro',
    hook: 'Iodine deficiency is the leading preventable cause of intellectual disability worldwide. The solution — adding iodine to table salt — is one of the most cost-effective public health interventions ever implemented.',
    function: 'Exclusively used to synthesize thyroid hormones (thyroxine T₄ and triiodothyronine T₃). Thyroid hormones regulate metabolism throughout the body, including brain development in fetuses and infants, body temperature, heart rate, and protein synthesis.',
    foodSources: 'Iodized salt, seafood (especially seaweed and saltwater fish), dairy products (from iodine used in milking equipment sanitation), eggs. Iodine content of plant foods depends entirely on soil content.',
    fortifyForms: ['Potassium iodide (KI)', 'Sodium iodide (NaI)'],
    dailyValue: '150 mcg/day (adults); 220 mcg (pregnancy); 290 mcg (lactation)',
    labNote: 'Iodine (Group 17, a halogen) is unique among the essential minerals — it has only one confirmed biological role. The entire thyroid hormone system depends on a single element. Deficiency during pregnancy causes cretinism; deficiency in adults causes goiter (enlarged thyroid gland).',
    keywords: 'thyroid hormone metabolism brain development iodized salt seafood seaweed micromineral halogen growth'
  },
  {
    sym: 'Se', name: 'Selenium', atnum: 34, type: 'micro',
    hook: 'Selenium has an incredibly narrow margin between the amount your body needs and the amount that becomes toxic. The difference between a deficient intake and a toxic intake can be as small as 10-fold — one of the smallest safety margins of any nutrient.',
    function: 'Incorporated into selenoproteins — enzymes that protect cells from oxidative damage (glutathione peroxidase). Supports thyroid hormone metabolism. Essential for sperm production and male fertility. Plays a role in immune function and DNA repair.',
    foodSources: 'Brazil nuts (a single nut can contain 68–91 mcg, meeting or exceeding the daily requirement). Seafood, organ meats, poultry, eggs, enriched breads and cereals. Soil selenium content varies widely by region.',
    fortifyForms: ['Sodium selenite', 'Sodium selenate', 'Selenomethionine'],
    dailyValue: '55 mcg/day (adults); upper tolerable limit: 400 mcg/day',
    labNote: 'Mercury (Hg) mimics selenium at the molecular level. Methylmercury binds to selenoproteins (including glutathione peroxidase), inactivating them and triggering the exact oxidative damage that selenium normally prevents. This is why selenium-rich diets are studied as a potential buffer against mercury toxicity.',
    keywords: 'antioxidant thyroid immune selenium Brazil nuts seafood oxidative stress micromineral mercury mimic'
  },
  {
    sym: 'Pb', name: 'Lead', atnum: 82, type: 'toxic',
    hook: 'There is no safe level of lead exposure in children. Even blood lead levels previously considered acceptable are now linked to measurable reductions in IQ, attention, and academic achievement.',
    danger: 'Mimics calcium (Ca) in biological systems — both are Group 2 divalent cations. The body cannot distinguish Pb²⁺ from Ca²⁺ during absorption, so lead enters the body through calcium transport pathways. Once inside: it incorporates into bones (displacing calcium), crosses the blood-brain barrier, disrupts neurotransmitter signaling, and irreversibly damages the developing nervous system.',
    foodSources: 'Baby foods (root vegetables, fruit juices), canned goods with older solder, contaminated well water, foods grown in lead-contaminated soil, imported candies and ceramics, game meat from lead-shot hunting.',
    halfLife: 'Blood: 30 days. Bone: 10–30 years. Lead stored in bone is released during pregnancy (to build fetal skeleton), exposing the fetus to the mother\'s lifetime accumulation.',
    vulnerablePop: 'Children under 6 (brain development critical period), pregnant women and fetuses, people with iron or calcium deficiency (nutritional deficiency increases absorption).',
    labNote: 'Source: EPA Health Effects of Lead; FDA Closer to Zero program; CDC Blood Lead Reference Value.',
    keywords: 'toxic heavy metal brain nervous system children baby food IQ neurotoxin calcium mimic bones lead'
  },
  {
    sym: 'As', name: 'Arsenic', atnum: 33, type: 'toxic',
    hook: 'Arsenic has been used as a poison since ancient times — it was called "inheritance powder" because it was tasteless, odorless, and its symptoms mimicked natural illness. Today its greatest threat is not deliberate poisoning but chronic low-level exposure through food and water.',
    danger: 'Mimics phosphate (PO₄³⁻) — arsenic as arsenate (AsO₄³⁻) has the same charge and similar geometry. The body substitutes arsenate into ATP synthesis and DNA backbone positions, disrupting energy metabolism and DNA replication. Inorganic arsenic is classified as a Group 1 human carcinogen (IARC). Chronic exposure damages skin, liver, kidneys, and the cardiovascular system.',
    foodSources: 'Rice and rice products (rice absorbs arsenic from paddy water more efficiently than other grains), apple juice, grape juice, seafood (organic arsenobetaine form, generally less toxic), contaminated well water.',
    halfLife: 'Inorganic arsenic in blood: 1–4 days. In tissues: weeks. Chronic exposure accumulates in keratin-rich tissues (hair, nails, skin).',
    vulnerablePop: 'Infants and children consuming rice cereal or juice, people relying on well water in arsenic-rich geological areas, iron-deficient individuals (increased intestinal arsenic absorption).',
    labNote: 'Source: ATSDR Toxicological Profile for Arsenic; FDA Closer to Zero; EPA Arsenic in Drinking Water.',
    keywords: 'toxic heavy metal rice apple juice carcinogen DNA phosphate mimic energy ATP arsenic chronic'
  },
  {
    sym: 'Hg', name: 'Mercury', atnum: 80, type: 'toxic',
    hook: 'Mercury pollution from coal-burning power plants settles into waterways, where bacteria convert it into methylmercury — a form that accumulates up the food chain. By the time it reaches large predatory fish, mercury concentrations can be 1 million times higher than in surrounding water.',
    danger: 'Methylmercury has a high affinity for selenium — it binds to selenium-containing amino acids (selenocysteine) in selenoproteins, inactivating antioxidant enzymes like glutathione peroxidase. This triggers oxidative damage particularly in the nervous system. Methylmercury crosses both the blood-brain barrier and the placenta, making fetal brain development acutely vulnerable.',
    foodSources: 'Large predatory fish: shark, swordfish, king mackerel, tilefish (highest levels). Moderate levels: albacore tuna, grouper, mahi-mahi. Lower levels: canned light tuna, salmon, shrimp, catfish. FDA advises pregnant women to limit fish intake accordingly.',
    halfLife: 'Methylmercury in blood: 70–80 days. In brain tissue: months to years. Elemental mercury vapor accumulates differently.',
    vulnerablePop: 'Developing fetuses (methylmercury readily crosses placenta), nursing infants, pregnant women, women of childbearing age, young children.',
    labNote: 'Source: EPA Mercury in Fish Advisories; FDA Fish Advice; ATSDR Toxicological Profile for Mercury.',
    keywords: 'toxic heavy metal fish tuna seafood methylmercury brain nervous system fetal pregnancy selenium mimic bioaccumulation'
  },
  {
    sym: 'Cd', name: 'Cadmium', atnum: 48, type: 'toxic',
    hook: 'Cadmium has a biological half-life in the kidney of 10–30 years. Exposure throughout a lifetime accumulates — and there is no effective medical treatment to remove cadmium from the body once it deposits in kidney tissue.',
    danger: 'Mimics zinc (Zn) — both are Group 12 divalent cations with similar ionic radius. Cadmium competes with zinc and calcium for transport proteins and enzyme binding sites. In the kidney, cadmium accumulates in the proximal tubule cells, damaging the kidney\'s ability to filter blood. Classified as a Group 1 human carcinogen (IARC). Also disrupts calcium metabolism and is linked to bone fragility (itai-itai disease).',
    foodSources: 'Leafy vegetables (spinach, kale, lettuce) grown in cadmium-rich soil, root vegetables (potatoes, carrots), grains (wheat, rice), organ meats (especially kidney and liver), shellfish. Cigarette smoke is a major non-dietary source.',
    halfLife: 'Blood: 75–130 days. Kidney: 10–30 years. The kidney is the primary accumulation site and the critical target organ.',
    vulnerablePop: 'Children (higher absorption rates, longer remaining life for accumulation), people with iron or calcium deficiency (nutritional deficiency increases cadmium absorption), smokers.',
    labNote: 'Source: ATSDR Toxicological Profile for Cadmium; FDA Closer to Zero; WHO Cadmium in Food.',
    keywords: 'toxic heavy metal kidney zinc mimic bone leafy greens spinach kale carcinogen accumulation cadmium chronic'
  }
];

let refCurrentFilter = 'all';

function refBuildCards(elements) {
  const grid = document.getElementById('ref-grid');
  const noResults = document.getElementById('ref-noresults');
  const count = document.getElementById('ref-count');
  grid.innerHTML = '';
  if (elements.length === 0) {
    grid.style.display = 'none';
    noResults.style.display = 'block';
    count.textContent = '0 results';
    return;
  }
  grid.style.display = 'grid';
  noResults.style.display = 'none';
  count.textContent = elements.length + ' element' + (elements.length !== 1 ? 's' : '');

  elements.forEach(el => {
    const card = document.createElement('div');
    card.className = 'ref-card';
    card.dataset.sym = el.sym;

    const isToxic = el.type === 'toxic';
    const tagLabel = el.type === 'macro' ? 'Macromineral' : el.type === 'micro' ? 'Micromineral' : 'Toxic Metal';

    let bodyHtml = `<div class="ref-card-hook">${el.hook}</div>`;

    if (!isToxic) {
      bodyHtml += `
        <div class="ref-card-section">
          <div class="ref-card-section-title">Function in the Body</div>
          <div>${el.function}</div>
        </div>
        <div class="ref-card-section">
          <div class="ref-card-section-title">Good Food Sources</div>
          <div>${el.foodSources}</div>
        </div>
        <div class="ref-card-section">
          <div class="ref-card-section-title">Daily Value (Adults)</div>
          <div style="font-family:'JetBrains Mono',monospace; font-size:12px;">${el.dailyValue}</div>
        </div>
        <div class="ref-card-section">
          <div class="ref-card-section-title">Common Fortification Forms</div>
          <div>${el.fortifyForms.map(f => `<span class="ref-fortify-tag">${f}</span>`).join(' ')}</div>
        </div>`;
    } else {
      bodyHtml += `
        <div class="ref-card-section">
          <div class="ref-card-section-title">Why It's Dangerous</div>
          <div>${el.danger}</div>
        </div>
        <div class="ref-card-section">
          <div class="ref-card-section-title">Common Contaminated Food Sources</div>
          <div>${el.foodSources}</div>
        </div>
        <div class="ref-card-section">
          <div class="ref-card-section-title">Most Vulnerable Populations</div>
          <div>${el.vulnerablePop}</div>
        </div>
        <div class="ref-card-section">
          <div class="ref-card-section-title">Biological Half-Life</div>
          <div style="font-family:'JetBrains Mono',monospace; font-size:12px;">${el.halfLife}</div>
        </div>`;
    }

    bodyHtml += `
      <div class="ref-card-section" style="border-top:1px dashed var(--rule); margin-top:12px; padding-top:10px;">
        <div class="ref-card-section-title">Lab Connection</div>
        <div style="font-size:12px; color:#555;">${el.labNote}</div>
      </div>`;

    card.innerHTML = `
      <div class="ref-card-header" onclick="toggleRefCard('${el.sym}')">
        <div class="ref-card-sym ${el.type}">${el.sym}</div>
        <div class="ref-card-meta">
          <div class="ref-card-name">${el.name}</div>
          <div class="ref-card-atnum">Z = ${el.atnum} &nbsp;&bull;&nbsp; Group ${getGroup(el.atnum)} &nbsp;&bull;&nbsp; Period ${getPeriod(el.atnum)}</div>
        </div>
        <span class="ref-card-tag ${el.type}">${tagLabel}</span>
      </div>
      <div class="ref-card-body" id="ref-body-${el.sym}">${bodyHtml}</div>`;

    grid.appendChild(card);
  });
}

function toggleRefCard(sym) {
  const body = document.getElementById('ref-body-' + sym);
  if (body) body.classList.toggle('open');
}

function getGroup(atnum) {
  const groups = {20:2,15:15,19:1,11:1,12:2,26:8,30:12,29:11,53:17,34:16,82:14,33:15,80:12,48:12};
  return groups[atnum] || '—';
}

function getPeriod(atnum) {
  if (atnum <= 2) return 1;
  if (atnum <= 10) return 2;
  if (atnum <= 18) return 3;
  if (atnum <= 36) return 4;
  if (atnum <= 54) return 5;
  if (atnum <= 86) return 6;
  return 7;
}

function refFilter(query) {
  const q = query.toLowerCase().trim();
  let filtered = REF_ELEMENTS;
  if (refCurrentFilter !== 'all') filtered = filtered.filter(e => e.type === refCurrentFilter);
  if (q) {
    filtered = filtered.filter(e =>
      e.name.toLowerCase().includes(q) ||
      e.sym.toLowerCase().includes(q) ||
      (e.keywords || '').toLowerCase().includes(q) ||
      (e.function || '').toLowerCase().includes(q) ||
      (e.danger || '').toLowerCase().includes(q) ||
      (e.foodSources || '').toLowerCase().includes(q)
    );
  }
  refBuildCards(filtered);
}

function refPill(btn, type) {
  document.querySelectorAll('.ref-pill').forEach(p => {
    p.classList.remove('ref-pill-active');
  });
  btn.classList.add('ref-pill-active');
  refCurrentFilter = type;
  const q = document.getElementById('ref-search').value;
  refFilter(q);
}

// Initialize reference tab on first visit (lazy — only renders when student opens tab 4)
let refReady = false;
let invReady = false;
(function() {
  const origSwitch2 = window.switchTab;
  window.switchTab = function(idx) {
    origSwitch2(idx);
    if (idx === 4 && !refReady) {
      refReady = true;
      refBuildCards(REF_ELEMENTS);
    }
    // Inventory lazy init (tab 7)
    const invPanel = document.getElementById('tab-7');
    if (idx === 7 && invPanel && !invReady) {
      invReady = true;
      invInit();
    }
  };
})();
</script>
</body>
</html>
